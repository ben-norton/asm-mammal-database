function shuffle(e){for(var t,a,n=e.length;n;t=Math.floor(Math.random()*n),a=e[--n],e[n]=e[t],e[t]=a);return e}var _metaStatus,activityIndicatorOff,activityIndicatorOn,allError,animateHoverShadows,animateLoad,bindClickTargets,bindClicks,bindDismissalRemoval,bindPaperMenuButton,browserBeware,bsAlert,buildQuery,byteCount,checkFileVersion,checkLaggedUpdate,checkLocalVersion,checkTaxonNear,clearSearch,dataUriToBlob,dateMonthToString,deEscape,decode64,deepJQuery,delay,delayPolymerBind,doCORSget,doFontExceptions,doLazily,doNothing,domainPlaceholder,downloadDataUriAsBlob,e,encode64,error1,eutheriaFilterHelper,fetchMajorMinorGroups,foo,formatScientificNames,formatSearchResults,getElementHtml,getFilters,getLocation,getMaxZ,getRandomEntry,goTo,insertCORSWorkaround,insertModalImage,interval,isArray,isBlank,isBool,isEmpty,isJson,isNull,isNumber,isNumeric,jsonTo64,lightboxImages,loadJS,loadSocialMediaSlideoutBar,mapNewWindows,mobileCollapsable,modalTaxon,objToArgs,openLink,openTab,overlayOff,overlayOn,p$,parseTaxonYear,performSearch,post64,prepURI,randomInt,ref,roundNumber,roundNumberSigfig,safariDialogHelper,safariSearchArgHelper,searchParams,setHistory,setupServiceWorker,showBadSearchErrorMessage,smartUpperCasing,sortResults,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,uri,slice=[].slice,indexOf=[].indexOf||function(e){for(var t=0,a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1};(uri=new Object).o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory");try{uri.urlString=uri.urlString.replace(/(.*)\/(((&?[a-zA-Z_\-]+=[a-zA-Z_\-\+0-9%=]+)+)\/?)(.*)/gim,"$1/"),-1===uri.urlString.split("/").pop().search(/\./)&&"/"!==uri.urlString.slice(-1)&&(uri.urlString=uri.urlString.slice(0,uri.urlString.search(uri.urlString.split("/").pop())))}catch(e){}uri.query=uri.o.attr("fragment"),(domainPlaceholder=uri.o.attr("host").split(".")).pop(),uri.domain=null!=(ref=domainPlaceholder[0])?ref:"",_metaStatus=new Object,window.locationData=new Object,locationData.params={enableHighAccuracy:!0},locationData.last=void 0,"object"!=typeof window._asm&&(window._asm=new Object),_asm.socialHandles={twitter:"mammalogists"},_asm.mobileBreakpoint=767,isBool=function(e){return!0===e||!1===e},isEmpty=function(e){return!e||0===e.length},isBlank=function(e){return!e||/^\s*$/.test(e)},isNull=function(e,t){var a;if(null==t&&(t=!1),"object"==typeof e)try{if(null!=(a=e.length))try{return 0===a}catch(e){}return 0===Object.size}catch(e){}try{if(isEmpty(e)||isBlank(e)||null==e){if(!1!==e&&0!==e)return!0;if(t&&(!1===e||0===e))return!0}}catch(e){return e,!1}try{e=e.toString().toLowerCase()}catch(e){}return"undefined"===e||"null"===e||!(!t||"false"!==e&&"0"!==e)},isJson=function(e){if("object"==typeof e)return!0;try{return JSON.parse(e),!0}catch(e){}return!1},isArray=function(e){try{return e.slice(0).push("foo"),!0}catch(e){return!1}},isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isNumeric=function(e){return isNumber(e)},toFloat=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseFloat(e)},toInt=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseInt(e)},String.prototype.removeExponents=function(e){var t,a,n,r,o,i,s,l;if(null==e&&(e=!0),1===(t=this.split(/[eE]/)).length)return t[0];if(l="",i="-"===this.slice(0,1)?"-":"",s=t[0].replace(".",""),(n=Number(t[1])+1)<=0){for(l=i+"0.";!(n>=0);)l+="0",++n;return o=l+s.replace(/^\-/,""),e?parseFloat(o):o}if(s.length<=n){for(n-=s.length;!(n<=0);)l+=0,--n;return o=s+l,e?parseFloat(o):o}return a=parseFloat(t[0]),r=Math.pow(10,parseInt(t[1])),a*r},Number.prototype.removeExponents=function(){return String(this).removeExponents(!0)},toObject=function(e){var t,a,n;n=new Object;for(a in e)void 0!==(t=e[a])&&(n[a]=t);return n},String.prototype.toAscii=function(){return this.replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g,"'").replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/\u02C6/g,"^").replace(/\u2039/g,"").replace(/[\u02DC|\u00A0]/g," ")},String.prototype.toBool=function(){return"true"===this.toString()},Boolean.prototype.toBool=function(){return"true"===this.toString()},Number.prototype.toBool=function(){return"1"===this.toString()},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.containsObject=function(e){try{return"object"==typeof _.find(this,function(t){return _.isEqual(e,t)})}catch(e){return e,console.error("Please load underscore.js before using this."),console.info("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")}},Array.prototype.sum=function(){return this.reduce(function(e,t){return e+t})},Array.prototype.mean=function(){return this.sum()/this.length},Object.toArray=function(e){try{return e.slice(0).push("foo"),e}catch(e){}return Object.keys(e).map(function(t){return function(t){return e[t]}}())},Object.size=function(e){var t,a,n;if("object"!=typeof e)try{return e.length}catch(e){t=e,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(t.message)}n=0;for(a in e)e.hasOwnProperty(a)&&n++;return n},Object.doOnSortedKeys=function(e,t){var a,n,r,o,i;for(o=[],r=0,n=(i=Object.keys(e).sort()).length;r<n;r++)a=e[i[r]],o.push(t(a));return o},delay=function(e,t){return setTimeout(t,e)},interval=function(e,t){return setInterval(t,e)},roundNumber=function(e,t){var a;return null==t&&(t=0),a=Math.pow(10,t),Math.round(e*a)/a},roundNumberSigfig=function(e,t){var a,n,r,o,i;return null==t&&(t=0),r=roundNumber(e,t).toString(),1===(a=r.split(".")).length?r+"."+Array(t+1).join("0"):(i=a.pop(),o=a[0]+".",i.length===t?r:(n=t-i.length,i+=Array(n+1).join("0"),""+o+i))},String.prototype.stripHtml=function(e){var t;return null==e&&(e=!1),t=this,e&&(t=t.replace(/<(\w+)(?:[^"'>]|"[^"]*"|'[^']*')*>(?:((?:.)*?))<\/?\1(?:[^"'>]|"[^"]*"|'[^']*')*>/gm,"")),t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),t=t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")},String.prototype.unescape=function(e){var t,a,n;return null==e&&(e=!1),a=document.createElement("div"),t=function(t){return null!=t&&"string"==typeof t&&(t=!0!==e?escape(t).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"):(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),a.innerHTML=t,a.innerText?(t=a.innerText,a.innerText=""):(t=a.textContent,a.textContent="")),unescape(t)},n=deEscape(this),t(n)},deEscape=function(e){return e=e.replace(/\&amp;#/gm,"&#"),e=e.replace(/\&quot;/gm,'"'),e=e.replace(/\&quote;/gm,'"'),e=e.replace(/\&#95;/gm,"_"),e=e.replace(/\&#39;/gm,"'"),e=e.replace(/\&#34;/gm,'"'),e=e.replace(/\&#62;/gm,">"),e=e.replace(/\&#60;/gm,"<")},String.prototype.escapeQuotes=function(){var e;return e=this.replace(/"/gm,"&#34;"),e=e.replace(/'/gm,"&#39;")},getElementHtml=function(e){return e.outerHTML},jQuery.fn.outerHTML=function(){return $(this).get(0).outerHTML},jQuery.fn.outerHtml=function(){return $(this).outerHTML()},jQuery.fn.selectText=function(){var e,t,a=document,n=this[0];a.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(n),e.select()):window.getSelection&&(t=window.getSelection(),(e=document.createRange()).selectNodeContents(n),t.removeAllRanges(),t.addRange(e))},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.polymerSelected=function(e,t,a,n,r){var o,i,s,l,c,d,u,p,m,h,g,f,b,y;if(null==e&&(e=void 0),null==t&&(t="attrForSelected"),null==a&&(a="paper-listbox"),null==n&&(n="paper-item"),null==r&&(r=!0),!$(this).exists())return console.error("Nonexistant element"),!1;if(i=$(this).attr("id"),isNull(i))return console.error("Your parent dropdown (eg, paper-dropdown-menu) must have a unique ID"),!1;s="#"+i+" "+a;try{a===$(this).get(0).tagName.toLowerCase()&&(s=this)}catch(e){}if(!$(s).exists()){s="#"+i+" "+(a="paper-menu");try{a===$(this).get(0).tagName.toLowerCase()&&(s=this)}catch(e){}if(!$(s).exists()){try{return isNull(p$(this).value)?null:p$(this).value}catch(e){console.error("Can't identify the dropdown selector for this dropdown list '"+i+"'",s,this)}return console.warn("Unable to fetch data for item","#"+i),!1}}if(!0!==t?(o=$(s).attr(t),isNull(o)&&(o=!0)):o=!0,null==e){y=void 0;try{try{y=p$(this).selected}catch(e){}isNull(y)&&(y=p$(s).selected),isNumber(y)&&!isNull(o)?(u=$(this).find(n)[toInt(y)],y=!0!==o?$(u).attr(o):$(u).text()):(console.debug("isNumber(val)",isNumber(y,y)),console.debug("isNull attr",isNull(o,o)))}catch(e){return l=e,console.error("Couldn't find selected: "+l.message),console.warn(l.stack),console.debug("Selector",s),!1}"null"!==y&&null!=y||(y=void 0);try{y=y.trim()}catch(e){}return y}if(f=s,isBool(e)||isNull(e)){if(isBool(e)&&($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",e),$(this).prop("active",e),$(this).prop("aria-selected",e),!0===e))return $(this).addClass("iron-selected")}else try{if(!0===o){for(m=0,p=(h=$(this).find(n)).length;m<p;m++)if(d=h[m],b=r?$(d).text().toLowerCase().trim():$(d).text(),g=r?e.toLowerCase().trim():e,b===g){c=$(d).index();break}if(isNull(c))return console.error("Unable to find an index for "+n+" with text '"+e+"' (ignore case: "+r+")"),!1;try{p$(f).select(c)}catch(e){l=e,p$(f).selected=c}p$(f).selected!==c&&doNothing()}else try{p$(f).select(e)}catch(t){p$(f).selected=e}return!0}catch(t){return l=t,console.error("Unable to set selected '"+e+"': "+l.message),!1}},jQuery.fn.polymerChecked=function(e){var t;return null==e&&(e=void 0),null!=e?jQuery(this).prop("checked",e):("null"!==(t=jQuery(this)[0].checked)&&null!=t||(t=void 0),t)},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(e){return function(e){return encodeURI(e).split(/%..|./).length-1}}(),randomInt=function(e,t){var a,n,r;return null==e&&(e=0),null==t&&(t=1),r=Math.random(),null==e&&(e=(a=[0,e])[0],t=a[1]),e>t&&(e=(n=[t,e])[0],t=n[1]),Math.floor(r*(t-e+1)+e)},window.debounce_timer=null,Function.prototype.getName=function(){var e;return null==(e=this.name)&&(e=this.toString().substr(0,this.toString().indexOf("(")).replace("function ","")),isNull(e)&&(e=md5(this.toString())),e},Function.prototype.debounce=function(){var e,t,a,n,r,o,i,s;i=arguments[0],a=arguments[1],s=arguments[2],e=4<=arguments.length?slice.call(arguments,3):[],null==i&&(i=300),null==a&&(a=!1),null==s&&(s=window.debounce_timer),null==(null!=(o=window.core)?o.debouncers:void 0)&&(null==window.core&&(window.core=new Object),core.debouncers=new Object);try{r=this.getName()}catch(e){}try{null!=core.debouncers[r]&&(s=core.debouncers[r])}catch(e){}if(n=this,t=function(){if(null!=r&&(clearTimeout(s),delete core.debouncers[r]),!a)return n.apply(n,e)},null!=s)try{clearTimeout(s)}catch(e){e}return a?(n.apply(obj,e),console.debug("Executed "+r+" immediately"),!1):null!=r?core.debouncers[r]=delay(i,function(){return t()}):window.debounce_timer=delay(i,function(){return t()})},loadJS=function(e,t,a){var n,r,o,i;if(null==t&&(t=new Object),null==a&&(a=!0),$("script[src='"+e+"']").exists()){if("function"==typeof t)try{t()}catch(e){n=e,console.error("Script is already loaded, but there was an error executing the callback function - "+n.message)}return!0}return(i=document.createElement("script")).setAttribute("src",e),i.setAttribute("async","async"),i.setAttribute("type","text/javascript"),i.src=e,i.async=!0,o=function(){var a;a=i.readyState;try{if(!t.done&&(!a||/loaded|complete/.test(a))&&(t.done=!0,"function"==typeof t))try{return t()}catch(t){return n=t,console.error("Postload callback error for '"+e+"' - "+n.message)}}catch(t){return n=t,console.error("Onload error for '"+e+"' - "+n.message)}},r=function(){console.warn("There may have been a problem loading "+e);try{if(!t.done&&(t.done=!0,"function"==typeof t&&a))try{return t()}catch(e){return n=e,console.error("Post error callback error - "+n.message)}}catch(e){return n=e,console.error("There was an error in the error handler! "+n.message)}},i.setAttribute("onload",o),i.setAttribute("onreadystate",o),i.setAttribute("onerror",r),i.onload=i.onreadystate=o,i.onerror=r,document.getElementsByTagName("head")[0].appendChild(i),!0},String.prototype.toTitleCase=function(){var e,t,a,n,r,o,i,s,l,c,d;for(s=this.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),o=0,e=(r=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;o<e;o++)a=r[o],n=new RegExp("\\s"+a+"\\s","g"),s=s.replace(n,function(e){return e.toLowerCase()});for(i=0,t=(d=["Id","Tv"]).length;i<t;i++)l=d[i],c=new RegExp("\\b"+l+"\\b","g"),s=s.replace(c,l.toUpperCase());return s},smartUpperCasing=function(e){var t,a,n,r,o,i,s,l,c,d,u;if(isNull(e))return"";o=function(e){return e.replace(e,e.toUpperCase())},c=e.replace(/((?=((?!-)[\W\s\r\n]))\s[A-Za-z]|^[A-Za-z])/g,o),d=["a","an","and","at","but","by","for","in","nor","of","on","or","out","so","to","the","up","yet"];try{for(a=0,t=d.length;a<t;a++)i=(u=d[a]).toTitleCase(),r=u.toLowerCase(),n=new RegExp(" "+i+" ","g"),c=c.replace(n," "+r+" ")}catch(e){}try{c.match(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/m)&&(l=(s=c.replace(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/gm,"$2")).toTitleCase(),c=c.replace(s,l))}catch(e){}return c},mapNewWindows=function(e){return null==e&&(e=!0),$(".newwindow").each(function(){var t,a;return null==(t=$(this).attr("href"))&&(t=$(this).attr("data-href")),a=function(e){return null!=e&&(window.open(e),!1)},$(this).click(function(n){return e&&(n.preventDefault(),n.stopPropagation()),a(t)}),$(this).keypress(function(){return a(t)})})},toastStatusMessage=function(e,t,a,n){var r,o;return null==t&&(t=""),null==a&&(a=3e3),null==n&&(n="#search-status"),!0===window._metaStatus.isToasting?(delay(250,function(){return toastStatusMessage(e,t,a,n)}),!1):(window._metaStatus.isToasting=!0,isNumber(t)&&(a=t),isNumber(a)||(a=3e3),!1===n.slice(0,1)&&(n="#"+n),$(n).exists()||(r='<paper-toast id="'+n.slice(1)+'" duration="'+a+'"></paper-toast>',$(r).appendTo("body")),$(n).attr("text",e).text(e).addClass(t),(o=function(e){var r;++e;try{return p$(n).show(),delay(a+500,function(){var e;try{e=p$(n).opened}catch(e){}return"boolean"!=typeof e&&(e=!1),e||($(n).empty(),$(n).removeClass(t),$(n).attr("text","")),window._metaStatus.isToasting=!1,!1})}catch(t){return r=t,e<=50?delay(50,function(){return o(e),!1}):(console.error("Couldn't show loader: "+r.message),console.warn(r.stack))}})(0),delay(a,function(){return _metaStatus.isToasting=!1}),!1)},openLink=function(e){return null!=e&&(window.open(e),!1)},openTab=function(e){return openLink(e)},goTo=function(e){return null!=e&&(window.location.href=e,!1)},null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(window._metaStatus=new Object),_metaStatus.isLoading=!1,_metaStatus.isToasting=!1),animateLoad=function(e,t){var a,n;null==e&&(e="loader"),null==t&&(t=0),isNumber(e)&&(e="loader"),"#"===e.slice(0,1)?(n=e,e=e.slice(1)):n="#"+e,$(n).removeAttr("hidden"),null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(_metaStatus=new Object),_metaStatus.isLoading=!1);try{return _metaStatus.isLoading?t<100?(t++,delay(100,function(){return animateLoad(e,t)}),!1):(console.warn("Loader timed out waiting for load completion"),!1):($(n).exists()?$(n).attr("active",!0):$("body").append('<paper-spinner id="'+e+'" active></paper-spinner'),_metaStatus.isLoading=!0,!1)}catch(e){return a=e,console.warn("Could not animate loader",a.message)}},startLoad=function(e){return null==e&&(e=null),animateLoad(e)},stopLoad=function(e,t,a){var n,r;null==e&&(e="loader"),null==t&&(t=1e3),null==a&&(a=0),"#"===e.slice(0,1)?(r=e,e=e.slice(1)):r="#"+e;try{try{!0!==_metaStatus.isLoading&&p$(r).active&&$(r).isVisible()&&(_metaStatus.isLoading=!0)}catch(e){}return _metaStatus.isLoading?($(r).exists()&&($(r).addClass("good"),function(){return delay(t,function(){try{p$(r).active=!1}catch(e){}return $(r).removeClass("good").attr("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(r).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(r).remove(),_metaStatus.isLoading=!1):($(r).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(r).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):a<100&&(a++,delay(100,function(){return stopLoad(e,t,a)}),!1)}catch(e){return n=e,console.warn("Could not stop load animation",n.message)}},stopLoadError=function(e,t,a,n){var r,o;null==t&&(t="loader"),null==a&&(a=7500),"#"===t.slice(0,1)?(o=t,t=t.slice(1)):o="#"+t;try{return _metaStatus.isLoading?($(o).exists()&&($(o).addClass("bad"),null!=e&&toastStatusMessage(e,"",a),function(){return delay(a,function(){return $(o).removeClass("bad").prop("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(o).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(o).remove(),_metaStatus.isLoading=!1):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):n<100&&(n++,delay(100,function(){return stopLoadError(e,t,a,n)}),!1)}catch(e){return r=e,console.warn("Could not stop load error animation",r.message)}},doCORSget=function(e,t,a,n){var r,o,i,s;null==a&&(a=void 0),null==n&&(n=void 0),r=function(){if("function"==typeof n)return n();throw new Error("There was an error performing the CORS request")},i={url:e,data:t,type:"get",crossDomain:!0};try{$.ajax(i).done(function(e){if("function"==typeof a)return a(),!1}).fail(function(e,t){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(e){e,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(e=e+"?"+t,o=function(e,t){var a;return null==e&&(e="get"),a=new XMLHttpRequest,"withCredentials"in a?a.open(e,t,!0):"undefined"!=typeof XDomainRequest?(a=new XDomainRequest).open(e,t):a=null,a},!(s=o("get",e)))throw new Error("CORS not supported");return s.onload=function(){var e;return e=s.responseText,"function"==typeof a&&a(e),!1},s.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),r()},s.send(),!1},deepJQuery=function(e){try{if(!$("html /deep/ "+e).exists())throw"Bad /deep/ selector";return $("html /deep/ "+e)}catch(t){t;try{if(!$("html >>> "+e).exists())throw"Bad >>> selector";return $("html >>> "+e)}catch(t){return t,$(e)}}},p$=function(e){try{return $$(e)[0]}catch(t){try{return $(e).get(0)}catch(t){return d$(e).get(0)}}},window.d$=function(e){return deepJQuery(e)},lightboxImages=function(e,t){var a,n;return null==e&&(e=".lightboximage"),null==t&&(t=!1),n={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},_asm.lightbox={options:n},a=t?d$(e):$(e),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return a.click(function(e){try{return e.preventDefault(),e.stopPropagation(),$(this).imageLightbox(n).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(t){return e=t,console.error("Unable to lightbox this image!")}}).each(function(){var t,a;console.log("Using selectors '"+e+"' / '"+this+"' for lightboximages");try{if(("img"===$(this).prop("tagName").toLowerCase()||"picture"===$(this).prop("tagName").toLowerCase())&&"a"!==$(this).parent().prop("tagName").toLowerCase())return a=$(this).removeClass("lightboximage").prop("outerHTML"),t=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");case!!isNull($(this).attr("src")):return $(this).attr("src");default:return $(this).find("img").attr("src")}}.call(this),$(this).replaceWith("<a href='"+t+"' data-lightbox='"+t+"' class='lightboximage'>"+a+"</a>"),$("a[href='"+t+"']").imageLightbox(n)}catch(e){return e,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",a)}),!1},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(e){return null==e&&(e=".sciname"),$(".sciname").each(function(){var e;return e="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",e)})},prepURI=function(e){return(e=encodeURIComponent(e)).replace(/%20/g,"+")},getLocation=function(e){var t,a;return null==e&&(e=void 0),a=function(e,t){return window.locationData.lat=e.coords.latitude,window.locationData.lng=e.coords.longitude,window.locationData.acc=e.coords.accuracy,window.locationData.last=Date.now(),null!=t&&t(window.locationData),!1},t=function(e,t){var a;return a=function(){switch(e.code){case 0:return"There was an error while retrieving your location: "+e.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+e.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(a),null!=t&&t(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(a,t,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=e?e(!1):void 0)},dateMonthToString=function(e){var t,a;t={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};try{a=t[e]}catch(t){a=e}return a},bindClickTargets=function(){return bindClicks(),!1},bindClicks=function(e){return null==e&&(e=".click"),$(e).each(function(){var e,t,a,n;try{if(n=$(this).attr("data-href"),isNull(n)&&null!=(n=$(this).attr("data-url"))&&$(this).attr("data-newtab","true"),!isNull(n)){$(this).unbind();try{n===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(e){t=e,console.warn("tagname lower case error")}return $(this).click(function(){var e,t,a;return n=$(this).attr("data-href"),isNull(n)&&(n=$(this).attr("data-url")),(null!=(e=$(this).attr("newTab"))?e.toBool():void 0)||(null!=(t=$(this).attr("newtab"))?t.toBool():void 0)||(null!=(a=$(this).attr("data-newtab"))?a.toBool():void 0)?openTab(n):goTo(n)}),n}if(null!=(e=null!=(a=$(this).attr("data-function"))?a:$(this).attr("data-fn")))return $(this).unbind(),$(this).click(function(){try{return window[e]()}catch(a){return t=a,console.error("'"+e+"()' is a bad function - "+t.message)}})}catch(e){return t=e,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+t.message)}}),!1},getMaxZ=function(){var e;return e=function(){return $.map($("body *"),function(e,t){if("static"!==$(e).css("position"))return parseInt($(e).css("z-index")||1)})},Math.max.apply(null,e())},browserBeware=function(){return!1},bsAlert=function(e,t,a,n){var r,o,i,s,l,c;null==t&&(t="warning"),null==a&&(a="body"),null==n&&(n="#bs-alert");try{$(n).exists()?($(n).removeClass("alert-warning alert-info alert-danger alert-success"),$(n).addClass("alert-"+t)):(l='<div class="alert alert-'+t+' alert-dismissable hanging-alert" role="alert" id="'+n.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',c=$("main").exists()?"main":$("article").exists()?"article":a,$(c).prepend(l)),$(n+" .alert-message").html(e)}catch(a){(r=document.createElement("div")).setAttribute("class","alert alert-"+t+" alert-dismissable hanging-alert"),r.setAttribute("role","alert"),r.setAttribute("id",n.slice(1)),(i=document.createElement("button")).setAttribute("class","close"),i.setAttribute("data-dismiss","alert"),i.setAttribute("aria-label","Close"),(s=document.createElement("span")).setAttribute("aria-hidden","true"),s.textContent="&times;",i.appendChild(s),r.appendChild(i),(o=document.createElement("div")).setAttribute("class","alert-message"),o.textContent=e,r.appendChild(o);try{document.querySelector("#bs-alert").remove()}catch(e){}document.querySelector("body").appendChild(r)}return bindClicks(),mapNewWindows(),!1},animateHoverShadows=function(e,t,a){var n,r;return null==e&&(e="paper-card.card-tile"),null==t&&(t=2),null==a&&(a=4),n=function(){return $(this).attr("elevation",a)},r=function(){return $(this).attr("elevation",t)},$(e).hover(n,r),!1},allError=function(e){return stopLoadError(e),bsAlert(e,"danger"),console.error(e),!1},checkFileVersion=function(e){var t;return null==e&&(e=!1),t=function(){return $.get(uri.urlString+"meta.php","do=get_last_mod","json").done(function(t){var a;return e&&console.log("Forced version check:",t),!!isNumber(t.last_mod)&&(null==_asm.lastMod&&(_asm.lastMod=t.last_mod),t.last_mod>_asm.lastMod?(a='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(a),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version is out of date! Please refresh the page.")):e?console.info("Your version is up to date: have "+_asm.lastMod+", got "+t.last_mod):void 0)}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){return delay(3e5,function(){return t()})})},!(!e&&null!=_asm.lastMod)&&(t(),!0)},window.checkFileVersion=checkFileVersion,setupServiceWorker=function(){return"serviceworker"in navigator&&navigator.serviceWorker.register("js/serviceWorker.min.js").then(function(e){return console.log("ServiceWorker registered with scope",e.scope)}).catch(function(e){return console.warn("ServiceWorker registration failed:",e)}),!1},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},doNothing=function(){return null},buildQuery=function(e){var t,a,n,r,o;n=new Array;for(t in e)r=e[t],a=t.replace(/[^A-Za-z\-_\[\]]/gim,""),o=encodeURIComponent(r).replace(/\%20/g,"+"),n.push(a+"="+o);return n.join("&")},checkLocalVersion=function(){var e,t,a,n,r,o;if("localhost"===uri.o.attr("host")){for(o=uri.o.attr("directory").split("/"),r=new Array,t=0,e=o.length;t<e;t++)a=o[t],isNull(a)||r.push(a);n=0===r[0].search("~")?uri.o.attr("protocol")+"://localhost"+r[0]+"/":uri.urlString,$.get(n+"currentVersion").done(function(e){var t,n,r,o;return console.log("Got tag",e),(r=e.replace(/v(([0-9]+\.)+[0-9]+)(\-\w+)?/gim,"$1")).length>128?(console.error("Problem checking version file"),!1):(o=r.split("."),t={access_token:"7a76691c6beea4d47eaaa6182a53e523c6a16a67"},n="https://api.github.com/repos/tigerhawkvok/asm-mammal-database/releases",$.get(n,buildQuery(t,"json")).done(function(e){var t,n,i,s,l,c,d,u,p,m,h;for(console.log("Github API result:",e),c=0,i=e.length;c<i;c++)for(u=e[c],console.log("Checking release",u),n=0,d=0,s=(m=(p=u.tag_name).replace(/v(([0-9]+\.)+[0-9]+)(\-\w+)?/gim,"$1").split(".")).length;d<s;d++){if(a=m[d],h=toInt(a),l=toInt(o[n]),h>l)return console.log("Found mismatched version at",uri.urlString+"/currentVersion"),console.warn("Notice: tag part '"+h+"' > '"+l+"'",p,r),t='<strong>Head\'s-Up:</strong> Your local version is behind the latest application release.\n<br/><br/>\nOpen up your terminal, and in your local directory run:\n<br/><br/>\n<code class="center-block text-center">git pull</code>\n<br/>\nTo get your local version up-to-date.',bsAlert(t),!1;if(h<l)break;++n}return console.debug("Your version is up-to-date"),!1}))})}else doNothing();return!1},jsonTo64=function(e,t){var a,n;null==t&&(t=!0);try{e.slice(0).push("foo"),e=toObject(e)}catch(e){}return n=JSON.stringify(e),a=!0===t?post64(n):encode64(a)},encode64=function(e){try{return Base64.encode(e)}catch(t){return t,console.warn("Bad encode string provided"),e}},decode64=function(e){try{return Base64.decode(e)}catch(t){return t,console.warn("Bad decode string provided"),e}},post64=function(e){var t;return t=encode64(e),encodeURIComponent(t)},objToArgs=function(e){var t,a,n,r;if("object"!=typeof e)throw{message:"INVALID_TYPE"};a=new Array;for(n in e)r=e[n],t=n+"="+encodeURIComponent(r),a.push(t);return a.join("&")},dataUriToBlob=function(e,t){var a,n,r,o,i,s,l,c,d,u;i=e.split(",")[1],e.split(";")[1].split(",")[0];try{n=atob(i)}catch(e){n=decodeURIComponent(i)}for(l=n.length,a=new Uint8Array(l),u=e.split(",")[0].split(":")[1].split(";")[0],s=0,d=0,c=a.length;d<c;d++)a[d],a[s]=n.charCodeAt(s),++s;return o={type:u},r=new Blob([a],o),"function"==typeof t&&t(r),r},downloadDataUriAsBlob=function(e){var t,a,n;if(isNull(e))return console.error("Needs a data URI or element selector as an argument!"),!1;try{$(e).exists()&&(a=$(e).attr("href"))}catch(e){}return isNull(a)&&(a=e,e=null),t=dataUriToBlob(a),n=URL.createObjectURL(t),isNull(e)?n:($(e).attr("href",n),!1)},delayPolymerBind=function(e,t,a){var n;return null==a&&(a=0),"undefined"==typeof md5||null===md5?loadJS("bower_components/JavaScript-MD5/js/md5.min.js",function(){return n()}):n(),n=function(){var n,r,o,i;if("object"!=typeof window._dpb&&(window._dpb=new Object),i=md5(e)+md5(t),isNull(window._dpb[i])&&(window._dpb[i]=!1),1e3,null==("undefined"!=typeof Polymer&&null!==Polymer&&null!=(o=Polymer.Base)?o.$$:void 0))return a<50?delay(100,function(){return++a,delayPolymerBind(e,t,a)}):(console.error("Failed to verify Polymer was set up, attempting manual"),r=document.querySelector(e),t(r));!1===window._dpb[i]&&(a=0,window._dpb[i]=!0);try{return r=Polymer.Base.$$(e),t(r),delay(1e3,function(){return console.info("Doing 1000ms delay callback for "+e),t(r)})}catch(o){return n=o,console.warn("Error trying to do the delayed polymer bind - "+n.message),a<10?(++a,delay(75,function(){return delayPolymerBind(e,t,a)})):(console.error("Persistent error in polymer binding ("+n.message+")"),console.error(n.stack),r=$(e).get(0),t(r),delay(1e3,function(){return r=document.querySelector(e),console.info("Doing 1000ms delay callback for "+e),console.info("Using element",r),t(r)}))}},!1},loadSocialMediaSlideoutBar=function(e,t,a){var n,r,o,i,s,l;if(null==t&&(t="#social-menu"),null==a&&(a="main"),l=function(){return $(t).hasClass("out")?$(t).removeClass("out").addClass("in"):$(t).removeClass("in").addClass("out"),!1},window.toggleSocialSlideoutBar=l,!$(t).exists()){n="";for(i in e){switch(r=e[i],i){case"twitter":s='<a class="twitter-timeline" data-link-color="#1DA1F2" href="https://twitter.com/'+r+'">Tweets by @'+r+'</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>          ';break;default:s=""}n+="\n"+s+"\n"}o='<paper-material id="social-menu" class="out" elevation="4">\n  <paper-icon-button icon="glyphicon-social:twitter" class="show-social"></paper-icon-button>\n  <div class="slideout-content">\n    '+n+"\n  </div>\n</paper-material>","    ",$(a).append(o),$(".show-social").click(function(){return l.debounce(50),!1})}return!1};try{$()}catch(error1){e=error1,bsAlert("<strong>You're offline</strong>: We need at least enough data to load a few dependencies. Please put yourself online and try again.","error")}$(function(){var t,a,n,r,o,i,s,l,c,d,u;try{checkLocalVersion(),interval(36e5,function(){return checkLocalVersion()})}catch(e){}formatScientificNames(),bindClicks(),mapNewWindows();try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(t){e=t,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),!0===(void 0!==adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)&&loadJS("js/admin.min.js",function(){return loadAdminUi()})}catch(t){e=t,getLocation(),loadJS("js/admin.min.js",function(){return _asm.inhibitRedirect=!0,verifyLoginCredentials(function(){var e,t,a;if(delete _asm.inhibitRedirect,"species-account.php"===uri.o.attr("file")&&"object"==typeof window.speciesData)try{return a=JSON.stringify(window.speciesData),e="#"+Base64.encode(a),t='<paper-icon-button\n  class="click admin-edit-button"\n  data-href="'+uri.urlString+"admin-page.html"+e+'"\n  icon="icons:create"\n  >\n</paper-icon-button>',$("header p paper-icon-button[icon='icons:home']").before(t),bindClicks(".admin-edit-button")}catch(e){}})}),loadJS("js/jquery.cookie.min.js",function(){return!1})}try{for(o=0,n=(d=$("marked-element")).length;o<n;o++)i=d[o],s=$(i).find("script").text(),isNull(s)||(p$(i).markdown=s)}catch(e){}browserBeware(),checkFileVersion();try{loadSocialMediaSlideoutBar(_asm.socialHandles)}catch(e){}try{for(l=0,r=(u=$("figcaption .caption-description")).length;l<r;l++)t=u[l],a=$(t).text().unescape(),$(t).text(a)}catch(e){}try{return(c=function(e){var t;return $("figure picture").exists()?(t=$("figure picture").width(),isNull(t,!0)?++e>=10?(console.log("Never saw a bigger image width"),!1):(delay(100,function(){return c(e)}),!1):(e>0&&console.warn("Took "+100*e+"ms to reposition image!"),$("figure p.picture-label").css("left","calc(50% - ("+t+"px/2)*.95)"),lightboxImages(),!1)):(console.log("No image on page"),!1)})(0)}catch(e){}}),(searchParams={lastSearch:"*",targetApi:"api.php",targetContainer:"#result_container"}).apiPath=uri.urlString+searchParams.targetApi,"object"!=typeof window._asm&&(window._asm=new Object),_asm.affiliateQueryUrl={iucnRedlist:"http://apiv3.iucnredlist.org/api/v3/species/",iucnRedlistCN:"http://apiv3.iucnredlist.org/api/v3/species/common_names/",iNaturalist:"https://www.inaturalist.org/taxa/search"},fetchMajorMinorGroups=function(e,t){var a,n;if(null==e&&(e=null),n=function(){var a,n,r,o,i;$("#eutheria-extra").remove(),r='<paper-item data-type="any" selected>All</paper-item>',o=_asm.major;for(n in o)r+='<paper-item data-type="'+n+'">'+o[n].toTitleCase()+"</paper-item>";if(e?"linnean_family":"simple_linnean_subgroup",a='<paper-menu-button id="simple-linnean-groups" class="col-xs-6 col-md-4">\n  <paper-button class="dropdown-trigger"><iron-icon icon="icons:filter-list"></iron-icon><span id="filter-what" class="dropdown-label"></span></paper-button>\n  <paper-menu label="Group" data-column="simple_linnean_group" class="cndb-filter dropdown-content" id="linnean" name="type" attrForSelected="data-type" selected="0">\n    '+r+"\n  </paper-menu>\n</paper-menu-button>",$("#simple-linnean-groups").exists()){$("#simple-linnean-groups").replaceWith(a),$("#simple-linnean-groups").on("iron-select",function(){var e;return e=$(p$("#simple-linnean-groups paper-menu").selectedItem).text(),$("#simple-linnean-groups span.dropdown-label").text(e)});try{i=$(p$("#simple-linnean-groups paper-menu").selectedItem).text(),$("#simple-linnean-groups span.dropdown-label").text(i)}catch(e){}}return eutheriaFilterHelper(!0),$("#simple-linnean-groups").exists()&&console.log("Replaced menu items with",r),"function"==typeof t&&t(),!1},"object"==typeof _asm.mammalGroupsBase&&"object"==typeof _asm.major)return isArray(_asm.mammalGroupsBase)||(_asm.mammalGroupsBase=Object.toArray(_asm.mammalGroupsBase)),n(),!0;if(!isBool(e))try{e=null==(a=p$("#use-scientific").checked)||a}catch(t){e=!0}return $.get(searchParams.apiPath,"fetch-groups=true&scientific="+e).done(function(e){return!0===e.status&&(_asm.mammalGroupsBase=Object.toArray(e.minor),_asm.major=e.major,n())}).fail(function(e,t){return console.error("Failed to hit API"),console.warn(e,t),!1}),!1},eutheriaFilterHelper=function(e){if(null==e&&(e=!1),!e){fetchMajorMinorGroups.debounce(50);try{$("#use-scientific").on("iron-change",function(){return delete _asm.mammalGroupsBase,fetchMajorMinorGroups.debounce(50)})}catch(e){}}$("#linnean").on("iron-select",function(){var e,t,a,n,r,o,i,s,l,c,d,u,p,m;if("eutheria"===$(p$("#linnean").selectedItem).attr("data-type")){for(s=new Array,i=0,r=(d=_asm.mammalGroupsBase).length;i<r;i++)n=d[i],s.push(n.toLowerCase());for(s.sort(),l="",c=0,o=s.length;c<o;c++)l+=a='<paper-item data-type="'+(t=s[c])+'">\n  '+t.toTitleCase()+"\n</paper-item>";if(!isBool(p))try{p=null==(u=p$("#use-scientific").checked)||u}catch(e){p=!0}return e=p?"linnean_order":"simple_linnean_subgroup",a='<div id="eutheria-extra"  class="col-xs-12 col-md-5">\n    <label for="type" class="sr-only">Eutheria Filter</label>\n    <div class="row">\n    <paper-menu-button class="col-xs-12" id="eutheria-subfilter">\n      <paper-button class="dropdown-trigger"><iron-icon icon="icons:filter-list"></iron-icon><span id="filter-what" class="dropdown-label"></span></paper-button>\n      <paper-menu label="Group" data-column="'+e+'" class="cndb-filter dropdown-content" id="linnean-eutheria" name="type" attrForSelected="data-type" selected="0">\n        <paper-item data-type="any" selected>All</paper-item>\n        '+l+"\n        \x3c!-- As per flag 4 in readme --\x3e\n      </paper-menu>\n    </paper-menu-button>\n    </div>\n  </div>",$("#simple-linnean-groups").after(a),$("#eutheria-subfilter").on("iron-select",function(){var e;return e=$(p$("#eutheria-subfilter paper-menu").selectedItem).attr("data-type"),$("#eutheria-subfilter span.dropdown-label").text(e)}),m=$(p$("#eutheria-subfilter paper-menu").selectedItem).attr("data-type"),$("#eutheria-subfilter span.dropdown-label").text(m)}return $("#eutheria-extra").remove()});try{doLazily()}catch(e){}return!1},checkLaggedUpdate=function(t){var a,n,r,o,i,s,l,c,d,u,p,m,h;if(o=["common_name","species_authority"],m=Date.now(),!0===t.do_client_update){s=i=0,n=!1;try{u=t.result;for(r in u){for(h=u[r],p=!0,d=0,c=o.length;d<c;d++)if(l=o[d],isNull(h[l])){p=!1;break}p||(++s,a="missing=true&genus="+h.genus+"&species="+h.species,$.get(searchParams.targetApi,a,"json").done(function(e){var t,a,n;if(++i,!e.did_update)return!1;console.log("Update for "+e.canonical_sciname,e),a=$(".cndb-result-entry[data-taxon='"+e.genus+"+"+e.species+"']");for(t in e)n=e[t],$(a).find("."+t).exists()&&!isNull(n)?isNull($(a).find("."+t).text())&&(console.log("Set "+t+" text of "+e.canonical_sciname+" to "+n),$(a).find("."+t).text(n)):$(a).find("."+t).exists()&&isNull(n)&&console.warn("Couldn't update "+t+" - got an empty IUCN result");return!1}).fail(function(e,t){return console.warn("Couldn't update "+h.canonical_sciname,e,t),console.warn(searchParams.targetApi+"?"+a),!1}).always(function(){var e;if(i===s&&n)return e=Date.now()-m,console.log("Finished async IUCN taxa check in "+e+"ms"),stopLoad(),delay(500,function(){return stopLoad()})}))}n=!0}catch(t){e=t,console.warn("Couldn't do client update -- "+e.message),console.warn(e.stack)}}else stopLoad();return!1},performSearch=function(e){var t,a,n,r,o,i,s,l;if(null==e&&(e=void 0),null==e){if(s=$("#search").val(),s,s=s.toLowerCase(),n=getFilters(),(isNull(s)||null==s)&&isNull(n))return $("#search-status").attr("text","Please enter a search term."),$("#search-status")[0].show(),!1;for($("#search").blur(),s=s.replace(/\./g,""),s=prepURI(s),o=0,r=(i=$("#search_form #search-options-container .bool-search-option paper-toggle-button")).length;o<r;o++)l=i[o],$(l).polymerChecked()&&(t=$(l).attr("id"),s+="&"+t+"=true");isNull(n)||(s=s+"&filter="+n),a="q="+s}else!0===e?(a="q=","(all items)"):(a="q="+e,e.split("&")[0]);return!("#"===s||isNull(s)&&isNull(a)||"q="===a&&!0!==e)&&(animateLoad(),console.log("Got search value "+s+", hitting",searchParams.apiPath+"?"+a),searchParams.lastSearch=s,$.get(searchParams.targetApi,a,"json").done(function(e){return 0===toInt(e.count)?(console.error("No search results: Got search value "+s+", from hitting",searchParams.apiPath+"?"+a),showBadSearchErrorMessage.debounce(null,null,null,e),clearSearch(!0),delay(500,function(){return stopLoadError()}),!1):!0===e.status?(console.log("Server response:",e),formatSearchResults(e,void 0,function(){return checkLaggedUpdate(e)}),!1):(clearSearch(!0),$("#search-status").attr("text",e.human_error),$("#search-status")[0].show(),console.error(e.error),console.warn(e),stopLoadError())}).fail(function(e,t){return console.error("There was an error performing the search"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't execute the search - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){var e;return e=Base64.encodeURI(s),null!=s&&setHistory(uri.urlString+"#"+e),!1}))},getFilters=function(t,a){var n,r;if(null==t&&(t=".cndb-filter"),null==a&&(a="AND"),n=new Object,$(t).each(function(){var e,t;if(null==(e=$(this).attr("data-column")))return!0;try{t=$(this).polymerSelected()}catch(e){return!0}return"any"===t||"all"===t||"*"===t||(!(!isNull(t)&&!1!==t||(t=$(this).val(),!isNull(t)))||(n[e]=t.toLowerCase()))}),0===Object.size(n))return"";try{return n.BOOLEAN_TYPE=a,r=JSON.stringify(n),Base64.encodeURI(r)}catch(t){return e=t,!1}},formatSearchResults=function(t,a,n){var r,o,i,s,l,c,d,u,p,m,h,g;return null==a&&(a=searchParams.targetContainer),m=Date.now(),l=0,$("#result-header-container").removeAttr("hidden"),i=t.result,searchParams.result=i,new Array,h="cndb-result-list",d="<table id='"+h+"' class='table table-striped table-hover col-md-12'>\n\t<tr class='cndb-row-headers'>","</table>",g=t.count,g>150?toastStatusMessage("We found "+t.count+" results, please hang on a moment while we render them...","",5e3):console.log("Not notifying of render delay, only showing "+g+" items"),o=null,r=0,s=["id","minor_type","notes","major_type","taxon_author","taxon_credit","image_license","image_credit","taxon_credit_date","parens_auth_genus","parens_auth_species","is_alien","internal_id","source","deprecated_scientific","canonical_sciname","simple_linnean_group","iucn","dwc","entry","common_name_source","image_caption","species_authority_citation","genus_authority_citation"],c=0,u=delay(7500,function(){return stopLoadError("There was a problem parsing the search results."),console.error("Couldn't finish parsing the results! Expecting "+g+" elements, timed out on "+c+"."),console.warn(i),!1}),p=["common_name","genus","species"],delay(5,function(){var g,f,b,y,w,v,x,_,k,S,C,L,T,N;f=new Array;for(y in i){L=i[y],g=!0;for(w in L)N=L[w],indexOf.call(f,w)>=0||(isNull(N)?g=!1:f.push(w));if(g)break}indexOf.call(f,"subspecies")>=0&&p.push("subspecies"),S=i[0];for(w in S)N=S[w],indexOf.call(p,w)<0&&indexOf.call(s,w)<0&&indexOf.call(f,w)>=0&&p.push(w);k=i,i=new Object;for(y in k)for(L=k[y],i[y]=new Object,_=0,x=p.length;_<x;_++)v=p[_],i[y][v]=L[v];return T=0,b=Object.toArray(i),(C=function(i,s,p){var g,f,b,v,x,_,k,S,D,j,E,P,A,O,I,B,U,R,M,q,F,z;k="",y=0,A=null,q=!1,isNumber(p)||(p=100),v=i.length<=p;try{B={action:"render-row",data:i,chunk:p,firstIteration:s},F=new Worker("js/serviceWorker.js"),console.info("Rendering list off-thread"),F.addEventListener("message",function(e){return console.info("Got message back from service worker",e.data),q=!0,k=e.data.html,A=e.data.nextChunk,e.data.renderChunk,y=e.data.loops,P()}),F.postMessage(B)}catch(t){for(console.log("Starting loop with i = "+y+", renderChunk = "+p+", data length = "+i.length,s,v),I=0,E=i.length;I<E;I++){if(L=i[I],++T,c=y,0===toInt(y)&&s){D=0,d+="\n\x3c!-- Table Headers - "+Object.size(L)+" entries --\x3e";for(w in L)N=L[w],++T,O=w.replace(/_/g," "),O=function(){switch(O){case"simple linnean subgroup":return"Group";case"major subtype":return"Clade";default:return O}}(),d+="\n\t\t<th class='text-center'>"+O+"</th>",r++,D++;d+="\n\t</tr>",d+="\n\x3c!-- End Table Headers --\x3e",console.log("Got "+r+" display columns."),g=roundNumber(12/r,0),o="col-md-"+g,x=d+"</table>",k=d,$(a).html(x)}M=L.genus+"+"+L.species,isNull(L.subspecies)||(M=M+"+"+L.subspecies),S="\n\t<tr id='"+("msadb-row"+y)+"' class='cndb-result-entry' data-taxon=\""+M+'" data-genus="'+L.genus+'" data-species="'+L.species+'">';for(w in L){if(f=L[w],++T,"authority_year"===w)if(isNull(f))b=f;else{try{b=JSON.parse(f)}catch(t){e=t;try{console.warn("There was an error parsing authority_year='"+f+"', attempting to fix - ",e.message),R=f.split(":"),z=R[1].slice(R[1].search('"')+1,-2),z=z.replace(/"/g,"'"),R[1]='"'+z+'"}',f=R.join(":"),b=JSON.parse(f)}catch(t){e=t,console.error("There was an error parsing '"+f+"'",e.message),b=f}}try{_=Object.keys(b)[0],U=b[_],toInt(L.parens_auth_genus).toBool()&&(_="("+_+")"),toInt(L.parens_auth_species).toBool()&&(U="("+U+")"),f="G: "+_+"<br/>S: "+U}catch(e){}}"image"===w&&(f=isNull(f)?"<paper-icon-button icon='launch' data-href='"+_asm.affiliateQueryUrl.mammalPhotos+"?rel-taxon=contains&where-taxon="+M+"' class='newwindow calphoto click' data-taxon=\""+M+'"></paper-icon-button>':"<paper-icon-button icon='image:image' data-lightbox='"+uri.urlString+f+"' class='lightboximage'></paper-icon-button>"),j="genus"!==w&&"species"!==w&&"subspecies"!==w?w+" text-center":w,"genus_authority"===w||"species_authority"===w?j+=" authority":"common_name"===w&&(f=smartUpperCasing(f),j+=" no-cap"),S+="\n\t\t<td id='"+w+"-"+y+"' class='"+j+" "+o+"'>"+f+"</td>"}if(S+="\n\t</tr>",k+=S,++y>=p)break}console.log("Ended data loop with i = "+y+", renderChunk = "+p),P()}return P=function(){var e;if(s?(k+="</table>",$(a).html(k),$("#result-count").text(" - "+t.count+" entries"),"space_common_fallback"!==t.method||$("#space-fallback-info").exists()?$("#space-fallback-info").exists()&&$("#space-fallback-info").prop("hidden",!0):(e='<div id="space-fallback-info" class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Don\'t see what you want?</strong> We might use a slightly different name. Try <a href="" class="alert-link" id="do-instant-fuzzy">checking the "fuzzy" toggle and searching again</a>, or use a shorter search term.\n</div>',$("#result_container").before(e),$("#do-instant-fuzzy").click(function(e){return e.preventDefault(),function(){return $("#fuzzy").get(0).checked=!0,performSearch()}.debounce()}))):$("table#"+h+" tbody").append(k),v||(l=Date.now()-m,null==A&&(A=i.slice(y)),console.log("Chunk rendered at "+l+"ms, next bit with slice @ "+y+":",A),0!==A.length?delay(q?25:250,function(){return C(A,!1,p)}):v=!0),v&&(l=Date.now()-m,console.log("Finished rendering list in "+l+"ms"),console.debug("Executed "+T+" loops"),l>3e3&&!q&&console.warn("Warning: Took greater than 3 seconds to render!"),stopLoad(),delay(250,function(){return stopLoad()}),"function"==typeof n))try{n()}catch(e){}return clearTimeout(u),mapNewWindows(),lightboxImages(),$(".cndb-result-entry").unbind().click(function(){var e;return e="genus="+$(this).attr("data-genus")+"&species="+$(this).attr("data-species"),goTo("species-account.php?"+e)}),doFontExceptions()}})(b,!0,100)}),!1},parseTaxonYear=function(t,a){var n,r,o,i,s;null==a&&(a=!0);try{n=JSON.parse(t)}catch(r){e=r,console.warn("There was an error parsing '"+t+"', attempting to fix - ",e.message);try{i=t.split(":"),s=i[1].slice(i[1].search('"')+1,-2),s=s.replace(/"/g,"'"),i[1]='"'+s+'"}',t=i.join(":");try{n=JSON.parse(t)}catch(n){return e=n,!a&&t}}catch(n){return e=n,!a&&t}}return r=Object.keys(n)[0],o=n[r],s=new Object,s.genus=r,s.species=o,s},checkTaxonNear=function(e,t,a){var n,r,o,i,s;return null==e&&(e=void 0),null==t&&(t=void 0),null==a&&(a="#near-me-container"),null==e?(console.warn("Please specify a taxon."),!1):(null==locationData.last&&getLocation(),(Date.now()-locationData.last)/1e3>900&&getLocation(),n="https://www.inaturalist.org/places.json",r="taxon="+e+"&latitude="+locationData.lat+"&longitude="+locationData.lng+"&place_type=county",i="",o="",s="",$.get(n,r,"json").done(function(e){return Object.size(e)>0?(i="communication:location-on",o="good-location",s="This species occurs in your county"):(i="communication:location-off",o="bad-location",s="This species does not occur in your county")}).fail(function(e,t){return o="bad-location",i="warning",s="We couldn't determine your location"}).always(function(){var e;if(e='<div class="tooltip fade top in right manual-placement-tooltip" role="tooltip" style="top: 6.5em; left: 4em; right:initial; display:none" id="manual-location-tooltip">\n  <div class="tooltip-arrow" style="top:50%;left:5px"></div>\n  <div class="tooltip-inner">'+s+"</div>\n</div>",d$(a).html("<iron-icon icon='"+i+"' class='small-icon "+o+" near-me' data-toggle='tooltip' id='near-me-icon'></iron-icon>"),$(a).after(e).mouseenter(function(){return d$("#manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return d$("#manual-location-tooltip").css("display","none"),!1}),null!=t)return t()}),!1)},insertModalImage=function(t,a,n){var r,o,i,s,l,c,d,u,p,m,h;if(null==t&&(t=_asm.taxonImage),null==a&&(a=_asm.activeTaxon),null==n&&(n=void 0),null==a)return console.error("Tried to insert a modal image, but no taxon was provided!"),!1;if("object"!=typeof a)return console.error("Invalid taxon data type (expecting object), got "+typeof a),h={taxon:a,imageUrl:l,defaultTaxon:_asm.activeTaxon,defaultImage:_asm.taxonImage},console.warn(h),!1;if(u=function(t,a,r){var o,i,s,l,c,d;null==r&&(r="calphoto"),d=t.thumbUri,s=t.imageUri,l="function"==typeof t.imageLinkUri?t.imageLinkUri(t.imageUri):void 0,i=t.imageLicense,o='<div class="modal-img-container">\n  <a href="'+s+'" class="'+r+'-img-anchor center-block text-center">\n    <img src="'+d+'"\n      data-href="'+l+'"\n      class="'+r+'-img-thumb"\n      data-taxon="'+a+'" />\n  </a>\n  <p class="small text-muted text-center">\n    Image by '+t.imageCredit+" under "+i+"\n  </p>\n</div>",d$("#meta-taxon-info").before(o),(c=function(t){try{return d$("#modal-taxon").get(0).fit(),delay(250,function(){return d$("#modal-taxon").get(0).fit(),delay(750,function(){return d$("#modal-taxon").get(0).fit()})})}catch(a){return e=a,t<10?(t++,delay(100,function(){return c(t)})):console.warn("Couldn't execute fit!")}})(0);try{lightboxImages("."+r+"-img-anchor",!0)}catch(t){e=t,console.error("Error lightboxing images")}return"function"==typeof n&&n(),!1},p=[a.genus,a.species],null!=a.subspecies&&p.push(a.subspecies),m=p.join("+"),null!=t.imageUri)return"string"==typeof t&&(l=t,(t=new Object).imageUri=l),c=t.imageUri.split("."),i=c.pop(),d=c.join("."),t.thumbUri=""+uri.urlString+d+"-thumb."+i,t.imageUri=""+uri.urlString+d+"."+i,u(t,m,"asmimg"),!1;r="getthumbinfo=1&num=all&cconly=1&taxon="+m+"&format=xml",o=function(a){var n,o;o=xmlToJSON.parseString(a),window.testData=o;try{n=o.calphotos[0]}catch(t){e=t,n=void 0}if(null==n)return!1;t=new Object;try{if(t.thumbUri=n.thumb_url[0]._text,null==t.thumbUri)return console.warn("CalPhotos didn't return any valid images for this search!"),!1;t.imageUri=n.enlarge_jpeg_url[0]._text,t.imageLinkUri=n.enlarge_url[0]._text,t.imageLicense=n.license[0]._text,t.imageCredit=n.copyright[0]._text+" (via CalPhotos)"}catch(t){return e=t,console.warn("CalPhotos didn't return any valid images for this search!",_asm.affiliateQueryUrl.calPhotos+"?"+r),!1}return u(t,m),!1},s=function(e,t){return insertCORSWorkaround(),console.error("Couldn't load a CalPhotos image to insert!"),!1};try{doCORSget(_asm.affiliateQueryUrl.calPhotos,r,o,s)}catch(t){e=t,console.error(e.message)}return!1},modalTaxon=function(t){var a;return null==t&&(t=void 0),null==t?($(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))}),!1):(animateLoad(),$("#modal-taxon").exists()||(a='<paper-dialog modal id=\'modal-taxon\' entry-animation="scale-up-animation" exit-animation="scale-down-animation">\n  <h2 id="modal-heading"></h2>\n  <paper-dialog-scrollable id=\'modal-taxon-content\'></paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id=\'modal-inat-linkout\'>iNaturalist</paper-button>\n    <paper-button id=\'modal-calphotos-linkout\' class="hidden-xs">CalPhotos</paper-button>\n    <paper-button id=\'modal-alt-linkout\' class="hidden-xs"></paper-button>\n    <paper-button dialog-dismiss autofocus>Close</paper-button>\n  </div>\n</paper-dialog>',$("body").append(a)),$.get(searchParams.targetApi,"q="+t,"json").done(function(n){var r,o,i,s,l,c,d,u,p,m,h,g,f,b;if(null==(o=n.result[0]))return toastStatusMessage("There was an error fetching the entry details. Please try again later."),stopLoadError(),!1;if(f=parseTaxonYear(o.authority_year),b="",!1!==f&&(s="<span class='genus_authority authority'>"+o.genus_authority+"</span> "+f.genus,m="<span class='species_authority authority'>"+o.species_authority+"</span> "+f.species,toInt(o.parens_auth_genus).toBool()&&(s="("+s+")"),toInt(o.parens_auth_species).toBool()&&(m="("+m+")"),b="<div id=\"is-alien-container\" class=\"tooltip-container\"></div>\n<div id='near-me-container' data-toggle='tooltip' data-placement='top' title='' class='near-me tooltip-container'></div>\n<p>\n  <span class='genus'>"+o.genus+"</span>,\n  "+s+";\n  <span class='species'>"+o.species+"</span>,\n  "+m+"\n</p>"),i="",!isNull(o.deprecated_scientific)){i="<p>Deprecated names: ";try{p=JSON.parse(o.deprecated_scientific),c=0,$.each(p,function(e,t){if(1!==++c&&(i+="; "),i+="<span class='sciname'>"+e+"</span>, "+t,c===Object.size(p))return i+="</p>"})}catch(t){e=t,i="",console.error("There were deprecated scientific names, but the JSON was malformed.")}}d="",isNull(o.minor_type)||(d=" <iron-icon icon='arrow-forward'></iron-icon> <span id='taxon-minor-type'>"+o.minor_type+"</span>"),isNull(o.notes)?(o.notes="Sorry, we have no notes on this taxon yet.",o.taxon_credit=""):isNull(o.taxon_credit)||"null"===o.taxon_credit?o.taxon_credit="This taxon information is uncredited.":(g=isNull(o.taxon_credit_date)||"null"===o.taxon_credit_date?"":" ("+o.taxon_credit_date+")",o.taxon_credit="Taxon information by "+o.taxon_credit+"."+g);try{u=markdown.toHTML(o.notes)}catch(t){e=t,u=o.notes,console.warn("Couldn't parse markdown!! "+e.message)}u=u.replace(/\&amp;(([a-z]+|[0-9]+);)/gm,"&$1"),r=isNull(o.major_common_type)?"":" (<span id='taxon-common-type'>"+o.major_common_type+"</span>) ",a="<div id='meta-taxon-info'>\n  "+b+"\n  <p>\n    English name: <span id='taxon-common-name' class='common_name no-cap'>"+smartUpperCasing(o.common_name)+"</span>\n  </p>\n  <p>\n    Type: <span id='taxon-type' class=\"major_type\">"+o.major_type+"</span>\n    "+r+"\n    <iron-icon icon='arrow-forward'></iron-icon>\n    <span id='taxon-subtype' class=\"major_subtype\">"+o.major_subtype+"</span>"+d+"\n  </p>\n  "+i+"\n</div>\n<h3>Taxon Notes</h3>\n<p id='taxon-notes'>"+u+'</p>\n<p class="text-right small text-muted">'+o.taxon_credit+"</p>",$("#modal-taxon-content").html(a),$("#modal-inat-linkout").unbind().click(function(){return openTab(_asm.affiliateQueryUrl.iNaturalist+"?q="+t)}),$("#modal-calphotos-linkout").unbind().click(function(){return openTab(_asm.affiliateQueryUrl.calPhotos+"?rel-taxon=contains&where-taxon="+t)}),h=t.split("+"),_asm.activeTaxon={genus:h[0],species:h[1],subspecies:h[2]},$("#modal-alt-linkout").addClass("hidden").unbind(),formatScientificNames(),doFontExceptions(),l=(l=t.charAt(0).toUpperCase()+t.slice(1)).replace(/\+/g," "),d$("#modal-heading").text(l),isNull(o.image)&&(o.image=void 0),_asm.taxonImage={imageUri:o.image,imageCredit:o.image_credit,imageLicense:o.image_license};try{insertModalImage()}catch(t){e=t,console.info("Unable to insert modal image! ")}return checkTaxonNear(t,function(){var e;return stopLoad(),e=d$("#modal-taxon")[0],d$("#modal-taxon").on("iron-overlay-opened",function(){return e.fit(),e.scrollTop=0,toFloat($(e).css("top").slice(0,-2))>$(window).height()&&$(e).css("top","12.5vh"),delay(250,function(){return e.fit()})}),e.sizingTarget=d$("#modal-taxon-content")[0],safariDialogHelper("#modal-taxon")}),bindDismissalRemoval()}).fail(function(e,t){return stopLoadError()}),!1)},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},doFontExceptions=function(){var e,t;return e=["de","and"],t=function(t){return $.each(e,function(e,a){var n;if(n=" "+a+" ",null!=t)return t=t.replace(n," <span class='force-lower'>"+a+"</span> ")}),t},d$(".authority").each(function(){var e;if(e=$(this).text(),!isNull(e))return $(this).html(t(e))}),!1},sortResults=function(e){return searchParams.result},setHistory=function(e,t,a){return null==e&&(e="#"),null==t&&(t=null),null==a&&(a=null),history.pushState(t,a,e),uri.query=$.url(e).attr("fragment"),!1},clearSearch=function(e){var t;return null==e&&(e=!1),$("#result-count").text(""),t='<div class="bs-callout bs-callout-info center-block col-xs-12 col-sm-8 col-md-5">\n  Search for a common or scientific name above to begin, eg, "Brown Bear" or "<span class="sciname">Ursus arctos</span>"\n</div>',$("#result_container").html(t),$("#result-header-container").attr("hidden","hidden"),!0!==e&&(setHistory(),$(".cndb-filter").attr("value",""),$("#collapse-advanced").collapse("hide"),$("#search").attr("value",""),$("#linnean").polymerSelected("any"),formatScientificNames(),!1)},safariDialogHelper=function(t,a,n){var r,o;if(null==t&&(t="#download-chooser"),null==a&&(a=0),"function"!=typeof n&&(n=function(){return bindDismissalRemoval()}),!(a<10))return stopLoadError("Unable to show dialog. Please try again.");try{try{p$(t).open()}catch(e){d$(t).get(0).open()}return"function"==typeof n&&n(),stopLoad()}catch(i){return e=i,o=a+1,r=250,delay(r,function(){return console.warn("Trying again to display dialog after "+o*r+"ms"),console.debug("Error caught: "+e.message),console.debug(e.stack),safariDialogHelper(t,o,n)})}},safariSearchArgHelper=function(e,t){var a,n;return null==t&&(t=!1),a=null!=e?e:$("#search").val(),n=!1,-1!==a.search(/\+/)&&(n=!0,a=a.replace(/\+/g," ").trim(),delay(100,function(){return safariSearchArgHelper()})),(n||null!=e)&&($("#search").attr("value",a),t||delay(5e3,function(){return safariSearchArgHelper(void 0,!0)})),!1},insertCORSWorkaround=function(){var t,a,n;if(null==_asm.hasShownWorkaround&&(_asm.hasShownWorkaround=!1),_asm.hasShownWorkaround)return!1;try{a=new WhichBrowser}catch(t){return e=t,!1}return a.isType("mobile")?(_asm.hasShownWorkaround=!0,!1):(t=function(){switch(a.browser.name){case"Chrome":return"Install the extension \"<a class='alert-link' href='https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?utm_source=chrome-app-launcher-info-dialog'>Allow-Control-Allow-Origin: *</a>\", activate it on this domain, and you'll see them in your popups!";case"Firefox":return"Follow the instructions <a class='alert-link' href='http://www-jo.se/f.pfleger/forcecors-workaround'>for this ForceCORS add-on</a>, or try Chrome for a simpler extension. Once you've done so, you'll see photos in your popups!";case"Internet Explorer":return"Follow these <a class='alert-link' href='http://stackoverflow.com/a/20947828'>StackOverflow instructions</a> while on this site, and you'll see them in your popups!";default:return""}}(),n='<div class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Want CalPhotos images in your species dialogs?</strong> '+t+"\n  We're working with CalPhotos to enable this natively, but it's a server change on their side.\n</div>",$("#result_container").before(n),$(".alert").alert(),_asm.hasShownWorkaround=!0,!1)},showBadSearchErrorMessage=function(e){var t,a,n,r;try{n=e.query.replace(/\+/g," ")}catch(e){n=$("#search").val()}try{!0===e.status?!0===e.query_params.filter.had_filter?(t="",a=0,$.each(e.query_params.filter.filter_params,function(n,r){if("BOOLEAN_TYPE"!==n)return 0!==a&&(t=filter_text+" "+e.filter.filter_params.BOOLEAN_TYPE),isNumber(toInt(r,!0))&&(r=1===toInt(r)?"true":"false"),t=t+" "+n.replace(/_/g," ")+" is "+r}),r='"'+n+'" where '+t+" returned no results."):r='"'+n+'" returned no results.':r=e.human_error}catch(e){r="Sorry, there was a problem with your search"}return stopLoadError(r)},bindPaperMenuButton=function(e,t){return null==e&&(e="paper-menu-button"),null==t&&(t=!0),!1},getRandomEntry=function(){var e;return startLoad(),e={random:!0},$.get(searchParams.apiPath,buildQuery(e,"json")).done(function(e){var t,a;return(isNull(e.genus)||isNull(e.species))&&stopLoadError("Unable to fetch random entry"),t={genus:e.genus,species:e.species},isNull(e.subspecies)||(t.subspecies=e.subspecies),a=uri.urlString+"species-account.php?"+buildQuery(t),console.log("About to go to",a),goTo(a),stopLoad()}).fail(function(){return stopLoadError("Unable to fetch random entry")}),!1},window.getRandomEntry=getRandomEntry,doLazily=function(){return!0!==("undefined"!=typeof _asm&&null!==_asm?_asm.hasDoneLazily:void 0)&&("object"!=typeof _asm&&(window._asm=new Object),_asm.hasDoneLazily=!0,loadJS(uri.urlString+"js/download.min.js",function(){var e;return e='<paper-icon-button\n  icon="icons:cloud-download"\n  class="click"\n  data-fn="showDownloadChooser"\n  title="Download Copy"\n  data-toggle="tooltip"\n  >\n</paper-icon-button>',$("#git-footer").prepend(e),bindClicks(),mobileCollapsable(),loadJS(uri.urlString+"js/terminal.min.js",function(){return bindClicks(),console.debug("Terminal file loaded"),stopLoad()}),!1})),!1},mobileCollapsable=function(e,t,a){var n,r,o;if(null==e&&(e=".search-options-panel"),null==t&&(t=null!=(o="undefined"!=typeof _asm&&null!==_asm?_asm.mobileBreakpoint:void 0)?o:767),null==a&&(a=250),console.debug("Checking mobile status"),$(window).width()<=t){if("object"!=typeof("undefined"!=typeof core&&null!==core?core.debouncers:void 0)&&("object"!=typeof core&&(window.core=new Object),core.debouncers=new Object),null!=core.debouncers.mobileCollapsable){if(Date.now()-core.debouncers.mobileCollapsable<=a)return!1;delete core.debouncers.mobileCollapsable,clearTimeout(core.debouncers.mobileCollapseableTimeout)}return core.debouncers.mobileCollapsable=Date.now(),n=2*a,core.debouncers.mobileCollapseableTimeout=delay(n,function(){return delete core.debouncers.mobileCollapsable}),$(e).find("section").collapse(),r=!1,$($(e).find("section").get(0)).on("shown.bs.collapse",function(){return r||(delay(50,function(){var t,a,n,r,o;for(r=[],a=0,t=(n=$(e).find("section")).length;a<t;a++)o=n[a],r.push($(o).collapse("hide"));return r}),r=!0),!1}),$(e).find("legend").text("Show Options").addClass("btn btn-default").click(function(){var t;return t=!$(e).find("section").hasClass("in"),t?($(this).text("Hide Options"),$(e).find("section").collapse("show")):($(this).text("Show Options"),$(e).find("section").collapse("hide"))}),!0}return console.debug("Not a mobile viewport"),!1},$(function(){var t,a,n,r,o,i,s,l,c,d,u,p,m,h,g,f,b;if(a="****************************************************************************\nHello developer!\nIf you're looking for hints on our API information, this site is open-source\nand released under the GPL. Just click on the GitHub link on the bottom of\nthe page, or check out LINK_TO_ORG_REPO\n****************************************************************************",console.log(a),_asm.polymerReady=!1,s=["admin-login.php","admin-page.html","admin-page.php"],p=uri.o.attr("file"),indexOf.call(s,p)>=0){try{(h=function(){var e;try{if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0))return Polymer.Base.ready(function(){return _asm.polymerReady=!0}),delay(250,function(){return _asm.polymerReady=!0});throw{message:"POLYMER_NOT_READY"}}catch(e){return delay(100,function(){return h})}})()}catch(e){}return!1}if(animateLoad(),window.addEventListener("popstate",function(e){var t,a;uri.query=$.url().attr("fragment");try{t=Base64.decode(uri.query)}catch(e){e,t=""}return performSearch.debounce(50,null,null,t),a=t.split("&")[0],$("#search").attr("value",a)}),$("#do-reset-search").click(function(){return clearSearch()}),$("#search_form").submit(function(e){return e.preventDefault(),performSearch.debounce(50)}),$("#collapse-advanced").on("shown.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-less")}),$("#collapse-advanced").on("hidden.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-more")}),$("#search_form").keypress(function(e){if(13===e.which)return performSearch.debounce(50)}),$("#do-search").click(function(){return performSearch.debounce(50)}),$("#do-search-all").click(function(){return performSearch.debounce(50,null,null,!0)}),$("#linnean").on("iron-select",function(){if(!isNull($("#search").val()))return performSearch.debounce()}),eutheriaFilterHelper(),bindPaperMenuButton(),isNull(uri.query)){l="";try{(h=function(){var e;try{if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0))return Polymer.Base.ready(function(){return _asm.polymerReady=!0}),delay(250,function(){return _asm.polymerReady=!0});throw{message:"POLYMER_NOT_READY"}}catch(e){return delay(100,function(){return h})}})()}catch(e){}}else try{l=Base64.decode(uri.query),u=$.url(searchParams.apiPath+"?q="+l);try{c=u.param("loose").toBool()}catch(t){e=t,c=!1}try{i=u.param("fuzzy").toBool()}catch(t){e=t,i=!1}f=l.split("&")[0],safariSearchArgHelper(f),(o=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return _asm.polymerReady=!0,delay(250,function(){if(c&&d$("#loose").attr("checked","checked"),i)return d$("#fuzzy").attr("checked","checked")}),!1;if(null==_asm.stateIter&&(_asm.stateIter=0),++_asm.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return _asm.polymerReady=!0,delay(250,function(){return console.info("Doing a late Polymer.Base.ready call"),c&&d$("#loose").attr("checked","checked"),i&&d$("#fuzzy").attr("checked","checked"),safariSearchArgHelper(),eutheriaFilterHelper()})})}catch(e){return delay(250,function(){return o()})}})();try{n=u.param("filter"),r=JSON.parse(Base64.decode(n)),d=!1,g=["simple-linnean-group","simple-linnean-subgroup","linnean-family","type","BOOLEAN-TYPE"];for(t in r)b=r[t],m=".cndb-filter[data-column='"+(t=t.replace(/_/g,"-"))+"']",indexOf.call(g,t)<0?(console.debug("Col '"+t+"' is not a simple filter"),$(m).attr("value",b),d=!0):$(".cndb-filter[data-column='"+t+"']").polymerSelected(b);d&&$("#collapse-advanced").collapse("show")}catch(t){e=t,n=!1}}catch(t){e=t,console.error("Bad argument "+uri.query+" => "+l+", looseState, fuzzyState",c,i,searchParams.apiPath+"?q="+l),console.warn(e.message),l=""}if(isNull(l)||"#"===l)return stopLoad(),$("#search").attr("disabled",!1),(o=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return _asm.polymerReady=!0,delay(250,function(){return d$("#loose").attr("checked","checked"),eutheriaFilterHelper()}),!1;if(null==_asm.stateIter&&(_asm.stateIter=0),++_asm.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return _asm.polymerReady=!0,delay(250,function(){return d$("#loose").attr("checked","checked"),eutheriaFilterHelper()})})}catch(e){return delay(250,function(){return o()})}})();try{searchParams.lastSearch=l}catch(e){}return $.get(searchParams.targetApi,"q="+l,"json").done(function(e){return _asm.polymerReady=!0,console.debug("Server query got",e),!0===e.status&&e.count>0?(console.log("Got a valid result, formatting "+e.count+" results."),formatSearchResults(e,void 0,function(){return console.log("Format results finished, checking lagged update"),checkLaggedUpdate(e)}),!1):(console.warn("Bad initial search"),showBadSearchErrorMessage.debounce(null,null,null,e),console.error(e.error),console.warn(e))}).fail(function(e,t){return console.error("There was an error loading the generic table"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't load table - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){return $("#search").attr("disabled",!1),!1})});var adminParams,adminPreloadSearch,createDuplicateTaxon,createNewTaxon,deleteTaxon,deprecatedHelper,fetchEditorDropdownContent,fillEmptyCommonName,handleDragDropImage,licenseHelper,loadAdminUi,loadModalTaxonEditor,lookupEditorSpecies,newColumnHelper,prefetchEditorDropdowns,renderAdminSearchResults,renderDeprecatedFromDatabase,saveEditorEntry,validateCitation,validateNewTaxon,verifyLoginCredentials,indexOf=[].indexOf||function(e){for(var t=0,a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1};(adminParams=new Object).apiTarget="admin-api.php",adminParams.adminPageUrl="https://mammaldiversity.org/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=adminParams.loginDir+"async_login_handler.php",loadAdminUi=function(){var e;console.log("Loading admin UI");try{verifyLoginCredentials(function(e){var t,a,n,r;return a=uri.domain+"_name",t=uri.domain+"_fullname",adminParams.cookieName=a,adminParams.cookieFullName=t,n='<h3 class="col-xs-12">\n  Welcome, '+$.cookie(a)+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'settings-applications\' class=\'click\' data-url=\''+e.login_url+'\'></paper-icon-button>\n  </span>\n  <span id="pib-wrapper-exit-to-app" class="pib-wrapper" data-toggle="tooltip" title="Go to SADB app" data-placement="bottom">\n    <paper-icon-button icon=\'exit-to-app\' class=\'click\' data-url=\''+uri.urlString+"' id=\"app-linkout\"></paper-icon-button>\n  </span>\n</h3>\n<div id='admin-actions-block' class=\"col-xs-12\">\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</div>",$("main #main-body").html(n),bindClicks(),r='<form id="admin-search-form" onsubmit="event.preventDefault()" class="row">\n  <div class="col-xs-7 col-sm-8">\n    <paper-input label="Search for species" id="admin-search" name="admin-search" required autofocus floatingLabel></paper-input>\n  </div>\n  <div class="col-xs-2 col-lg-1">\n    <paper-fab id="do-admin-search" icon="search" raisedButton class="asm-blue"></paper-fab>\n  </div>\n  <div class="col-xs-2 col-lg-1">\n    <paper-fab id="do-admin-add" icon="add" raisedButton class="asm-blue" title="Create New Taxon" data-toggle="tooltip"></paper-fab>\n  </div>\n  <div class="col-offset-lg-2">\n    \x3c!-- Placeholder --\x3e\n  </div>\n</form>\n<div id=\'search-results\' class="row"></div>',$("#admin-actions-block").html("<div class='col-xs-12'>"+r+"</div>"),$("#admin-search-form").submit(function(e){return e.preventDefault()}),$("#admin-search").keypress(function(e){if(13===e.which)return renderAdminSearchResults()}),$("#do-admin-search").click(function(){return renderAdminSearchResults()}),$("#do-admin-add").click(function(){return createNewTaxon()}),bindClickTargets(),console.info("Successfully validated user"),!1})}catch(t){e=t,console.error("Couldn't check status - "+e.message),console.warn(e.stack),$("main #main-body").html("<div class='bs-callout bs-callout-danger col-xs-12'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},verifyLoginCredentials=function(e){var t,a,n,r,o;try{n=$.cookie(uri.domain+"_auth"),o=$.cookie(uri.domain+"_secret"),r=$.cookie(uri.domain+"_link")}catch(e){a=e,console.warn("Unable to verify login credentials: "+a.message),console.debug(a.stack)}return t="hash="+n+"&secret="+o+"&dblink="+r,$.post(adminParams.loginApiTarget,t,"json").done(function(t){var a;return console.log("Server called back from login credential verification",t),!0!==t.status?($(".logged-in-values").remove(),"function"==typeof e&&!0!==_asm.inhibitRedirect?isNull(t.login_url)?$("main #main-body").html("<div class='bs-callout-danger bs-callout col-xs-12'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p><p>The server said:</p><code>"+t.error+"</code></div>"):goTo(t.login_url):console.log("Login credentials checked -- not logged in")):($(".logged-in-values").removeAttr("hidden"),$(".logged-in-hidden").attr("hidden","hidden"),a=uri.domain+"_fullname",$("header .fill-user-fullname").text($.cookie(a)),"function"==typeof e?e(t):void 0)}).fail(function(e,t){return $("main #main-body").html("<div class='bs-callout-danger bs-callout col-xs-12'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p></div>"),console.log(e,t),!1}),!1},renderAdminSearchResults=function(e,t){var a,n,r,o;if(null==t&&(t="#search-results"),o=$("#admin-search").val(),isNull(o)){if("object"!=typeof e)return toastStatusMessage("Please enter a search term"),!1;o=e.genus+" "+e.species}return animateLoad(),$("#admin-search").blur(),o=o.replace(/\./g,""),o=prepURI(o.toLowerCase()),a="q="+o+"&loose=true",n=Base64.encodeURI(o),r=uri.urlString+"#"+n,$("#app-linkout").attr("data-url",r),$.get(searchParams.targetApi,a,"json").done(function(e){var a,n,r,i,s,l,c,d,u,p,m,h,g,f,b,y,w,v,x,_,k,S,C,L,T,N;if(!0!==e.status||0===e.count)return stopLoadError(),toastStatusMessage(isNull(e.human_error)?"Your search returned no results. Please try again.":e.human_error),!1;i=e.result,l="",c="<table id='cndb-result-list' class='table table-striped table-hover'>\n\t<thead class='cndb-row-headers'>",C=toInt(e.count)-1,r=null,a=0,k=["id","genus","species","subspecies"],v=i,i=new Object;for(u in v)for(S=v[u],i[u]=new Object,b=0,f=k.length;b<f;b++)h=k[b],i[u][h]=S[h];for(u in i){if(S=i[u],0===toInt(u)){p=0,c+="\n\x3c!-- Table Headers - "+Object.size(S)+" entries --\x3e",console.debug("Got row",S);for(m in S)S[m],w=m.replace(/_/g," "),"genus"!==m&&"species"!==m&&"subspecies"!==m||(c+="\n\t\t<th class='text-center'>"+w+"</th>",a++),++p===Object.size(S)&&(c+="\n\t\t<th class='text-center'>Edit</th>",a++,c+="\n\t\t<th class='text-center'>Delete</th>",a++,c+="\n\t\t<th class='text-center'>View</th>\n\t</thead>",a++,c+="\n\x3c!-- End Table Headers --\x3e",console.log("Got "+a+" display columns."),r="col-md-"+roundNumber(12/a,0))}T=S.genus.trim()+"+"+S.species.trim(),isNull(S.subspecies)||(T=T+"+"+S.subspecies.trim()),d="\n\t<tr id='cndb-row"+u+"' class='cndb-result-entry' data-taxon=\""+T+'">',g=0;for(m in S){if(n=S[m],isNull(S.genus))return!0;"genus"!==m&&"species"!==m&&"subspecies"!==m||(d+="\n\t\t<td id='"+m+"-"+u+"' class='"+m+" "+r+"'><span>"+n+"</span></td>"),++g===Object.size(S)&&(d+="\n\t\t<td id='edit-"+u+"' class='edit-taxon "+r+" text-center'><paper-icon-button icon='image:edit' class='edit' data-taxon='"+T+"'></paper-icon-button></td>",d+="\n\t\t<td id='delete-"+u+"' class='delete-taxon "+r+" text-center'><paper-icon-button icon='icons:delete-forever' class='delete-taxon-button fadebg' data-taxon='"+T+"' data-database-id='"+S.id+"'></paper-icon-button></td>",d+="\n\t\t<td id='visit-listing-"+u+"' class='view-taxon "+r+" text-center'><paper-icon-button icon='icons:visibility' class='view-taxon-button fadebg click' data-href='"+uri.urlString+"species-account.php?genus="+S.genus.trim()+"&species="+S.species.trim()+"' data-newtab='true'></paper-icon-button></td>",l+=d+="\n\t</tr>")}if(toInt(u)===C){l=c+l+"</table>",$(t).html(l),console.log("Processed "+(toInt(u)+1)+" rows"),$(".edit").click(function(){var e;return e=$(this).attr("data-taxon"),lookupEditorSpecies(e)}),$(".delete-taxon-button").click(function(){var e;return $(this).attr("data-taxon"),e=$(this).attr("data-database-id"),deleteTaxon(e)}),bindClicks();try{L={genus:(N=o.split(" "))[0],species:null!=(x=N[1])?x:"",subspecies:null!=(_=N[2])?_:""},s=jsonTo64(L);try{y=uri.o.attr("base")+uri.o.attr("path"),setHistory(y+"#"+s)}catch(e){}}catch(e){}stopLoad()}}}).fail(function(e,t){var a;return console.error("There was an error performing the search"),console.warn(e,a,e.statusText),a=e.status+"::"+e.statusText,stopLoadError("Couldn't execute the search - "+a)})},fetchEditorDropdownContent=function(e,t,a,n){var r;return null==e&&(e="simple_linnean_goup"),null==a&&(a=!0),null==n&&(n=!0),"object"!=typeof("undefined"!=typeof _asm&&null!==_asm?_asm.dropdownPopulation:void 0)&&("object"!=typeof _asm&&(window._asm=new Object),_asm.dropdownPopulation=new Object),r=e.replace(/\_/g,"-"),isNull(t)&&(t=e.replace(/\_/g," ").toTitleCase()),_asm.dropdownPopulation[e]={html:'<paper-input label="'+t+'" id="edit-'+r+'" name="edit-'+r+'" class="'+e+'" floatingLabel></paper-input>'},$.get(searchParams.targetApi,"get_unique=true&col="+e,"json").done(function(o){var i,s,l,c,d,u,p;if(!0!==o.status)return console.warn("Didn't get a valid set of values for column '"+e+"': "+o.error),!1;for(l="",c=0,s=(p=Object.toArray(o.values)).length;c<s;c++)l+='<paper-item data-value="'+(u=p[c])+'" data-column="'+e+'">'+u+"</paper-item>\n";return i='<section class="row filled-editor-dropdown">\n<div class="col-xs-9">\n  <paper-dropdown-menu label="'+t+'" id="edit-'+r+'" name="edit-'+r+'" class="'+e+'" data-column="'+e+'">\n    <paper-listbox class="dropdown-content">\n      '+l+'\n    </paper-listbox>\n  </paper-dropdown-menu>\n</div>\n<div class="col-xs-3">\n  <paper-icon-button class="add-col-value" data-column='+e+' icon="icons:add-circle" title="Add new '+t+'" data-toggle="tooltip"></paper-icon-button>\n</div>\n</section>',n&&(_asm.dropdownPopulation[e]={values:p,html:i,selector:"#edit-"+r}),a&&(d="#edit-"+r,$(d).exists()&&$(d).replaceWith(i)),!1}).fail(function(a,n){return console.warn("Unable to get dropdown content for '"+e+"'"),console.warn(a,n),_asm.dropdownPopulation[e]={html:'<paper-input label="'+t+'" id="edit-'+r+'" name="edit-'+r+'" class="'+e+'" floatingLabel></paper-input>'}}),!1},licenseHelper=function(e){return null==e&&(e="#edit-image-license-dialog"),$(e).unbind(),_asm._setLicenseDialog=function(t){var a,n,r,o,i;return o=$(t).attr("data-column"),isNull(o)?(console.error("Unable to show dialog -- invalud column designator"),!1):(console.debug("Add column fired -- target is "+o),$("paper-dialog#set-license-value").remove(),a=$(e).attr("data-license-name"),n=$(e).attr("data-license-url"),r='<paper-dialog id="set-license-value" data-column="'+o+'" modal>\n  <h2>Set License</h2>\n  <paper-dialog-scrollable>\n    <paper-input class="new-license-name license-field" label="License Name" floatingLabel autofocus value="'+a+'" required autovalidate></paper-input>\n    <paper-input class="new-license-url license-field" label="License URL" floatingLabel value="'+n+'" required autovalidate></paper-input>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Cancel</paper-button>\n    <paper-button class="add-value">Set</paper-button>\n  </div>\n</paper-dialog>',$("body").append(r),i="((?:https?)://(?:(?:(?:[0-9]+\\.){3}[0-9]+|(?:[0-9a-f]+:){6,8}|(?:[\\w~\\-]{2,}\\.)+[\\w]{2,}|localhost))/?(?:[\\w~\\-]*/?)*(?:(?:\\.\\w+)?(?:\\?(?:\\w+=\\w+&?)*)?))(?:#[\\w~\\-]+)?",p$("paper-input.new-license-url").pattern=i,p$("paper-input.new-license-url").errorMessage="This must be a valid URL",p$("paper-input.new-license-name").errorMessage="This cannot be empty",_asm._updateLicense=function(){var e;return $("paper-icon-button#edit-image-license-dialog").attr("data-license-name",p$("paper-input.new-license-name").value).attr("data-license-url",p$("paper-input.new-license-url").value),e=p$("paper-input.new-license-name").value+" @ "+p$("paper-input.new-license-url").value,p$("#edit-image-license").value=e,$("#edit-image-license").attr("data-license-name",p$("paper-input.new-license-name").value).attr("data-license-url",p$("paper-input.new-license-url").value),p$("#set-license-value").close(),!1},$("#set-license-value paper-button.add-value").click(function(){var e,t,a,n,r;for(t=!0,n=0,a=(r=$("#set-license-value .license-field")).length;n<a;n++)e=r[n],p$(e).validate(),p$(e).invalid&&(t=!1);if(!t)return!1;console.debug("isReady",t);try{_asm._updateLicense.debounce(50)}catch(e){console.warn("Couldn't debounce save new col call"),stopLoadError("There was a problem saving this data")}return!1}),$("#set-license-value").on("iron-overlay-opened",function(){return p$(this).refit(),delay(100,function(e){return function(){return p$(e).refit()}}(this))}),p$("#set-license-value").open(),!1)},$(e).click(function(){return console.debug("Set License clicked"),_asm._setLicenseDialog.debounce(50,null,null,this),!1})},newColumnHelper=function(e){return null==e&&(e=".add-col-value"),$(e).unbind(),_asm._addColumnDialog=function(e){var t,a;return a=$(e).attr("data-column"),isNull(a)?(console.error("Unable to show dialog -- invalud column designator"),!1):(console.debug("Add column fired -- target is "+a),$("paper-dialog#add-column-value").remove(),t='<paper-dialog id="add-column-value" data-column="'+a+'" modal>\n  <h2>Add New <code>'+a.replace(/[\_-]/g," ")+'</code> Value</h2>\n  <paper-dialog-scrollable>\n    <paper-input class="new-col-value" label="Data Value" floatingLabel autofocus></paper-input>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Cancel</paper-button>\n    <paper-button class="add-value">Add</paper-button>\n  </div>\n</paper-dialog>',$("body").append(t),_asm._saveNewCol=function(){var e,t,n;return n=$("#add-column-value paper-input.new-col-value").val(),console.log("Going to test and add '"+n+"'"),indexOf.call(_asm.dropdownPopulation[a].values,n)>=0?(console.warn("Invalid value: already exists"),p$("#add-column-value paper-input.new-col-value").errorMessage="This value already exists",p$("#add-column-value paper-input.new-col-value").invalid=!0,p$("#add-column-value").refit(),!1):((e=document.createElement("paper-item")).setAttribute("data-value",n),e.setAttribute("data-column",a),e.textContent=n,'<paper-item data-value="'+n+'" data-column="'+a+'">'+n+"</paper-item>\n",_asm.dropdownPopulation[a].values.push(n),_asm.dropdownPopulation[a].values.sort(),t=p$("paper-dropdown-menu[data-column='"+a+"'] paper-listbox"),Polymer.dom(t).appendChild(e),delay(250,function(){return $("paper-dropdown-menu[data-column='"+a+"']").polymerSelected(n,!0),p$("#add-column-value").close()}),!1)},$("#add-column-value paper-button.add-value").click(function(){try{_asm._saveNewCol.debounce(50)}catch(e){console.warn("Couldn't debounce save new col call"),stopLoadError("There was a problem saving this data")}return!1}),$("#add-column-value paper-input").keyup(function(e){if(13===(e.keyCode?e.keyCode:e.which))try{_asm._saveNewCol.debounce(50)}catch(e){console.warn("Couldn't debounce save new col call"),stopLoadError("There was a problem saving this data")}return!1}),p$("#add-column-value").open(),!1)},$(e).click(function(){return console.debug("Add column clicked"),_asm._addColumnDialog.debounce(50,null,null,this),!1})},prefetchEditorDropdowns=function(){var e,t;t={major_type:"Clade (eg., boreoeutheria)",major_subtype:"Sub-Clade (eg., euarchontoglires)",linnean_order:null,linnean_family:null,simple_linnean_group:"Common Group (eg., metatheria)",simple_linnean_subgroup:"Common type (eg., bat)"};for(e in t)fetchEditorDropdownContent(e,t[e]);return!1},window.prefetchEditorDropdowns=prefetchEditorDropdowns,loadModalTaxonEditor=function(e,t){var a,n,r;null==e&&(e=""),null==t&&(t="Save"),r=(new Date).toISOString().split("T")[0],n='<paper-dialog modal id=\'modal-taxon-edit\' entry-animation="scale-up-animation" exit-animation="fade-out-animation">\n  <h2 id="editor-title">Taxon Editor</h2>\n  <paper-dialog-scrollable id=\'modal-taxon-editor\'>\n    '+('<paper-input label="Genus" id="edit-genus" name="edit-genus" class="genus" floatingLabel></paper-input>\n<paper-input label="Species" id="edit-species" name="edit-species" class="species" floatingLabel></paper-input>\n<paper-input label="Subspecies" id="edit-subspecies" name="edit-subspecies" class="subspecies" floatingLabel></paper-input>\n<paper-input label="Common Name" id="edit-common-name" name="edit-common-name"  class="common_name" floatingLabel></paper-input>\n<paper-input label="Common Name Source" id="edit-common-name-source" name="edit-common-name-source"  class="common_name_source" floatingLabel readonly></paper-input>\n<div class="row">\n  <paper-input label="Deprecated Scientific Names" id="edit-deprecated-scientific" name="edit-depreated-scientific" floatingLabel aria-describedby="deprecatedHelp" data-column="deprecated_scientific" class="col-xs-10" readonly></paper-input>\n  <div class="col-xs-2">\n    <paper-icon-button icon="icons:create" id="fire-deprecated-editor" title="Edit deprecated scientifics" data-toggle="tooltip"></paper-icon-button>\n  </div>\n  <span class="help-block col-xs-12" id="deprecatedHelp">Click the edit button to fill the old names.</span>\n</div>\n'+_asm.dropdownPopulation.major_type.html+"\n"+_asm.dropdownPopulation.major_subtype.html+"\n"+_asm.dropdownPopulation.linnean_order.html+"\n"+_asm.dropdownPopulation.linnean_family.html+"\n"+_asm.dropdownPopulation.simple_linnean_group.html+"\n"+_asm.dropdownPopulation.simple_linnean_subgroup.html+'\n<paper-input label="Genus authority" id="edit-genus-authority" name="edit-genus-authority" class="genus_authority" floatingLabel></paper-input>\n<paper-input label="Genus authority year" id="edit-gauthyear" name="edit-gauthyear" floatingLabel></paper-input>\n<paper-input label="Genus authority citation" id="edit-genus-authority-citation" name="edit-genus-authority-citation" class="citation-input" floatingLabel></paper-input>\n<iron-label>\n  Use Parenthesis for Genus Authority\n  <paper-toggle-button id="genus-authority-parens"  checked="false"></paper-toggle-button>\n</iron-label>\n<paper-input label="Species authority" id="edit-species-authority" name="edit-species-authority" class="species_authority" floatingLabel></paper-input>\n<paper-input label="Species authority year" id="edit-sauthyear" name="edit-sauthyear" floatingLabel></paper-input>\n<paper-input label="Species authority citation" id="edit-species-authority-citation" name="edit-species-authority-citation" class="citation-input" floatingLabel></paper-input>\n<iron-label>\n  Use Parenthesis for Species Authority\n  <paper-toggle-button id="species-authority-parens" checked="false"></paper-toggle-button>\n</iron-label>\n<br/><br/>\n<paper-input label="ASM ID Number" id="edit-internal-id" name="edit-internal-id" floatingLabel></paper-input>\n<br/>\n<span class="help-block" id="notes-help">You can write your notes and entry in Markdown. (<a href="https://daringfireball.net/projects/markdown/syntax" "onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'">Official Full Syntax Guide</a>)</span>\n<br/><br/>\n<h3 class=\'text-muted\'>Taxon Notes <small>(optional)</small></h3>\n<iron-autogrow-textarea id="edit-notes" rows="5" aria-describedby="notes-help" placeholder="Notes" class="markdown-region"  data-md-field="notes-markdown-preview">\n  <textarea placeholder="Notes" id="edit-notes-textarea" name="edit-notes-textarea" aria-describedby="notes-help" rows="5"></textarea>\n</iron-autogrow-textarea>\n<marked-element id="notes-markdown-preview" class="markdown-preview">\n  <div class="markdown-html"></div>\n</marked-element>\n<br/><br/>\n<h3 class=\'text-muted\'>Main Taxon Entry</h3>\n<iron-autogrow-textarea id="edit-entry" rows="5" aria-describedby="notes-help" placeholder="Entry" class="markdown-region" data-md-field="entry-markdown-preview">\n  <textarea placeholder="Entry" id="edit-entry-textarea" name="edit-entry-textarea" aria-describedby="entry-help" rows="5"></textarea>\n</iron-autogrow-textarea>\n<marked-element id="entry-markdown-preview" class="markdown-preview">\n  <div class="markdown-html"></div>\n</marked-element>\n<paper-input label="Data Source" id="edit-source" name="edit-source" floatingLabel></paper-input>\n<paper-input label="Data Citation" id="edit-citation" name="edit-citation" floatingLabel></paper-input>\n<div id="upload-image"></div>\n<span class="help-block" id="upload-image-help">You can drag and drop an image above, or enter its server path below.</span>\n<paper-input label="Image" id="edit-image" name="edit-image" floatingLabel aria-describedby="imagehelp"></paper-input>\n  <span class="help-block" id="imagehelp">The image path here should be relative to the <code>public_html/</code> directory. Check the preview below.</span>\n<paper-input label="Image Caption" id="edit-image-caption" name="edit-image-caption" floatingLabel></paper-input>\n<paper-input label="Image Credit" id="edit-image-credit" name="edit-image-credit" floatingLabel></paper-input>\n<section class="row license-region">\n  <div class="col-xs-9">\n    <paper-input label="Image License" id="edit-image-license" name="edit-image-license" data-license-name="" data-license-url="" floatingLabel readonly></paper-input>\n  </div>\n  <div class="col-xs-3">\n    <paper-icon-button icon="icons:create" id="edit-image-license-dialog" data-license-name="" data-license-url="" data-column="image_license" data-toggle=\'tooltip\' title="Edit License"></paper-icon-button>\n  </div>\n</section>\n<paper-input label="Taxon Credit" id="edit-taxon-credit" name="edit-taxon-credit" floatingLabel aria-describedby="taxon-credit-help" value="'+$.cookie(adminParams.cookieFullName)+'"></paper-input>\n<paper-input label="Taxon Credit Date" id="edit-taxon-credit-date" name="edit-taxon-credit-date" floatingLabel value="'+r+'"></paper-input>\n<span class="help-block" id="taxon-credit-help">This will be displayed as "Entry by <span class=\'taxon-credit-preview\'></span> on <span class=\'taxon-credit-date-preview\'></span>."</span>\n'+e+'\n<input type="hidden" name="edit-taxon-author" id="edit-taxon-author" value="" />')+"\n  </paper-dialog-scrollable>\n  <div class=\"buttons\">\n    <paper-button id='close-editor' dialog-dismiss>Cancel</paper-button>\n    <paper-button id='duplicate-taxon'>Duplicate</paper-button>\n    <paper-button id='save-editor'>"+t+"</paper-button>\n  </div>\n</paper-dialog>",$("#modal-taxon-edit").exists()&&$("#modal-taxon-edit").remove(),$("#search-results").after(n);try{newColumnHelper()}catch(e){a=e,console.warn("Couldn't bind columns: "+a.message),console.warn(a.stack)}try{licenseHelper()}catch(e){a=e,console.warn("Couldn't set license helper: "+a.message),console.warn(a.stack)}try{deprecatedHelper(),$("#fire-deprecated-editor").click(function(){var e;return e=p$("#edit-deprecated-scientific"),_asm._setDeprecatedDialog.debounce(null,null,null,e)})}catch(e){a=e,console.warn("Couldn't set deprecated helper: "+a.message),console.warn(a.stack)}try{$(".citation-input").keyup(function(){return validateCitation(this)})}catch(e){}return handleDragDropImage(),$("#modal-taxon-edit").unbind(),d$("#save-editor").unbind(),d$("#duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})},deprecatedHelper=function(e){return null==e&&(e="#edit-deprecated-taxon-dialog"),$(e).unbind(),_asm._setDeprecatedDialog=function(e){var t,a,n,r,o,i,s,l,c,d,u,p,m,h;return h=$(e).attr("data-column"),isNull(h)?(console.error("Unable to show dialog -- invalud column designator"),!1):(console.debug("Setup deprecated fired -- target is "+h),r="#set-deprecated-taxa",$(r).remove(),a={genus:null!=(l=p$("#edit-genus").value)?l:"",species:null!=(c=p$("#edit-species").value)?c:""},n={genus:{authority:null!=(d=p$("#edit-genus-authority").value)?d:"",year:null!=(u=p$("#edit-gauthyear").value)?u:"",parens:p$("#genus-authority-parens").checked?"checked":""},species:{authority:null!=(p=p$("#edit-species-authority").value)?p:"",year:null!=(m=p$("#edit-gauthyear").value)?m:"",parens:p$("#species-authority-parens").checked?"checked":""}},_asm._updateDeprecatedListItem=function(e){var t,a,n,r,o,i,s,l;null==e&&(e=void 0),isNull(e)&&(e=$("#deprecated-taxon-json").val());try{r=JSON.parse(decode64(e)),console.log("Rendering with",r),i=new Array;for(s in r){a=r[s];try{s=s.replace(/\-/g," ")}catch(e){}l=" "+s+' <iron-icon icon="icons:arrow-forward"></iron-icon> '+(t=a.split(":"))[0].toTitleCase()+" in "+t[1],i.push(l)}o="<li>"+i.join("</li>\n<li>")+"</li>"}catch(e){n=e,console.warn("Didn't parse JSON: "+n.message),console.warn(n.stack),o="<em>No deprecated identifiers</em>"}return o},i=$("#edit-deprecated-scientific").attr("data-json"),s=_asm._updateDeprecatedListItem(i),o='<paper-dialog id="'+r.slice(1)+'" data-column="'+h+'" modal>\n  <h2>Set Deprecated Taxa</h2>\n  <paper-dialog-scrollable>\n    <div class="row">\n      <h3 class="col-xs-12">Alternate Taxon Names</h3>\n      <ul id="deprecated-taxon-list" class="col-xs-11 col-xs-offset-1">\n        '+s+'\n      </ul>\n      <input type="hidden" value="'+i+'" id="deprecated-taxon-json"/>\n    </div>\n    <div class="form">\n      <div class="row update-old-taxon">\n        <paper-input class="col-xs-12" value="'+a.genus+'" label="Old Genus" placeholder="'+a.genus+'" id="dialog-update-genus" required autovalidate></paper-input>\n        <paper-input class="col-xs-12" value="'+a.species+'" label="Old Species" placeholder="'+a.species+'" id="dialog-update-species" required autovalidate></paper-input>\n        <paper-input class="col-xs-6" value="'+n.genus.authority+'" label="Old Authority" placeholder="'+n.genus.authority+'" required autovalidate floatingLabel id="dialog-update-authority"></paper-input>\n        <paper-input class="col-xs-6" value="'+n.genus.year+'" label="Old Year" placeholder="'+n.genus.year+'" pattern="[0-9]{4}" error-message="Invalid Year" required autovalidate floatingLabel id="dialog-update-year"></paper-input>\n      </div>\n      <div class="row">\n        <div class="col-xs-12 text-right pull-right">\n          <button class="btn btn-primary" id="add-to-json-list">Add To List</button>\n        </div>\n      </div>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Cancel</paper-button>\n    <paper-button class="add-value">Set</paper-button>\n  </div>\n</paper-dialog>',$("body").append(o),p$(r).open(),t=function(){var e,t,n,o,i,l,c,d,u,p,m,h;for(e=!0,c=0,l=(m=$(r+" paper-input")).length;c<l;c++)t=m[c],p$(t).errorMessage="This field can't be empty",p$(t).validate(),p$(t).invalid&&(e=!1);if(!e)return!1;i=$("#deprecated-taxon-json").val();try{"object"!=typeof(n=JSON.parse(decode64(i)))&&(n=new Object)}catch(e){n=new Object}return u={genus:p$("#dialog-update-genus").value.trim().toTitleCase(),species:p$("#dialog-update-species").value.trim(),authority:p$("#dialog-update-authority").value.trim(),year:toInt(p$("#dialog-update-year").value.trim())},a.genus.toLowerCase()===u.genus.toLowerCase()&&a.species.toLowerCase()===u.species.toLowerCase()?(console.warn("Taxon is the same as the primary"),p$("#dialog-update-genus").errorMessage="This name is the same as the current one",p$("#dialog-update-genus").invalid=!0,p$("#dialog-update-species").errorMessage="This name is the same as the current one",p$("#dialog-update-species").invalid=!0,!1):(1707,h=new Date,u.year<1707||u.year>h.getFullYear()?(console.warn("Invalid year"),p$("#dialog-update-year").errorMessage="The year must be after 1707 and on or before "+h.getFullYear(),p$("#dialog-update-year").invalid=!0,!1):(p=u.genus+" "+u.species,d=u.authority+":"+u.year,console.log("Got strings",p,d),n[p]=d,console.log("Object:",n),o=JSON.stringify(n),console.log("Stringified:",o),$("#deprecated-taxon-json").val(encode64(o)),s=_asm._updateDeprecatedListItem(),$("#deprecated-taxon-list").html(s),!1))},$(r+" #add-to-json-list").click(function(){return t.debounce(75),!1}),_asm._updateDeprecated=function(){var t,a,n;return a=$("#deprecated-taxon-json").val(),t=isNull(a)?"{}":decode64(a),n=t.slice(1,-1),p$(e).value=n,!1},$(r+" .buttons paper-button.add-value").click(function(){return _asm._updateDeprecated.debounce(),p$(""+r).close(),!1}),!1)},!1},renderDeprecatedFromDatabase=function(){return!1},fillEmptyCommonName=function(){return!1},validateNewTaxon=function(){var e,t,a,n;return a=function(e){var t,a,n,r;for(null==e&&(e=!0),n=0,a=(t=["genus","species","subspecies"]).length;n<a;n++)r="#edit-"+t[n],e?(p$(r).invalid=!0,p$(r).errorMessage="This taxon already exists in the database",p$("#save-editor").disabled=!0):(p$(r).invalid=!1,p$("#save-editor").disabled=!1);return!1},t={genus:p$("#edit-genus").value,species:p$("#edit-species").value,subspecies:isNull(p$("#edit-subspecies").value)?"":p$("#edit-subspecies").value},e="q="+t.genus+"+"+t.species,n=t.genus+" "+t.species,isNull(t.subspecies)||(e+="+"+t.subspecies,n+=" "+t.subspecies),$.get(searchParams.apiPath,e+"&dwc_only=true","json").done(function(n){var r,o,i,s;if(!0!==n.status)return console.error("Problem validating taxon:",n),!1;for(o=0,r=(i=Object.toArray(n.result)).length;o<r;o++)if((s=i[o]).genus.toLowerCase()===t.genus.toLowerCase()&&s.specificEpithet.toLowerCase()===t.species.toLowerCase())try{if(isNull(t.subspecies)&&isNull(s.subspecificEpithet))return console.warn("Taxon sp already exists in DB"),a();if(t.subspecies.toLowerCase()===s.subspecificEpithet.toLowerCase())return console.warn("Taxon ssp already exists in DB"),a();continue}catch(e){}return a(!1),e="missing=true&genus="+t.genus+"&species="+t.species+"&prefetch=true",$.get(searchParams.apiPath,e,"json").done(function(e){var t,a,n,r,o,i,s,l;if(!isNumeric(e.id))return console.error("Unable to find IUCN result"),!1;a=null!=(i=(o=e).main_common_name)?i:o.common_name,s=o.species_authority,n=o.genus_authority;try{t=JSON.parse(o.authority_year),r=Object.keys(t)[0],l=t[r]}catch(e){r="",l=""}p$("#edit-common-name").value=a,p$("#edit-common-name-source").value="iucn",p$("#edit-genus-authority").value=n,p$("#edit-species-authority").value=s,p$("#edit-gauthyear").value=r,p$("#edit-sauthyear").value=l;try{p$("#genus-authority-parens").checked=o.parens_auth_genus.toBool(),p$("#species-authority-parens").checked=o.parens_auth_species.toBool()}catch(e){}return console.log("Got",a,s,n,t,r,l),!1}),!1}).fail(function(e,t){return console.error("FAIL_VALIDATE"),!1}),!1},createNewTaxon=function(){var e,t;animateLoad(),loadModalTaxonEditor("","Create"),d$("#editor-title").text("Create New Taxon"),t=.5*$(window).height(),d$("#modal-taxon-editor").css("min-height",t+"px"),d$("#modal-taxon-editor div.scrollable").css("max-height",""),d$("#modal-taxon-edit").addClass("create-new-taxon"),d$("#duplicate-taxon").remove(),e=isNull($.cookie(uri.domain+"_fullname"))?$.cookie(uri.domain+"_user"):$.cookie(uri.domain+"_fullname"),d$("#edit-taxon-author").attr("value",e),d$("#save-editor").click(function(){return saveEditorEntry("new")}),$("#modal-taxon-edit").on("iron-overlay-opened",function(){var e,t,a,n,r,o,i,s,l,c;for(console.log("Binding new taxon events"),r=0,a=(e=["genus","species","subspecies"]).length;r<a;r++)c="#edit-"+e[r],$(c).keyup(function(){return validateNewTaxon.debounce()});try{for(t=$(p$("#edit-entry").textarea).val(),i=$(p$("#edit-notes").textarea).val(),p$("#entry-markdown-preview").markdown=t,p$("#notes-markdown-preview").markdown=i,o=0,n=(s=$(".markdown-region")).length;o<n;o++)l=s[o],$(p$(l).textarea).keyup(function(){var e,t;e=$(this).val(),t=$(this).parents("iron-autogrow-textarea").attr("data-md-field");try{return p$("#"+t).markdown=e,console.debug("Wrote markdown to target '#"+t+"'")}catch(a){return a,console.warn("Can't update preview for target '#"+t+"'",$(this).get(0),e)}})}catch(e){e,console.error("Couldn't run markdown previews")}return validateNewTaxon()});try{p$("#modal-taxon-edit").open()}catch(e){$("#modal-taxon-edit").get(0).open()}return stopLoad()},createDuplicateTaxon=function(){var e,t,a,n,r,o;animateLoad();try{for(d$("#taxon-id").remove(),d$("#last-edited-by").remove(),d$("#duplicate-taxon").remove(),d$("#editor-title").text("Create Duplicate Taxon"),r='<paper-button id="save-editor">Create</paper-button>',d$("#save-editor").replaceWith(r),d$("#save-editor").click(function(){return saveEditorEntry("new")}),delay(250,function(){return stopLoad()}),n=0,a=(t=["genus","species","subspecies"]).length;n<a;n++)o="#edit-"+t[n],$(o).keyup(function(){return validateNewTaxon.debounce()});validateNewTaxon()}catch(t){e=t,stopLoadError("Unable to duplicate taxon"),console.error("Couldn't duplicate taxon! "+e.message),d$("#modal-taxon-edit").get(0).close()}return!0},lookupEditorSpecies=function(e){var t,a,n,r,o,i,s,l,c,d;if(null==e&&(e=void 0),null==e)return!1;if(animateLoad(),r="<p id=\"last-edited-by\">\n  Last edited by <span id=\"taxon-author-last\" class=\"capitalize\"></span>\n</p>\n<input type='hidden' name='taxon-id' id='taxon-id'/>",loadModalTaxonEditor(r),d$("#save-editor").click(function(){return saveEditorEntry()}),d$("#last-edited-by").exists()||d$("#taxon-credit-help").after(r),i=void 0,o=void 0,t="q="+e,-1!==e.search(/\(/)){for(o={genus:"",species:"",subspecies:""},i={genus:"",species:"",subspecies:""},c=e.split("+"),n=0;n<c.length;){switch(d=c[n],console.log("Checking '"+d+"'"),toInt(n)){case 0:a=d.split("("),console.log("Looking at genus array",a),o.genus=a[0].trim(),i.genus=null!=a[1]?a[1].trim().slice(0,-1):a[0];break;case 1:s=d.split("("),console.log("Looking at species array",s),o.species=s[0].trim(),i.species=null!=s[1]?s[1].trim().slice(0,-1):s[0];break;case 2:l=d.split("("),console.log("Looking at ssp array",l),o.subspecies=l[0].trim(),i.subspecies=null!=l[1]?l[1].trim().slice(0,-1):l[0];break;default:console.error("K value of '"+n+"' didn't match 0,1,2!")}c[n]=d.trim(),n++}e=o.genus+"+"+o.species,isNull(o.subspecies)||(e+=o.subspecies),t="q="+e+"&loose=true",console.warn("Bad name! Calculated out:"),console.warn("Should be currently",i),console.warn("Was previously",o),console.warn("Pinging with",""+uri.urlString+searchParams.targetApi+"?q="+e)}return $.get(searchParams.targetApi,t,"json").done(function(t){var a,n,r,s,l,c,d,u,p,m,h,g,f,b,y,w,v,x,_,k,S,C;try{if(console.debug("Admin lookup rending editor UI for",t),null==(s=t.result[0]))return stopLoadError("Sorry, there was a problem parsing the information for this taxon. If it persists, you may have to fix it manually."),console.error("No data returned for",searchParams.targetApi+"?q="+e),!1;try{s.deprecated_scientific=JSON.parse(s.deprecated_scientific)}catch(e){c=e}null!=o&&(toastStatusMessage("Bad information found. Please review and resave."),s.genus=i.genus,s.species=i.species,s.subspecies=i.subspecies,"object"!=typeof s.deprecated_scientific&&(s.deprecated_scientific=new Object),f=o.species,isNull(o.subspecies)||(f+=" "+o.subspecies),s.deprecated_scientific[o.genus.toTitleCase()+" "+f]="AUTHORITY: YEAR"),x=["parens_auth_genus","parens_auth_species"],console.debug("Using data",s),console.debug(JSON.stringify(s));for(a in s){r=s[a];try{"string"==typeof r&&(r=r.trim())}catch(e){}"id"===a&&$("#taxon-id").attr("value",r),n=!1;try{l="#edit-"+a.replace(/\_/g,"-"),"paper-dropdown-menu"===$(l).get(0).tagName.toLowerCase()&&(n=!0)}catch(e){}if(console.debug("Col editor exists for '"+l+"'?",n),n&&(console.debug("Trying to polymer-select",r),$(l).polymerSelected(r,!0)),"species_authority"!==a&&"genus_authority"!==a||/[0-9]{4}/im.test(r)&&(/^\(? *((['"])? *([\w\u00C0-\u017F\. \-\&;\[\]]+(,|&|&amp;|&amp;amp;|&#[\w0-9]+;)?)+ *\2) *, *([0-9]{4}) *\)?/im,(_=/^\(? *((['"])? *(?:\b[a-z\u00C0-\u017F\.\-\[\]]+(?:,| *&| *&amp;| *&amp;amp;| *&#[a-z0-9]+;)? *)+ *\2) *, *([0-9]{4}) *\)?$/gim).test(r)&&(u=r.search(/\(/)>=0&&r.search(/\)/)>=0,C=r.replace(_,"$3"),r=r.replace(_,"$1"),"genus_authority"===a&&$("#edit-gauthyear").attr("value",C),"species_authority"===a&&$("#edit-sauthyear").attr("value",C),u&&(p$("#"+a.replace(/\_/g,"-")+"-parens").checked=!0))),"authority_year"===a)"object"==typeof(C=parseTaxonYear(r))&&($("#edit-gauthyear").attr("value",C.genus),$("#edit-sauthyear").attr("value",C.species));else if(indexOf.call(x,a)>=0)b="parens"===a.split("_")[0]?"#"+a.split("_").pop()+"-authority-parens":"#"+a.replace(/_/g,"-"),d$(b).polymerChecked(toInt(r).toBool());else if("taxon_author"===a)"null"===r||isNull(r)?($("#last-edited-by").remove(),console.warn("Removed #last-edited-by! Didn't have an author provided for column '"+a+"', giving '"+r+"'. It's probably the first edit to this taxon.")):d$("#taxon-author-last").text(r),k=isNull($.cookie(uri.domain+"_fullname"))?$.cookie(uri.domain+"_user"):$.cookie(uri.domain+"_fullname"),d$("#edit-taxon-author").attr("value",k);else if("taxon_credit"===a)d="#edit-"+a.replace(/_/g,"-"),p$(d).value=$.cookie(adminParams.cookieFullName);else if("image_license"===a){m=r.unescape();try{p=JSON.parse(m);for(h in p){g=p[h],$("#edit-image-license-dialog").attr("data-license-name",h).attr("data-license-url",g),$("#edit-image-license").attr("data-license-name",h).attr("data-license-url",g),r=h+" @ "+g;break}}catch(e){r=m}p$("#edit-image-license").value=r}else if("taxon_credit_date"===a)isNull(r)&&(v=new Date,r=v.toISOString().split("T")[0],d="#edit-"+a.replace(/_/g,"-"),p$(d).value=r);else{if(d="#edit-"+a.replace(/_/g,"-"),"deprecated_scientific"===a){try{$(d).attr("data-json",encode64(JSON.stringify(r)))}catch(e){}r=JSON.stringify(r).trim().replace(/\\/g,""),r=r.replace(/{/,""),'""'===(r=r.replace(/}/,""))&&(r="")}try{"string"==typeof r&&(r=r.unescape())}catch(e){}y=["notes","entry"],indexOf.call(y,a)<0?d$(d).attr("value",r):(S=.9*$("#modal-taxon-edit").width(),d$(d).css("width",S+"px"),w=p$(d).textarea,$(w).text(r.unescape()))}}return p$("#modal-taxon-edit"),$("#modal-taxon-edit").on("iron-overlay-opened",function(){var e,t,a,n,r,o,i,s,l,d;p$("#modal-taxon-edit").refit(),i=p$("#edit-common-name").value,$("#edit-common-name").keyup(function(){var e;return console.debug("Common name field edited!"),e=p$(this).value!==i?"user:"+$.cookie(adminParams.cookieFullName):"iucn",p$("#edit-common-name-source").value=e,!1}),_asm.updateImageField=function(e){var t,a;return t=p$(e).value,console.log("Should render preview image of ",t),$("#preview-main-image").exists()&&$("#preview-main-image").remove(),a='<img id="preview-main-image" class=\'preview-image\' src="'+t+'" />',$("#imagehelp").after(a),!1},$("#edit-image").on("focus",function(){var e;return e=this,_asm.updateImageField.debounce(null,null,null,e),!1}).on("blur",function(){var e;return e=this,_asm.updateImageField.debounce(null,null,null,e),!1}).on("keyup",function(){var e;return e=this,_asm.updateImageField.debounce(null,null,null,e),!1});try{_asm.updateImageField(p$("#edit-image"))}catch(e){}for(r=function(e){var t;return t=p$(e).value,$("#taxon-credit-help .taxon-credit-preview").text(t),t},e=function(e){var t,a,n;return t=p$(e).value,a=new Date(t),n=a.getUTCDate()+" "+dateMonthToString(a.getUTCMonth())+" "+a.getUTCFullYear(),$("#taxon-credit-help .taxon-credit-date-preview").text(n),n},$("#edit-taxon-credit").keyup(function(){return r(this),!1}),$("#edit-taxon-credit-date").keyup(function(){return e(this),!1}),r(p$("#edit-taxon-credit")),e(p$("#edit-taxon-credit-date")),t=$(p$("#edit-entry").textarea).val(),o=$(p$("#edit-notes").textarea).val(),p$("#entry-markdown-preview").markdown=t,p$("#notes-markdown-preview").markdown=o,d=[],n=0,a=(s=$(".markdown-region")).length;n<a;n++)l=s[n],d.push($(p$(l).textarea).keyup(function(){var e,t;e=$(this).val(),t=$(this).parents("iron-autogrow-textarea").attr("data-md-field");try{return p$("#"+t).markdown=e,console.debug("Wrote markdown to target '#"+t+"'")}catch(a){return c=a,console.warn("Can't update preview for target '#"+t+"'",$(this).get(0),e)}}));return d}),safariDialogHelper("#modal-taxon-edit"),stopLoad()}catch(e){return c=e,stopLoadError("Unable to populate the editor for this taxon - "+c.message),console.error("Error populating the taxon popup -- "+c.message),console.warn(c.stack)}}).fail(function(e,t){return stopLoadError("There was a server error populating this taxon. Please try again.")}),!1},validateCitation=function(e){var t,a,n,r,o,i,s;o=!1;try{$(e).exists()&&(s=e,"function"==typeof p$(e).validate?(o=!0,e=p$(s).value):e=$(s).val())}catch(e){}return t=function(e,t){return o&&(!1===e?p$(s).errorMessage="Please enter a valid DOI or ISBN":isNull(t)||(p$(s).value=t),p$(s).invalid=!e),e},a=/^(?:doi:|https?:\/\/dx.doi.org\/)?(10.\d{4,9}\/[-._;()\/:A-Z0-9]+|10.1002\/[^\s]+|10.\d{4}\/\d+-\d+X?(\d+)\d+<[\d\w]+:[\d\w]*>\d+.\d+.\w+;\d|10.1207\/[\w\d]+\&\d+_\d+)$/im,a.test(e)?(i=e.replace(a,"$1"),t(!0,i)):0===e.search(/isbn/i)?(n=/^(?:ISBN(?:-10)?:?\ )?(?=[0-9X]{10}$|(?=(?:[0-9]+[-\ ]){3})[-\ 0-9X]{13}$)[0-9]{1,5}[-\ ]?[0-9]+[-\ ]?[0-9]+[-\ ]?[0-9X]$/,r=/^(?:ISBN(?:-13)?:?\ )?(?=[0-9]{13}$|(?=(?:[0-9]+[-\ ]){4})[-\ 0-9]{17}$)97[89][-\ ]?[0-9]{1,5}[-\ ]?[0-9]+[-\ ]?[0-9]+[-\ ]?[0-9]$/,t(n.test(e)&&r.test(e))):t(!1)},saveEditorEntry=function(e){var t,a,n,r,o,i,s,l,c,d,u,p,m,h,g,f,b,y,w,v,x,_,k,S,C,L,T,N,D,j,E,P,A,O,I,B,U,R,M,q,F,z,H,W,J,Q,G,Y,V;null==e&&(e="save"),w=["genus","species","subspecies","common-name","major-type","major-subtype","linnean-order","linnean-family","simple-linnean-group","simple-linnean-subgroup","genus-authority","species-authority","notes","entry","image","image-credit","image-license","image-caption","taxon-author","taxon-credit","taxon-credit-date","internal-id","source","citation","species-authority-citation","genus-authority-citation"],U=new Object,y=!1,d$("paper-input").removeAttr("invalid");try{H=function(e,t){var a,n,r,o,i,s,l,c,d;if(null==t&&(t=!1),c=t?e:d$(e).val(),i=void 0,1707,o=new Date,s=o.getUTCFullYear()+1,n=/^[1-2][07-9]\d{2}$|^[1-2][07-9]\d{2} (\"|')[1-2][07-9]\d{2}\1$/,isNumber(c)&&1707<c&&c<s||(n.test(c)?-1===c.search(" ")?i="This must be a valid year between 1707 and "+s:(1707<(l=(d=c.split(" "))[0])&&l<s||(i="The first year must be a valid year between 1707 and "+s),1707<(a=d[1].replace(/(\"|')/g,""))&&a<s||(i="The second year must be a valid year between 1707 and "+s),c=c.replace(/'/g,'"')):i=-1===c.search(" ")?"This must be a valid year between 1707 and "+s:"Nonstandard years must be of the form: YYYY 'YYYY', eg, 1801 '1802'"),null!=i){if(y=!0,r=e+" failed its validity checks for `"+c+"`!",console.warn(r),t)throw Error(i);d$(""+e).attr("error-message",i).attr("invalid","invalid")}return c};try{v=H("#edit-gauthyear"),B=H("#edit-sauthyear"),console.log("Escape Completion State:",y)}catch(e){g=e,console.error("Unable to parse authority year! "+g.message),n=""}(a=new Object)[v]=B,n=JSON.stringify(a)}catch(e){g=e,console.error("Failed to JSON parse the authority year - "+g.message),n=""}U.authority_year=n;try{if(d=new Object,p=d$("#edit-deprecated-scientific").val(),isNull(p))m="";else{for(E=0,T=(u=p.split('","')).length;E<T;E++)d[(S=(C=u[E]).split('":"'))[0].replace(/"/g,"")]=S[1].replace(/"/g,"");console.log("Validating",d);for(z in d){if(r=d[z],o=r.split(":"),console.log("Testing "+r,o),2!==o.length)throw Error("Authority string should have an authority and year seperated by a colon.");if(a=o[0].trim(),-1!==(J=o[1].trim()).search(","))throw Error("Looks like there may be an extra space, or forgotten \", near '"+J+"' ");V=H(J,!0),console.log("Validated",a,V)}if((m=JSON.stringify(d)).replace(/[{}]/g,"")!==p)throw Error("Badly formatted entry - generated doesn't match read")}}catch(e){g=e,console.error("Failed to parse the deprecated scientifics - "+g.message+". They may be empty."),m="",b=g.message+". Check your formatting!",d$("#edit-deprecated-scientific").attr("error-message",b).attr("invalid",!0),y=!0,l="There was a problem with your formatting for the deprecated scientifics. Please check it and try again."}U.deprecated_scientific=m,L=["notes","taxon_credit","image","image_credit","image_license","image_caption","species-authority-citation","species_authority_citation","genus-authority-citation","genus_authority_citation"],O=["common-name","major-type","linnean-order","genus-authority","species-authority"],isNull(d$("#edit-image").val())||(O.push("image-credit"),O.push("image-license")),isNull(d$("#edit-taxon-credit").val())||O.push("taxon-credit-date");for(C in w)if("string"==typeof(_=w[C])){console.log(C,_);try{i=_.replace(/-/g,"_")}catch(e){console.warn("Unable to test against id '"+_+"'");continue}W="#edit-"+i.replace(/\_/gim,"-"),s=!1;try{h=W,"paper-dropdown-menu"===$(h).get(0).tagName.toLowerCase()&&(s=!0)}catch(e){}if(console.debug("Col editor exists for '"+h+"'?",s),s)G=$(h).polymerSelected();else if("image_license"===i)Y=new Object,N=$("#edit-image-license").attr("data-license-name"),D=$("#edit-image-license").attr("data-license-url"),Y[N]=D,G=JSON.stringify(Y);else{k=!1;try{"iron-autogrow-textarea"===$("#edit-"+_).get(0).tagName.toLowerCase()&&(k=!0)}catch(e){}if(k){G=p$("#edit-"+_).value,isNull(G)&&(G=$(p$("#edit-"+_).textarea).val());try{G=G.trim()}catch(e){}}else try{G=d$("#edit-"+_).val().trim()}catch(e){g=e,G="",f="Unable to get value for "+_,console.warn(f+": "+g.message),toastStatusMessage(f)}}if(indexOf.call(L,i)<0)try{isNumber(G)&&(G===toInt(G).toString()?G=toInt(G):vale===toFloat(G).toString()&&(G=toFloat(G))),G=G.toLowerCase()}catch(e){g=e,console.warn("Column '"+i+"' threw error for value '"+G+"': "+g.message),isNull(G)&&(G="")}switch(_){case"genus":case"species":case"subspecies":b="This required field must have only letters",P=("genus"===_||"species"===_)&&isNull(G),(/[^A-Za-z]/m.test(G)||P)&&(d$("#edit-"+_).attr("error-message",b).attr("invalid","invalid"),y=!0,l="invalid gss");break;case"common-name":case"major-type":case"linnean-order":case"genus-authority":case"species-authority":b="This cannot be empty",isNull(G)&&($("#edit-"+_).attr("error-message",b).attr("invalid","invalid"),y=!0,l="invalid cmmlgs");break;default:indexOf.call(O,_)>=0&&(F="This must not be empty","#edit-image-credit"!==(q="#edit-"+_)&&"#edit-image-license"!==q||(F="This cannot be empty if an image is provided"),"#edit-taxon-credit-date"===q&&("Invalid Date"===(A=new Date(G))?(F="We couldn't understand your date format. Please try again.",G=null):(G=A.toISOString().split("T")[0],$(q).attr("value",G),F="If you have a taxon credit, it also needs a date")),isNull(G)&&(d$("#edit-"+_).attr("error-message",F).attr("invalid","invalid"),y=!0,l="REQUIRED_FIELD_EMPTY"))}U[i]=G}return U.id=toInt(d$("#taxon-id").val()),U.parens_auth_genus=d$("#genus-authority-parens").polymerChecked(),U.parens_auth_species=d$("#species-authority-parens").polymerChecked(),U.canonical_sciname=isNull(U.subspecies)?U.genus.toTitleCase()+" "+U.species:U.genus.toTitleCase()+" "+U.species+" "+U.subspecies,y?(animateLoad(),c=null!=l?l:"Bad characters in entry. Stopping ...",l="There was a problem with your entry. Please correct your entry and try again. "+l,stopLoadError(l),console.error(c),console.warn("Save object so far:",U),!0):"save"!==e||isNumber(U.id)?(R=JSON.stringify(U),I=Base64.encodeURI(R),isNull(R)||isNull(I)?(animateLoad(),stopLoadError("The system was unable to parse this entry for the server. Please see the console for more details."),console.error("Unable to stringify the JSON!."),console.warn("The total save object so far is:",U),console.warn("Got the output string",saveSring),console.warn("Sending b64 string",I),!0):(x=$.cookie(uri.domain+"_auth"),M=$.cookie(uri.domain+"_secret"),j=$.cookie(uri.domain+"_link"),Q="hash="+x+"&secret="+M+"&dblink="+j,t="perform="+e+"&"+Q+"&data="+I,console.log("Going to save",U),console.log("Using mode '"+e+"'"),animateLoad(),$.post(adminParams.apiTarget,t,"json").done(function(e){return!0===e.status?(console.log("Server returned",e),y?(stopLoadError("Warning! The item saved, even though it wasn't supposed to."),!1):(d$("#modal-taxon-edit").get(0).close(),isNull($("#admin-search").val())||renderAdminSearchResults(),prefetchEditorDropdowns(),stopLoad(),delay(250,function(){return stopLoad()}),console.log("Save complete"),!1)):(stopLoadError(e.human_error),console.error(e.error),console.warn("Server returned",e),console.warn("We sent",""+uri.urlString+adminParams.apiTarget+"?"+t),!1)}).fail(function(e,a){return stopLoadError("Failed to send the data to the server."),console.error("Server error! We sent",""+uri.urlString+adminParams.apiTarget+"?"+t),!1}))):(animateLoad(),stopLoadError("The system was unable to generate a valid taxon ID for this entry. Please see the console for more details."),console.error("Unable to get a valid, numeric taxon id! We got '"+U.id+"'."),console.warn("The total save object so far is:",U),!1)},deleteTaxon=function(e){var t,a,n,r,o,i;return a=$(".delete-taxon .delete-taxon-button[data-database-id='"+e+"']"),i=a.attr("data-taxon").replace(/\+/g," "),o=i.substr(0,1).toUpperCase()+i.substr(1),a.hasClass("extreme-danger")?null!=window.deleteWatchTimer?(n=Date.now()-window.deleteWatchTimer,console.warn("The taxon was asked to be deleted "+n+"ms after the confirmation was prompted. Rejecting ..."),!1):(animateLoad(),t="perform=delete&id="+e,$.post(adminParams.apiTarget,t,"json").done(function(n){if(console.log("Filed delete",adminParams.apiTarget+"?"+t),console.log("Server response",n),!0===n.status){a.parents("tr").remove();try{p$("#search-status").hide()}catch(e){}window._metaStatus.isToasting=!1,delay(250,function(){return toastStatusMessage(o+" with ID "+e+" has been removed from the database.")}),stopLoad()}else stopLoadError(n.human_error),console.error(n.error),console.warn(n);return!1}).fail(function(e,t){return stopLoadError("Failed to communicate with the server."),!1})):(window.deleteWatchTimer=Date.now(),delay(300,function(){return delete window.deleteWatchTimer}),a.addClass("extreme-danger").attr("icon","icons:delete-sweep"),r=7500,delay(r,function(){return a.removeClass("extreme-danger").attr("icon","icons:delete-forever")}),toastStatusMessage("Click again to confirm deletion of "+o+". This can't be undone.","",r),!1)},handleDragDropImage=function(e,t){return null==e&&(e="#upload-image"),"function"!=typeof t&&(t=function(e,t){var a,n,r,o;if(!0!==t.status)return null==t.human_error&&(t.human_error="There was a problem uploading your image."),toastStatusMessage(t.human_error),console.error("Error uploading!",t),!1;try{r=e.name,_asm.dropzone.disable(),n=r.split(".").pop(),o="species_photos/"+(md5(r)+"."+n),d$("#edit-image").attr("disabled","disabled").attr("value",o),toastStatusMessage("Upload complete")}catch(e){a=e,console.error("There was a problem with upload post-processing - "+a.message),console.warn("Using",r,t),toastStatusMessage("Your upload completed, but we couldn't post-process it.")}return!1}),loadJS("bower_components/JavaScript-MD5/js/md5.min.js"),loadJS("bower_components/dropzone/dist/min/dropzone.min.js",function(){var a,n,r,o,i;return(a=document.createElement("link")).setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","css/dropzone.min.css"),document.getElementsByTagName("head")[0].appendChild(a),Dropzone.autoDiscover=!1,n="Drop a high-resolution image for the taxon here.",r=function(){return d$(e).css("box-shadow","").css("border",""),d$(e+" .dz-message span").text(n)},o={url:uri.urlString+"meta.php?do=upload_image",acceptedFiles:"image/*",autoProcessQueue:!0,maxFiles:1,dictDefaultMessage:n,init:function(){return this.on("error",function(){return toastStatusMessage("An error occured sending your image to the server.")}),this.on("canceled",function(){return toastStatusMessage("Upload canceled.")}),this.on("dragover",function(){return d$(e+" .dz-message span").text("Drop here to upload the image"),d$(e).css("box-shadow","0px 0px 15px rgba(15,157,88,.8)").css("border","1px solid #0F9D58")}),this.on("dragleave",function(){return r()}),this.on("dragend",function(){return r()}),this.on("drop",function(){return r()}),this.on("success",function(e,a){return t(e,a)})}},d$(e).hasClass("dropzone")||d$(e).addClass("dropzone"),i=new Dropzone(d$(e).get(0),o),_asm.dropzone=i}),!1},adminPreloadSearch=function(){var e,t,a,n,r,o,i,s;if(!0===_asm.preloaderBlocked)return console.debug("Skipping re-running active search preload"),!1;console.debug("Preloader firing"),_asm.preloaderBlocked=!0,i=Date.now();try{uri.query=decodeURIComponent($.url().attr("fragment"))}catch(e){}if("#"===uri.query||isNull(uri.query))return!1;try{o=Base64.decode(uri.query),o=JSON.parse(o)}catch(e){}if("object"==typeof o){if(isNull(o.genus)||null==o.species)return console.error("Bad taxon format"),!1;for(r in o)s=o[r],e=(e=decodeURIComponent(s)).replace(/(\+|\%20|\s)+/g," "),o[r]=e.trim();t=o.genus+" "+o.species,isNull(o.subspecies)||(t+=" "+o.subspecies),a=1e4,(n=function(){var e,r;try{r=p$("#admin-search").isAttached}catch(e){r=!1}if(("undefined"!=typeof _asm&&null!==_asm?_asm.polymerReady:void 0)&&r){try{p$("#admin-search").value=t}catch(e){$("#admin-search").val(t)}return renderAdminSearchResults(o),e=Date.now()-i,console.log("Search preload finished in "+e+"ms"),_asm.preloaderBlocked=!1}return e=Date.now()-i,console.debug("NOT READY: Duration @ "+e+"ms","undefined"!=typeof _asm&&null!==_asm?_asm.polymerReady:void 0,r,_asm.polymerReady&&r),e>a?(console.error("Timeout waiting for polymerReady!! Not filling search."),_asm.preloaderBlocked=!1,!1):delay(100,function(){return n()})})()}else console.error("Bad fragment: unable to read JSON",o);return!1},$(function(){var e,t;try{t=uri.o.attr("source"),e=/^https?:\/\/(?:.*?\/)+(admin-.*\.(?:php|html)|admin\/)(?:\?(?:&?[\w\-_]+=[\w+\-_%]+)+)?(?:\#[\w\+%]+)?$/im.test(t)}catch(t){e=!0}if($("#next").exists()&&$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}),loadJS("bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $("[data-toggle='tooltip']").tooltip()}),!e)return console.debug("Not an admin page");try{prefetchEditorDropdowns()}catch(e){}try{return adminPreloadSearch()}catch(e){}});var getChartKeys,getRandomDataColor,renderTaxonData,updateTaxonomySort,modulo=function(e,t){return(+e%(t=+t)+t)%t};getRandomDataColor=function(){var e;return e="rgba("+randomInt(0,255)+","+randomInt(0,255)+","+randomInt(0,255),{border:e+",1)",background:e+",0.2)"}},updateTaxonomySort=function(){var e,t,a,n;n=Date.now(),startLoad(),e={action:"taxonomy"};try{t=p$("#default-sort-toggle").checked}catch(e){t=!0}return t||(a=getChartKeys(),e.order_sort=a.order_sort,e.genus_sort=a.genus_sort),$.get(uri.urlString+"api.php",objToArgs(e,"json")).done(function(e){var t;return!0===e.status&&(window.hlTaxonLabels=Object.toArray(e.taxonomy.order.labels),window.hlTaxonData=Object.toArray(e.taxonomy.order.data),window.genusData=e.taxonomy.genus.data,t=Date.now()-n,console.debug("Taxon data fetch successful in "+t+"ms"),renderTaxonData.debounce(),stopLoad()),!1}).fail(function(e,t){return console.error(e,t),stopLoadError("There was an error updating the sort of your dataset"),!1}),!1},renderTaxonData=function(){var e,t,a,n,r,o,i,s,l,c,d,u,p;null!=("undefined"!=typeof _asm&&null!==_asm?_asm.chart:void 0)&&_asm.chart.destroy(),u=function(e,t,a){return 0===modulo(t,4)&&toFloat(e.removeExponents())>=1?e.removeExponents():""};try{p$("#log-scale").checked?p="logarithmic":(p="linear",u=void 0)}catch(e){p="logarithmic"}if($("#high-level-taxon-data").exists()){for(console.log("Rendering high level taxon data"),i=Object.toArray(window.hlTaxonLabels),o=Object.toArray(window.hlTaxonData),n=new Array,s=0,l=i.length;s<l;s++)d=i[s],r=Object.toArray(window.genusData[d].labels),n.push(r.length);a=getRandomDataColor(),c=getRandomDataColor(),e={type:"bar",data:{labels:i,datasets:[{label:"Species Count",type:"bar",data:o,borderColor:a.border,backgroundColor:a.background,borderWidth:1},{label:"Genus Count",type:"line",data:n,borderColor:c.border,backgroundColor:c.background,borderWidth:1}]},options:{scales:{yAxes:[{type:p,scaleLabel:{labelString:"Species",display:!0},ticks:{min:.75}}],xAxes:[{scaleLabel:{labelString:"Linnean Order",display:!0}}]}}},null!=u&&(e.options.scales.yAxes[0].ticks.callback=u),t=$("#high-level-chart"),"object"!=typeof window._asm&&(window._asm=new Object),_asm.chart=new Chart(t,e),console.debug("Config:",e),t.click(function(e){var t,n,r,o,i,s,l,c;return n=_asm.chart.getDatasetAtEvent(e),o=_asm.chart.getElementAtEvent(e),console.debug("Dataset",n),console.debug("Element",o),r=o[0]._index,t=n[r],console.debug("Specific data:",t),i=t._model.label,console.debug("Taxon clicked:",i),s=window.genusData[i],console.debug("Using data",s),$("#zoom-taxon-label").html("<span class='genus'>"+i+"</span> Genus Breakdown"),a=getRandomDataColor(),l={type:"bar",data:{labels:Object.toArray(s.labels),datasets:[{label:"Species Count",data:Object.toArray(s.data),borderColor:a.border,backgroundColor:a.background,borderWidth:1}]},options:{scales:{yAxes:[{type:p,scaleLabel:{labelString:"Species",display:!0},ticks:{min:.75}}],xAxes:[{scaleLabel:{labelString:"Genera in "+i,display:!0},ticks:{fontStyle:"italic"}}]}}},null!=u&&(l.options.scales.yAxes[0].ticks.callback=u),c=$("#taxon-zoom-chart"),null!=_asm.zoomChart&&_asm.zoomChart.destroy(),_asm.zoomChart=new Chart(c,l),!1})}return!1},getChartKeys=function(){var e,t,a,n,r,o,i;for(e=new Object,a=0,r=(i=$(".chart-param")).length;a<r;a++){o=i[a],n=$(o).attr("data-key");try{if(null==p$(o).checked)throw"Not Toggle";e[n]=p$(o).checked}catch(a){try{window.debugDrop||(window.debugDrop=new Object),console.log("Looking at",o),window.debugDrop[n]=o}catch(e){}try{t=$(p$(o).selectedItem).attr("data-value")}catch(e){}e[n]=null!=t?t:p$(o).selectedItemLabel.toLowerCase().replace(" ","-")}}return e},$(function(){var e;_asm.hasBoundDropdowns=!1,renderTaxonData();try{$("#log-scale").on("iron-change",function(){return null!=("undefined"!=typeof _asm&&null!==_asm?_asm.chart:void 0)&&_asm.chart.destroy(),renderTaxonData.debounce(),!1}),$("#default-sort-toggle").on("iron-change",function(){var e,t,a,n,r,o,i;if(p$(this).checked)try{for(t=0,n=(o=$(".sort-options")).length;t<n;t++)e=o[t],p$(e).disabled=!0}catch(e){$(".sort-options").attr("disabled","disabled")}else try{for(a=0,r=(i=$(".sort-options")).length;a<r;a++)e=i[a],p$(e).disabled=!1}catch(e){$(".sort-options").removeAttr("disabled")}return renderTaxonData.debounce(),!1})}catch(e){}try{return delayPolymerBind("paper-dropdown-menu#order-sort",function(){var e;return _asm.hasBoundDropdowns||(_asm.hasBoundDropdowns=!0,console.info("Binding events for dropdown"),e=function(e,t){var a,n,r,o;return console.debug(e,t,t.detail.item),n="paper-dropdown-menu"!==e.tagName.toLowerCase()?$(e).parents("paper-dropdown-menu").get(0):e,r="paper-item"!==e.tagName.toLowerCase()?null!=(o=t.detail.item)?o:$(e).find("paper-item").get(0):e,console.debug(n,r),p$(n)._setSelectedItem(r),a=getChartKeys(),console.debug(a),updateTaxonomySort(),!1},$("paper-dropdown-menu.sort-options paper-listbox").on("iron-select",function(t){return console.debug("is event for dropdown"),e.debounce(50,null,null,this,t),!1}),$("paper-dropdown-menu.sort-options paper-listbox paper-item").click(function(t){return console.debug("Click event for dropdown"),e.debounce(50,null,null,this,t),!1}),console.log("Events bound")),!1})}catch(t){return e=t,console.warn("Warning: couldn't bind polymer events - "+e.message),console.warn(e.stack)}});var downloadCSVList,downloadHTMLList,showDownloadChooser;downloadCSVList=function(e){var t,a,n,r,o,i,s,l,c,d,u,p;null==e&&(e=!1),animateLoad(),p=Date.now(),_asm.progressTracking={estimate:new Array};try{u=e?searchParams.lastSearch:"*",isNull(u)&&(u="*")}catch(e){u="*"}try{for(s=0,l=(d=$("#download-chooser .buttons paper-button")).length;s<l;s++)n=d[s],p$(n).disabled=!0}catch(e){}return a="q="+u,r=new Date,t=r.getMonth()+1,c=1===t.toString().length?"0"+t:t,i=1===r.getDate().toString().length?"0"+r.getDate().toString():r.getDate(),o=r.getUTCFullYear()+"-"+c+"-"+i,$.get(""+searchParams.apiPath,a,"json").done(function(e){var t,n,r;try{if(!0!==e.status)throw Error("Invalid Result");return startLoad(),toastStatusMessage("Please be patient while we create the file for you"),n={action:"render-csv",data:e},r=new Worker("js/serviceWorker.min.js"),console.info("Rendering list off-thread"),r.addEventListener("message",function(e){var t,a,n,r,i,s,l,c,d,u;if(!0!==e.data.status)return console.warn("Got an error!"),l=isNull(e.data.updateUser)?"Failed to create file":e.data.updateUser,stopLoadError(l,void 0,1e4),!1;if(!0!==e.data.done)return isNull(e.data.updateUser)?isNumber(e.data.progress)?($("#download-progress-indicator").exists()||(s='<paper-progress\n  class="transiting"\n  id="download-progress-indicator"\n  value="0"\n  max="1000">\n</paper-progress>\n<p>\n  <span class="bold">Estimated Time Remaining:</span> <span id="estimated-remaining-time">&#8734;</span>s\n</p>',$("#download-chooser .dialog-content .scrollable").append(s)),p$("#download-progress-indicator").value=e.data.progress,u=(d=Date.now()-p)/(toFloat(e.data.progress)/1e3),_asm.progressTracking.estimate.push(u),r=_asm.progressTracking.estimate.mean()-d,$("#estimated-remaining-time").text(toInt(r/1e3))):console.log("Just an update",e.data):(console.log("Toasting: "+e.data.updateUser),toastStatusMessage(e.data.updateUser,1e3)),!1;a=e.data.csv;try{i=a.length/1024/1024}catch(e){i=0}return console.log("Downloadable size: "+i+" MiB"),null===_asm.sqlDumpLocation?(c='<div id="download-sql-summary" class="data-download-button">\n  <paper-spinner active></paper-spinner> Please wait while your SQL creation finishes ...\n</div>',(t=function(){return null===_asm.sqlDumpLocation?delay(250,function(){return t()}):(c=!1===_asm.sqlDumpLocation?'<a href="#" class="btn btn-danger data-download-button" id="download-sql-summary" disabled><iron-icon icon="icons:error"></iron-icon> SQL Creation Failed</a>':'<a href="'+_asm.sqlDumpLocation+'" download="asm-species-'+o+'.sql" class="btn btn-default data-download-button" id="download-sql-summary"><iron-icon icon="icons:file-download"></iron-icon> Download SQL</a>',$("#download-sql-summary").replaceWith(c)),!1})()):c=!1===_asm.sqlDumpLocation?'<a href="#" class="btn btn-danger data-download-button" id="download-sql-summary" disabled><iron-icon icon="icons:error"></iron-icon> SQL Creation Failed</a>':'<a href="'+_asm.sqlDumpLocation+'" download="asm-species-'+o+'.sql" class="btn btn-default data-download-button" id="download-sql-summary"><iron-icon icon="icons:file-download"></iron-icon> Download SQL</a>',s='<paper-dialog class="download-file" id="download-csv-file" modal>\n  <h2>Your files are ready</h2>\n  <paper-dialog-scrollable class="dialog-content">\n    <h3>Want to do data analysis?</h3>\n    <p>\n      We have an open API! Read all of our parameters here:\n      <a href="https://github.com/tigerhawkvok/asm-mammal-database/blob/master/README.md#api"  onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'>README API Documentation <iron-icon icon="launch"></iron-icon></a>\n      <br/><br/>\n      We also have a UI to perform permission-restricted SQL queries on the database. You can launch this by clicking the <iron-icon icon="icons:code"></iron-icon> icon in the footer.\n    </p>\n    <h3>Which file type do I want?</h3>\n    <p>\n      A CSV file is readily opened by consumer-grade programs, such as Microsoft Excel or Google Spreadsheets.\n      It has some transformations done to the raw data to make it more readable.\n      <br/><br/>\n      However, if you wish to replicate the whole database and perform queries, the SQL file is machine-readable,\n      ready for import into a MySQL or MariaDB database by running the <code>source asm-species-'+o+'.sql;</code> in their\n      interactive shell prompts when run from your download directory. This file has not been transformed in any way.\n    </p>\n    <h3>Excel Important Note</h3>\n    <p>\n      Please note that some special characters in names may be decoded incorrectly by Microsoft Excel. If this is a problem, following the steps in <a href="https://github.com/tigerhawkvok/asm-mammal-database/blob/master/meta/excel_unicode_readme.md"  onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'>this README <iron-icon icon="icons:launch"></iron-icon></a> to force Excel to format it correctly.\n    </p>\n    <p class="text-center">\n      <a href="'+a+'" download="asm-species-'+o+'.csv" class="btn btn-default data-download-button" id="download-csv-summary"><iron-icon icon="icons:file-download"></iron-icon> Download CSV</a>\n      '+c+'\n    </p>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("#download-csv-file").exists()?$("#download-csv-file").replaceWith(s):$("body").append(s),p$("#download-chooser").close(),i>=2?(console.debug("Large file size triggering blob creation"),downloadDataUriAsBlob("#download-csv-summary")):console.debug("File size is small enough to use a data-uri"),delay(250,function(){return safariDialogHelper("#download-csv-file")}),stopLoad(),n=Date.now()-p,console.debug("CSV time elapsed: "+n+"ms"),!1}),r.postMessage(n),!1}catch(n){return t=n,stopLoadError("There was a problem creating the CSV file. Please try again later."),console.error("Exception in downloadCSVList ) - "+t.message),console.warn(t.stack),console.warn("Got",e,"from",searchParams.apiPath+"?"+a,e.status)}}).fail(function(){return stopLoadError("There was a problem communicating with the server. Please try again later.")}),_asm.sqlDumpLocation=null,$.get(uri.urlString+"meta.php","action=get_db_dump","json").done(function(e){return!0===e.status?_asm.sqlDumpLocation=e.download_path:_asm.sqlDumpLocation=!1,!1}).fail(function(e,t){return!1}),!1},downloadHTMLList=function(e){var t,a,n,r,o,i;null==e&&(e=!1),startLoad(),i=Date.now(),_asm.progressTracking={estimate:new Array};try{o=e?searchParams.lastSearch:"*",isNull(o)&&(o="*")}catch(e){o="*"}try{for(a=0,n=(r=$("#download-chooser .buttons paper-button")).length;a<n;a++)t=r[a],p$(t).disabled=!0}catch(e){}return $.get(uri.urlString+"css/download-inline-bootstrap.css").done(function(e){var t,a,n,r,s,l,c;return n=new Date,t=n.getMonth()+1,c=1===t.toString().length?"0"+t:t,s=1===n.getDate().toString().length?"0"+n.getDate().toString():n.getDate(),r=n.getUTCFullYear()+"-"+c+"-"+s,l='<!doctype html>\n<html lang="en">\n  <head>\n    <title>ASM Species Checklist ver. '+r+'</title>\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta charset="UTF-8"/>\n    <meta name="theme-color" content="#445e14"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1" />\n    <link href=\'http://fonts.googleapis.com/css?family=Droid+Serif:400,700,700italic,400italic|Roboto+Slab:400,700\' rel=\'stylesheet\' type=\'text/css\' />\n    <style type="text/css" id="asm-checklist-inline-stylesheet">\n      '+e+'\n    </style>\n  </head>\n  <body>\n    <div class="container-fluid">\n      <article>\n        <h1 class="text-center">ASM Species Checklist ver. '+r+"</h1>",a="q="+o+"&order=linnean_order,linnean_family,genus,species,subspecies",$.get(""+searchParams.apiPath,a,"json").done(function(e){var t,a;return startLoad(),toastStatusMessage("Please be patient while we create the file for you"),t={action:"render-html",data:e,htmlHeader:l},a=new Worker("js/serviceWorker.min.js"),console.info("Rendering list off-thread"),a.addEventListener("message",function(e){var t,a,n,o,s,c,d,u,p;if(!0!==e.data.status)return console.warn("Got an error!"),c=isNull(e.data.updateUser)?"Failed to create file":e.data.updateUser,stopLoadError(c,void 0,1e4),!1;if(!0!==e.data.done){if(isNull(e.data.updateUser))if(isNumber(e.data.progress)){$("#download-progress-indicator").exists()||(s='<paper-progress\n  class="transiting"\n  id="download-progress-indicator"\n  value="0"\n  max="1000">\n</paper-progress>\n<p>\n  <span class="bold">Estimated Time Remaining:</span> <span id="estimated-remaining-time">&#8734;</span>s\n</p>',$("#download-chooser .dialog-content .scrollable").append(s));try{p$("#download-progress-indicator").value=e.data.progress}catch(e){}p=(u=Date.now()-i)/(toFloat(e.data.progress)/1e3),_asm.progressTracking.estimate.push(p),n=_asm.progressTracking.estimate.mean()-u,$("#estimated-remaining-time").text(toInt(n/1e3))}else console.log("Just an update",e.data);else console.log("Toasting: "+e.data.updateUser),toastStatusMessage(e.data.updateUser,1e3);return!1}l=e.data.html,a="data:text/html;charset=utf-8,"+encodeURIComponent(l);try{o=a.length/1024/1024}catch(e){o=0}console.log("Downloadable size: "+o+" MiB"),t='<paper-dialog  modal class="download-file" id="download-html-file">\n  <h2>Your file is ready</h2>\n  <paper-dialog-scrollable class="dialog-content">\n    <p>\n      Please note that some taxa may have had incomplete data. Please download a CSV or SQL file for the uncombined taxon data.\n    </p>\n    <p class="text-center">\n      <a href="'+a+'" download="asm-species-'+r+'.html" class="btn btn-default data-download-button" id="download-html-summary"><iron-icon icon="icons:file-download"></iron-icon> Download HTML</a>\n      <div id="pdf-download-placeholder" class="data-download-button">\n        <paper-spinner active></paper-spinner> Please wait while your PDF creation finishes ...\n      </div>\n    </p>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("#download-html-file").exists()?$("#download-html-file").replaceWith(t):$("body").append(t),$("#download-chooser").on("iron-overlay-closed",function(){return delay(100,function(){return $(this).remove()})});try{p$("#download-chooser").close()}catch(e){}return o>=2?(console.debug("Large file size triggering blob creation"),downloadDataUriAsBlob("#download-html-summary")):console.debug("File size is small enough to use a data-uri"),safariDialogHelper("#download-html-file"),stopLoad(),toastStatusMessage("Please wait while we prepare your PDF file...","",7e3),d='<a href="#" disabled class="btn btn-danger" id="download-pdf-summary"><iron-icon icon="icons:error"></iron-icon> PDF Creation Failed</a>',console.debug("Posting for PDF"),$.post(uri.urlString+"pdf/pdfwrapper.php","html="+encodeURIComponent(l),"json").done(function(e){var t,a;return console.debug("PDF result",e),e.status?(a=""+uri.urlString+e.file,console.debug(a),t='<a href="'+a+'" download="asm-species-'+r+'.pdf" class="btn btn-default data-download-button" id="download-pdf-summary"><iron-icon icon="file-download"></iron-icon> Download PDF</a>',$("#download-html-file #download-html-summary").after(t)):(stopLoadError("Couldn't make PDF file"),$("#download-html-file #download-html-summary").after(d))}).error(function(e,t){return stopLoadError("Wasn't able to fetch PDF"),$("#download-html-file #download-html-summary").after(d)}).always(function(){var e;try{$("#download-html-file #pdf-download-placeholder").remove()}catch(e){}return e=Date.now()-i,console.debug("HTML+PDF time elapsed: "+e+"ms")}),!1}),a.postMessage(t),!1}).fail(function(){return stopLoadError("There was a problem communicating with the server. Please try again later.")})}).fail(function(){return stopLoadError("Unable to fetch styles for printout"),!1}),!1},showDownloadChooser=function(){var e;return e='<paper-dialog id="download-chooser" modal>\n  <h2>Select Download Type</h2>\n  <paper-dialog-scrollable class="dialog-content">\n    <p>\n      Once you select a file type, it will take a moment to prepare your download. Please be patient.\n    </p>\n    <div>\n      <paper-toggle-button id="use-search">Use current search results</paper-toggle-button>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Cancel</paper-button>\n    <paper-button id="initiate-csv-download">CSV/SQL</paper-button>\n    <paper-button id="initiate-html-download">HTML/PDF</paper-button>\n  </div>\n</paper-dialog>',$("#download-chooser").exists()||$("body").append(e),$("#initiate-csv-download").click(function(){var e;try{e=p$("#use-search").checked}catch(t){e=!1}try{p$("#use-search").disabled=!0}catch(e){}return downloadCSVList(e)}),$("#initiate-html-download").click(function(){var e;try{e=p$("#use-search").checked}catch(t){e=!1}try{p$("#use-search").disabled=!0}catch(e){}return downloadHTMLList(e)}),$("#download-chooser").on("iron-overlay-closed",function(){return delay(100,function(e){return function(){return $(e).remove()}}(this))}),safariDialogHelper("#download-chooser"),!1};var executeQuery,getTerminalDependencies,loadTerminalDialog,parseQuery,slice=[].slice;loadTerminalDialog=function(e){return null==e&&(e=!1),getTerminalDependencies(function(){var t;return $("#sql-query-dialog").exists()||e||(t='<paper-dialog id="sql-query-dialog" modal>\n  <paper-dialog-scrollable>\n    <div class="row query-container">\n      <form class="form">\n        <div class="form-group">\n          <textarea id="sql-input"\n                    rows="5"\n                    class="form-control"\n                    placeholder="SQL query here"\n                    autofocus></textarea>\n          <p class="text-muted">\n            <strong>Tip:</strong> Use <kbd>@@</kbd> to represent the database table and <kbd>!@</kbd> to represent <code class="language-null">SELECT * FROM table</code>. You can search columns using DarwinCore or columns specified in Github.\n          </p>\n        </div>\n      </form>\n      <p class="col-xs-12">Interpreted Query:</p>\n      <code class="language-sql col-xs-11 col-xs-offset-1" id="interpreted-sql"></code>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id="clear-sql-results">Clear Results</paper-button>\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("body").append(t),$("#sql-query-dialog").find("form").submit(function(e){return e.preventDefault(),executeQuery(),!1}),$("#sql-input").keydown(function(e){if(13===(e.keyCode?e.keyCode:e.which))return e.preventDefault(),executeQuery(),!1}),$("#sql-input").keyup(function(e){return 13!==(e.keyCode?e.keyCode:e.which)&&parseQuery(this),!0}),$("#clear-sql-results").click(function(){return $("#sql-results").remove(),!1})),p$("#sql-query-dialog").open()}),!1},getTerminalDependencies=function(){var e,t,a,n,r;return t=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],!0===_asm.terminalDependencies&&(console.log("Dependencies are already loaded, executing immediately"),"function"==typeof t&&t.apply(null,e)),n={nacl:!1,prism:!1},_asm.terminalDependencies=!1,_asm.terminalDependenciesChecking=!1,a=function(){var r,o,i;if(!0===_asm.terminalDependencies)return!0;if(_asm.terminalDependenciesChecking)return delay(50,function(){return a()}),!1;_asm.terminalDependenciesChecking=!0,o=!0;for(r in n)if(i=n[r],!(o=o&&i)){console.log("Library "+r+" isn't yet ready...");break}return _asm.terminalDependencies=o,_asm.terminalDependenciesChecking=!1,o&&(console.log("Dependencies loaded"),"function"==typeof t&&t.apply(null,e)),o},r=function(){return nacl_factory.instantiate(function(e){return _asm.nacl=e,n.nacl=!0,a()})},"undefined"==typeof nacl_factory||null===nacl_factory?loadJS("bower_components/js-nacl/lib/nacl_factory.js",function(){return r()}):r(),loadJS("bower_components/prism/prism.js",function(){return loadJS("bower_components/prism/components/prism-sql.js",function(){return n.prism=!0,loadJS("bower_components/prism/components/prism-json.js"),a(),!1}),$("head").append('<link href="bower_components/prism/themes/prism.css" rel="stylesheet" />')}),!1},parseQuery=function(e,t){var a,n;return null==e&&(e="#sql-input"),null==t&&(t="#interpreted-sql"),n=$(e).val().trim(),n=n.replace(/@@/gim,"`mammal_diversity_database`"),n=n.replace(/!@/gim,"SELECT * FROM `mammal_diversity_database`"),a=$(t).get(0),$(a).text(n),Prism.highlightElement(a),n},executeQuery=function(){var e,t,a,n;a=function(e){var t,a,n;null==e&&(e="Error");try{t=_asm.nacl.decode_utf8(_asm.nacl.crypto_hash_string(e+Date.now()))}catch(e){a=e,console.warn(a.message),console.warn(a.stack),t="sql-query-alert"}return n='<div class="alert alert-danger alert-dismissable col-xs-8 col-offset-xs-2 center-block clear clearfix" role="alert" id="'+t+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <div class="alert-message">'+e+"</div>\n</div>",$("#sql-input").parents("paper-dialog").find(".alert").remove(),$("#sql-input").parents("form").after(n),stopLoadError(),!1};try{t=p$("#dwc-only").checked}catch(e){}return n=parseQuery(),isNull(n)?a("Sorry, you can't use an empty query"):(e={sql_query:post64(n),action:"query",dwc:null!=t&&t},console.debug("Posting to target",uri.urlString+"api.php?"+buildQuery(e)),$.post(uri.urlString+"api.php",buildQuery(e,"json")).done(function(e){var t,n,r,o,i,s,l,c,d,u,p,m,h,g,f,b,y,w,v,x,_;console.log("Got result",e),$("#sql-results").remove();try{null!=e.statements&&(_=Object.toArray(e.statements))}catch(e){}if(!0!==e.status){if(isNull(e.statement_count))return t=null!=(h=null!=(g=e.error)?g:e.human_error)?h:"UNKNOWN_ERROR",a(t);for(i=0,d=_.length;i<d;i++)if("ERROR"===(x=_[i]).result)return n="Your query <code class='language-sql'>"+x.provided+"</code> ",!0!==x.error.safety_check?n+="failed a safety check.":!1===x.error.sql_response?n+="has or generated during parsing a syntax error.<br/><br/>If you believe your syntax to be valid, try simplifying it as we strictly limit the types of queries accessible here.":x.error.was_server_exception?n+="generated a problem on the server and was refused to be executed. Please report this.":n+="gave <code>UNKNOWN_QUERY_ERROR</code>",n+="<br/><br/>Execution of your query was halted here.",a(n)}for($("#sql-input").parents("paper-dialog").find(".alert").remove(),r='<div id="sql-results" class="sql-results col-xs-12">\n</div>',$("#interpreted-sql").exists()?$("#interpreted-sql").after(r):$("#sql-input").parents("form").after(r),v=new Array,o=0,l=0,u=_.length;l<u;l++)if(x=_[l],0===(f=Object.toArray(x.result)).length)w="<code>ZERO_RESULTS</code>",v.push(w);else for(++o,s=0,m=0,p=f.length;m<p;m++){b=f[m],++s;try{y=JSON.stringify(b),y=y.replace(/,"/gim,', "'),c="json"}catch(e){y="Unable to parse row",c="text"}w="<div>\n  "+o+"."+s+':\n  <code class="language-'+c+'">'+y+"</code>\n</div>",v.push(w)}return $("#sql-results").html(v.join("<br/><br/>")),Prism.highlightAll(),!1}).fail(function(e,t){return console.error(e,t),console.warn("Couldn't hit target"),a("Problem talking to the server, please try again"),!1}),!1)},$(function(){var e;return e='<paper-icon-button icon="icons:code" id="launch-term" title="Directly Query Database" data-toggle="tooltip">\n</paper-icon-button>',$("#git-footer").append(e),$("#launch-term").click(function(){return loadTerminalDialog.debounce()}),!1});
//# sourceMappingURL=app.min.js.map
