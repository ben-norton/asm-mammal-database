function shuffle(e){for(var t,r,n=e.length;n;t=Math.floor(Math.random()*n),r=e[--n],e[n]=e[t],e[t]=r);return e}var _metaStatus,activityIndicatorOff,activityIndicatorOn,allError,animateHoverShadows,animateLoad,bindClickTargets,bindClicks,bindDismissalRemoval,bindPaperMenuButton,browserBeware,bsAlert,buildQuery,byteCount,checkFileVersion,checkLaggedUpdate,checkLocalVersion,checkTaxonNear,clearSearch,dataUriToBlob,dateMonthToString,deEscape,decode64,deepJQuery,delay,delayPolymerBind,doCORSget,doFontExceptions,doLazily,doNothing,domainPlaceholder,downloadDataUriAsBlob,e,encode64,error1,eutheriaFilterHelper,executeQuery,fetchMajorMinorGroups,foo,formatScientificNames,formatSearchResults,getElementHtml,getFilters,getLocation,getMaxZ,getRandomEntry,getTerminalDependencies,goTo,insertCORSWorkaround,insertModalImage,interval,isArray,isBlank,isBool,isEmpty,isJson,isNull,isNumber,isNumeric,jsonTo64,lightboxImages,loadJS,loadTerminalDialog,mapNewWindows,modalTaxon,objToArgs,openLink,openTab,overlayOff,overlayOn,p$,parseQuery,parseTaxonYear,performSearch,post64,prepURI,randomInt,ref,roundNumber,roundNumberSigfig,safariDialogHelper,safariSearchArgHelper,searchParams,setHistory,setupServiceWorker,showBadSearchErrorMessage,smartUpperCasing,sortResults,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,uri,slice=[].slice,indexOf=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++)if(t in this&&this[t]===e)return t;return-1};(uri={}).o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory");try{uri.urlString=uri.urlString.replace(/(.*)\/(((&?[a-zA-Z_\-]+=[a-zA-Z_\-\+0-9%=]+)+)\/?)(.*)/gim,"$1/"),-1===uri.urlString.split("/").pop().search(/\./)&&"/"!==uri.urlString.slice(-1)&&(uri.urlString=uri.urlString.slice(0,uri.urlString.search(uri.urlString.split("/").pop())))}catch(e){}uri.query=uri.o.attr("fragment"),(domainPlaceholder=uri.o.attr("host").split(".")).pop(),uri.domain=null!=(ref=domainPlaceholder[0])?ref:"",_metaStatus={},window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,isBool=function(e){return!0===e||!1===e},isEmpty=function(e){return!e||0===e.length},isBlank=function(e){return!e||/^\s*$/.test(e)},isNull=function(e,t){var r;if(null==t&&(t=!1),"object"==typeof e)try{if(null!=(r=e.length))try{return 0===r}catch(e){}return 0===Object.size}catch(e){}try{if(isEmpty(e)||isBlank(e)||null==e){if(!1!==e&&0!==e)return!0;if(t&&(!1===e||0===e))return!0}}catch(e){return e,!1}try{e=(""+e).toLowerCase()}catch(e){}return"undefined"===e||"null"===e||!(!t||"false"!==e&&"0"!==e)},isJson=function(e){if("object"==typeof e)return!0;try{return JSON.parse(e),!0}catch(e){}return!1},isArray=function(e){try{return e.slice(0).push("foo"),!0}catch(e){return!1}},isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isNumeric=function(e){return isNumber(e)},toFloat=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseFloat(e)},toInt=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseInt(e)},String.prototype.noExponents=function(e){var t,r,n,a,o,i,s,l;if(null==e&&(e=!0),1===(t=this.split(/[eE]/)).length)return t[0];if(l="",i="-"===this.slice(0,1)?"-":"",s=t[0].replace(".",""),(n=+t[1]+1)<=0){for(l=i+"0.";!(n>=0);)l+="0",++n;return o=l+s.replace(/^\-/,""),e?parseFloat(o):o}if(s.length<=n){for(n-=s.length;!(n<=0);)l+=0,--n;return o=s+l,e?parseFloat(o):o}return r=parseFloat(t[0]),a=Math.pow(10,parseInt(t[1])),r*a},Number.prototype.noExponents=function(){return(this+"").noExponents(!0)},toObject=function(e){var t,r,n;n={};for(r in e)void 0!==(t=e[r])&&(n[r]=t);return n},String.prototype.toAscii=function(){return this.replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g,"'").replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/\u02C6/g,"^").replace(/\u2039/g,"").replace(/[\u02DC|\u00A0]/g," ")},String.prototype.toBool=function(){return""+this=="true"},Boolean.prototype.toBool=function(){return""+this=="true"},Number.prototype.toBool=function(){return""+this=="1"},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.containsObject=function(e){try{return"object"==typeof _.find(this,function(t){return _.isEqual(e,t)})}catch(e){return e,console.error("Please load underscore.js before using this."),console.info("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")}},Array.prototype.sum=function(){return this.reduce(function(e,t){return e+t})},Array.prototype.mean=function(){return this.sum()/this.length},Object.toArray=function(e){try{return e.slice(0).push("foo"),e}catch(e){}return Object.keys(e).map(function(t){return function(t){return e[t]}}())},Object.size=function(e){var t,r,n;if("object"!=typeof e)try{return e.length}catch(e){t=e,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(t.message)}n=0;for(r in e)e.hasOwnProperty(r)&&n++;return n},Object.doOnSortedKeys=function(e,t){var r,n,a,o,i;for(o=[],a=0,n=(i=Object.keys(e).sort()).length;a<n;a++)r=e[i[a]],o.push(t(r));return o},delay=function(e,t){return setTimeout(t,e)},interval=function(e,t){return setInterval(t,e)},roundNumber=function(e,t){var r;return null==t&&(t=0),r=Math.pow(10,t),Math.round(e*r)/r},roundNumberSigfig=function(e,t){var r,n,a,o,i;return null==t&&(t=0),a=""+roundNumber(e,t),1===(r=a.split(".")).length?a+"."+Array(t+1).join("0"):(i=r.pop(),o=r[0]+".",i.length===t?a:(n=t-i.length,i+=Array(n+1).join("0"),""+o+i))},String.prototype.stripHtml=function(e){var t;return null==e&&(e=!1),t=this,e&&(t=t.replace(/<(\w+)(?:[^"'>]|"[^"]*"|'[^']*')*>(?:((?:.)*?))<\/?\1(?:[^"'>]|"[^"]*"|'[^']*')*>/gm,"")),t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),t=t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")},String.prototype.unescape=function(e){var t,r,n;return null==e&&(e=!1),r=document.createElement("div"),t=function(t){return null!=t&&"string"==typeof t&&(t=!0!==e?escape(t).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"):(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),r.innerHTML=t,r.innerText?(t=r.innerText,r.innerText=""):(t=r.textContent,r.textContent="")),unescape(t)},n=deEscape(this),t(n)},deEscape=function(e){return e=e.replace(/\&amp;#/gm,"&#"),e=e.replace(/\&quot;/gm,'"'),e=e.replace(/\&quote;/gm,'"'),e=e.replace(/\&#95;/gm,"_"),e=e.replace(/\&#39;/gm,"'"),e=e.replace(/\&#34;/gm,'"'),e=e.replace(/\&#62;/gm,">"),e=e.replace(/\&#60;/gm,"<")},String.prototype.escapeQuotes=function(){var e;return e=this.replace(/"/gm,"&#34;"),e=e.replace(/'/gm,"&#39;")},getElementHtml=function(e){return e.outerHTML},jQuery.fn.outerHTML=function(){return $(this).get(0).outerHTML},jQuery.fn.outerHtml=function(){return $(this).outerHTML()},jQuery.fn.selectText=function(){var e,t,r=document,n=this[0];r.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(n),e.select()):window.getSelection&&(t=window.getSelection(),(e=document.createRange()).selectNodeContents(n),t.removeAllRanges(),t.addRange(e))},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.polymerSelected=function(e,t,r,n,a){var o,i,s,l,c,u,d,p,m,f,h,g,y,b;if(null==e&&(e=void 0),null==t&&(t="attrForSelected"),null==r&&(r="paper-listbox"),null==n&&(n="paper-item"),null==a&&(a=!0),!$(this).exists())return console.error("Nonexistant element"),!1;if(i=$(this).attr("id"),isNull(i))return console.error("Your parent dropdown (eg, paper-dropdown-menu) must have a unique ID"),!1;s="#"+i+" "+r;try{r===$(this).get(0).tagName.toLowerCase()&&(s=this)}catch(e){}if(!$(s).exists()){s="#"+i+" "+(r="paper-menu");try{r===$(this).get(0).tagName.toLowerCase()&&(s=this)}catch(e){}if(!$(s).exists()){try{return isNull(p$(this).value)?null:p$(this).value}catch(e){console.error("Can't identify the dropdown selector for this dropdown list '"+i+"'",s,this)}return console.warn("Unable to fetch data for item","#"+i),!1}}if(!0!==t?(o=$(s).attr(t),isNull(o)&&(o=!0)):o=!0,null==e){b=void 0;try{try{b=p$(this).selected}catch(e){}isNull(b)&&(b=p$(s).selected),isNumber(b)&&!isNull(o)?(d=$(this).find(n)[toInt(b)],b=!0!==o?$(d).attr(o):$(d).text()):(console.debug("isNumber(val)",isNumber(b,b)),console.debug("isNull attr",isNull(o,o)))}catch(e){return l=e,console.error("Couldn't find selected: "+l.message),console.warn(l.stack),console.debug("Selector",s),!1}"null"!==b&&null!=b||(b=void 0);try{b=b.trim()}catch(e){}return b}if(g=s,isBool(e)||isNull(e)){if(isBool(e)&&($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",e),$(this).prop("active",e),$(this).prop("aria-selected",e),!0===e))return $(this).addClass("iron-selected")}else try{if(!0===o){for(m=0,p=(f=$(this).find(n)).length;m<p;m++)if(u=f[m],y=a?$(u).text().toLowerCase().trim():$(u).text(),h=a?e.toLowerCase().trim():e,y===h){c=$(u).index();break}if(isNull(c))return console.error("Unable to find an index for "+n+" with text '"+e+"' (ignore case: "+a+")"),!1;try{p$(g).select(c)}catch(e){l=e,p$(g).selected=c}p$(g).selected!==c&&doNothing()}else try{p$(g).select(e)}catch(t){p$(g).selected=e}return!0}catch(t){return l=t,console.error("Unable to set selected '"+e+"': "+l.message),!1}},jQuery.fn.polymerChecked=function(e){var t;return null==e&&(e=void 0),null!=e?jQuery(this).prop("checked",e):("null"!==(t=jQuery(this)[0].checked)&&null!=t||(t=void 0),t)},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(e){return function(e){return encodeURI(e).split(/%..|./).length-1}}(),randomInt=function(e,t){var r,n,a;return null==e&&(e=0),null==t&&(t=1),a=Math.random(),null==e&&(e=(r=[0,e])[0],t=r[1]),e>t&&(e=(n=[t,e])[0],t=n[1]),Math.floor(a*(t-e+1)+e)},window.debounce_timer=null,Function.prototype.getName=function(){var e;return null==(e=this.name)&&(e=(""+this).substr(0,(""+this).indexOf("(")).replace("function ","")),isNull(e)&&(e=md5(""+this)),e},Function.prototype.debounce=function(){var e,t,r,n,a,o,i,s;i=arguments[0],r=arguments[1],s=arguments[2],e=4<=arguments.length?slice.call(arguments,3):[],null==i&&(i=300),null==r&&(r=!1),null==s&&(s=window.debounce_timer),null==(null!=(o=window.core)?o.debouncers:void 0)&&(null==window.core&&(window.core={}),core.debouncers={});try{a=this.getName()}catch(e){}try{null!=core.debouncers[a]&&(s=core.debouncers[a])}catch(e){}if(n=this,t=function(){if(null!=a&&(clearTimeout(s),delete core.debouncers[a]),!r)return n.apply(n,e)},null!=s)try{clearTimeout(s)}catch(e){e}return r?(n.apply(obj,e),console.debug("Executed "+a+" immediately"),!1):null!=a?core.debouncers[a]=delay(i,function(){return t()}):window.debounce_timer=delay(i,function(){return t()})},loadJS=function(e,t,r){var n,a,o,i;if(null==t&&(t={}),null==r&&(r=!0),$("script[src='"+e+"']").exists()){if("function"==typeof t)try{t()}catch(e){n=e,console.error("Script is already loaded, but there was an error executing the callback function - "+n.message)}return!0}return(i=document.createElement("script")).setAttribute("src",e),i.setAttribute("async","async"),i.setAttribute("type","text/javascript"),i.src=e,i.async=!0,o=function(){var r;r=i.readyState;try{if(!t.done&&(!r||/loaded|complete/.test(r))&&(t.done=!0,"function"==typeof t))try{return t()}catch(t){return n=t,console.error("Postload callback error for '"+e+"' - "+n.message)}}catch(t){return n=t,console.error("Onload error for '"+e+"' - "+n.message)}},a=function(){console.warn("There may have been a problem loading "+e);try{if(!t.done&&(t.done=!0,"function"==typeof t&&r))try{return t()}catch(e){return n=e,console.error("Post error callback error - "+n.message)}}catch(e){return n=e,console.error("There was an error in the error handler! "+n.message)}},i.setAttribute("onload",o),i.setAttribute("onreadystate",o),i.setAttribute("onerror",a),i.onload=i.onreadystate=o,i.onerror=a,document.getElementsByTagName("head")[0].appendChild(i),!0},String.prototype.toTitleCase=function(){var e,t,r,n,a,o,i,s,l;for(o=this.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),r=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],n=0,21;n<21;n++)e=r[n],t=RegExp("\\s"+e+"\\s","g"),o=o.replace(t,function(e){return e.toLowerCase()});for(l=["Id","Tv"],a=0,2;a<2;a++)i=l[a],s=RegExp("\\b"+i+"\\b","g"),o=o.replace(s,i.toUpperCase());return o},smartUpperCasing=function(e){var t,r,n,a,o,i,s,l,c,u,d;if(isNull(e))return"";o=function(e){return e.replace(e,e.toUpperCase())},c=e.replace(/((?=((?!-)[\W\s\r\n]))\s[A-Za-z]|^[A-Za-z])/g,o),u=["a","an","and","at","but","by","for","in","nor","of","on","or","out","so","to","the","up","yet"];try{for(r=0,t=18;r<t;r++)i=(d=u[r]).toTitleCase(),a=d.toLowerCase(),n=RegExp(" "+i+" ","g"),c=c.replace(n," "+a+" ")}catch(e){}try{c.match(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/m)&&(l=(s=c.replace(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/gm,"$2")).toTitleCase(),c=c.replace(s,l))}catch(e){}return c},mapNewWindows=function(e){return null==e&&(e=!0),$(".newwindow").each(function(){var t,r;return null==(t=$(this).attr("href"))&&(t=$(this).attr("data-href")),r=function(e){return null!=e&&(window.open(e),!1)},$(this).click(function(n){return e&&(n.preventDefault(),n.stopPropagation()),r(t)}),$(this).keypress(function(){return r(t)})})},toastStatusMessage=function(e,t,r,n){var a,o;return null==t&&(t=""),null==r&&(r=3e3),null==n&&(n="#search-status"),!0===window._metaStatus.isToasting?(delay(250,function(){return toastStatusMessage(e,t,r,n)}),!1):(window._metaStatus.isToasting=!0,isNumber(t)&&(r=t),isNumber(r)||(r=3e3),!1===n.slice(0,1)&&(n="#"+n),$(n).exists()||(a='<paper-toast id="'+n.slice(1)+'" duration="'+r+'"></paper-toast>',$(a).appendTo("body")),$(n).attr("text",e).text(e).addClass(t),(o=function(e){var a;++e;try{return p$(n).show(),delay(r+500,function(){var e;try{e=p$(n).opened}catch(e){}return"boolean"!=typeof e&&(e=!1),e||($(n).empty(),$(n).removeClass(t),$(n).attr("text","")),window._metaStatus.isToasting=!1,!1})}catch(t){return a=t,e<=50?delay(50,function(){return o(e),!1}):(console.error("Couldn't show loader: "+a.message),console.warn(a.stack))}})(0),delay(r,function(){return _metaStatus.isToasting=!1}),!1)},openLink=function(e){return null!=e&&(window.open(e),!1)},openTab=function(e){return openLink(e)},goTo=function(e){return null!=e&&(window.location.href=e,!1)},null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(window._metaStatus={}),_metaStatus.isLoading=!1,_metaStatus.isToasting=!1),animateLoad=function(e,t){var r,n;null==e&&(e="loader"),null==t&&(t=0),isNumber(e)&&(e="loader"),"#"===e.slice(0,1)?(n=e,e=e.slice(1)):n="#"+e,$(n).removeAttr("hidden"),null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(_metaStatus={}),_metaStatus.isLoading=!1);try{return _metaStatus.isLoading?t<100?(t++,delay(100,function(){return animateLoad(e,t)}),!1):(console.warn("Loader timed out waiting for load completion"),!1):($(n).exists()?$(n).attr("active",!0):$("body").append('<paper-spinner id="'+e+'" active></paper-spinner'),_metaStatus.isLoading=!0,!1)}catch(e){return r=e,console.warn("Could not animate loader",r.message)}},startLoad=function(e){return null==e&&(e=null),animateLoad(e)},stopLoad=function(e,t,r){var n,a;null==e&&(e="loader"),null==t&&(t=1e3),null==r&&(r=0),"#"===e.slice(0,1)?(a=e,e=e.slice(1)):a="#"+e;try{try{!0!==_metaStatus.isLoading&&p$(a).active&&$(a).isVisible()&&(_metaStatus.isLoading=!0)}catch(e){}return _metaStatus.isLoading?($(a).exists()&&($(a).addClass("good"),function(){return delay(t,function(){try{p$(a).active=!1}catch(e){}return $(a).removeClass("good").attr("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(a).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(a).remove(),_metaStatus.isLoading=!1):($(a).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(a).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):r<100&&(r++,delay(100,function(){return stopLoad(e,t,r)}),!1)}catch(e){return n=e,console.warn("Could not stop load animation",n.message)}},stopLoadError=function(e,t,r,n){var a,o;null==t&&(t="loader"),null==r&&(r=7500),"#"===t.slice(0,1)?(o=t,t=t.slice(1)):o="#"+t;try{return _metaStatus.isLoading?($(o).exists()&&($(o).addClass("bad"),null!=e&&toastStatusMessage(e,"",r),function(){return delay(r,function(){return $(o).removeClass("bad").prop("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(o).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(o).remove(),_metaStatus.isLoading=!1):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):n<100&&(n++,delay(100,function(){return stopLoadError(e,t,r,n)}),!1)}catch(e){return a=e,console.warn("Could not stop load error animation",a.message)}},doCORSget=function(e,t,r,n){var a,o,i,s;null==r&&(r=void 0),null==n&&(n=void 0),a=function(){if("function"==typeof n)return n();throw Error("There was an error performing the CORS request")},i={url:e,data:t,type:"get",crossDomain:!0};try{$.ajax(i).done(function(e){if("function"==typeof r)return r(),!1}).fail(function(e,t){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(e){e,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(e=e+"?"+t,o=function(e,t){var r;return null==e&&(e="get"),r=new XMLHttpRequest,"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest).open(e,t):r=null,r},!(s=o("get",e)))throw Error("CORS not supported");return s.onload=function(){var e;return e=s.responseText,"function"==typeof r&&r(e),!1},s.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),a()},s.send(),!1},deepJQuery=function(e){try{if(!$("html /deep/ "+e).exists())throw"Bad /deep/ selector";return $("html /deep/ "+e)}catch(t){t;try{if(!$("html >>> "+e).exists())throw"Bad >>> selector";return $("html >>> "+e)}catch(t){return t,$(e)}}},p$=function(e){try{return $$(e)[0]}catch(t){try{return $(e).get(0)}catch(t){return d$(e).get(0)}}},window.d$=function(e){return deepJQuery(e)},lightboxImages=function(e,t){var r,n;return null==e&&(e=".lightboximage"),null==t&&(t=!1),n={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},_asm.lightbox={options:n},r=t?d$(e):$(e),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return r.click(function(e){try{return e.preventDefault(),e.stopPropagation(),$(this).imageLightbox(n).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(t){return e=t,console.error("Unable to lightbox this image!")}}).each(function(){var t,r;console.log("Using selectors '"+e+"' / '"+this+"' for lightboximages");try{if(("img"===$(this).prop("tagName").toLowerCase()||"picture"===$(this).prop("tagName").toLowerCase())&&"a"!==$(this).parent().prop("tagName").toLowerCase())return r=$(this).removeClass("lightboximage").prop("outerHTML"),t=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");case!!isNull($(this).attr("src")):return $(this).attr("src");default:return $(this).find("img").attr("src")}}.call(this),$(this).replaceWith("<a href='"+t+"' data-lightbox='"+t+"' class='lightboximage'>"+r+"</a>"),$("a[href='"+t+"']").imageLightbox(n)}catch(e){return e,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",r)}),!1},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(e){return null==e&&(e=".sciname"),$(".sciname").each(function(){var e;return e="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",e)})},prepURI=function(e){return(e=encodeURIComponent(e)).replace(/%20/g,"+")},getLocation=function(e){var t,r;return null==e&&(e=void 0),r=function(e,t){return window.locationData.lat=e.coords.latitude,window.locationData.lng=e.coords.longitude,window.locationData.acc=e.coords.accuracy,window.locationData.last=Date.now(),null!=t&&t(window.locationData),!1},t=function(e,t){var r;return r=function(){switch(e.code){case 0:return"There was an error while retrieving your location: "+e.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+e.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(r),null!=t&&t(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(r,t,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=e?e(!1):void 0)},dateMonthToString=function(e){var t,r;t={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};try{r=t[e]}catch(t){r=e}return r},bindClickTargets=function(){return bindClicks(),!1},bindClicks=function(e){return null==e&&(e=".click"),$(e).each(function(){var e,t,r,n;try{if(n=$(this).attr("data-href"),isNull(n)&&null!=(n=$(this).attr("data-url"))&&$(this).attr("data-newtab","true"),!isNull(n)){$(this).unbind();try{n===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(e){t=e,console.warn("tagname lower case error")}return $(this).click(function(){var e,t,r;return n=$(this).attr("data-href"),isNull(n)&&(n=$(this).attr("data-url")),(null!=(e=$(this).attr("newTab"))?e.toBool():void 0)||(null!=(t=$(this).attr("newtab"))?t.toBool():void 0)||(null!=(r=$(this).attr("data-newtab"))?r.toBool():void 0)?openTab(n):goTo(n)}),n}if(null!=(e=null!=(r=$(this).attr("data-function"))?r:$(this).attr("data-fn")))return $(this).unbind(),$(this).click(function(){try{return window[e]()}catch(r){return t=r,console.error("'"+e+"()' is a bad function - "+t.message)}})}catch(e){return t=e,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+t.message)}}),!1},getMaxZ=function(){var e;return e=function(){return $.map($("body *"),function(e,t){if("static"!==$(e).css("position"))return parseInt($(e).css("z-index")||1)})},Math.max.apply(null,e())},browserBeware=function(){return!1},bsAlert=function(e,t,r,n){var a,o,i,s,l,c;null==t&&(t="warning"),null==r&&(r="body"),null==n&&(n="#bs-alert");try{$(n).exists()?($(n).removeClass("alert-warning alert-info alert-danger alert-success"),$(n).addClass("alert-"+t)):(l='<div class="alert alert-'+t+' alert-dismissable hanging-alert" role="alert" id="'+n.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',c=$("main").exists()?"main":$("article").exists()?"article":r,$(c).prepend(l)),$(n+" .alert-message").html(e)}catch(r){(a=document.createElement("div")).setAttribute("class","alert alert-"+t+" alert-dismissable hanging-alert"),a.setAttribute("role","alert"),a.setAttribute("id",n.slice(1)),(i=document.createElement("button")).setAttribute("class","close"),i.setAttribute("data-dismiss","alert"),i.setAttribute("aria-label","Close"),(s=document.createElement("span")).setAttribute("aria-hidden","true"),s.textContent="&times;",i.appendChild(s),a.appendChild(i),(o=document.createElement("div")).setAttribute("class","alert-message"),o.textContent=e,a.appendChild(o);try{document.querySelector("#bs-alert").remove()}catch(e){}document.querySelector("body").appendChild(a)}return bindClicks(),mapNewWindows(),!1},animateHoverShadows=function(e,t,r){var n,a;return null==e&&(e="paper-card.card-tile"),null==t&&(t=2),null==r&&(r=4),n=function(){return $(this).attr("elevation",r)},a=function(){return $(this).attr("elevation",t)},$(e).hover(n,a),!1},allError=function(e){return stopLoadError(e),bsAlert(e,"danger"),console.error(e),!1},checkFileVersion=function(e){var t;return null==e&&(e=!1),t=function(){return $.get(uri.urlString+"meta.php","do=get_last_mod","json").done(function(t){var r;return e&&console.log("Forced version check:",t),!!isNumber(t.last_mod)&&(null==_asm.lastMod&&(_asm.lastMod=t.last_mod),t.last_mod>_asm.lastMod?(r='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(r),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version is out of date! Please refresh the page.")):e?console.info("Your version is up to date: have "+_asm.lastMod+", got "+t.last_mod):void 0)}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){return delay(3e5,function(){return t()})})},!(!e&&null!=_asm.lastMod)&&(t(),!0)},window.checkFileVersion=checkFileVersion,setupServiceWorker=function(){return"serviceworker"in navigator&&navigator.serviceWorker.register("js/serviceWorker.min.js").then(function(e){return console.log("ServiceWorker registered with scope",e.scope)}).catch(function(e){return console.warn("ServiceWorker registration failed:",e)}),!1},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},doNothing=function(){return null},buildQuery=function(e){var t,r,n,a,o;n=[];for(t in e)a=e[t],r=t.replace(/[^A-Za-z\-_\[\]]/gim,""),o=encodeURIComponent(a).replace(/\%20/g,"+"),n.push(r+"="+o);return n.join("&")},checkLocalVersion=function(){var e,t,r,n,a,o;if("localhost"===uri.o.attr("host")){for(a=[],t=0,e=(o=uri.o.attr("directory").split("/")).length;t<e;t++)r=o[t],isNull(r)||a.push(r);n=0===a[0].search("~")?uri.o.attr("protocol")+"://localhost"+a[0]+"/":uri.urlString,$.get(n+"currentVersion").done(function(e){var t,n,a,o;return console.log("Got tag",e),(a=e.replace(/v(([0-9]+\.)+[0-9]+)(\-\w+)?/gim,"$1")).length>128?(console.error("Problem checking version file"),!1):(o=a.split("."),t={access_token:"7a76691c6beea4d47eaaa6182a53e523c6a16a67"},n="https://api.github.com/repos/tigerhawkvok/asm-mammal-database/releases",$.get(n,buildQuery(t,"json")).done(function(e){var t,n,i,s,l,c,u,d,p,m,f;for(console.log("Github API result:",e),c=0,i=e.length;c<i;c++)for(d=e[c],console.log("Checking release",d),n=0,u=0,s=(m=(p=d.tag_name).replace(/v(([0-9]+\.)+[0-9]+)(\-\w+)?/gim,"$1").split(".")).length;u<s;u++){if(r=m[u],f=toInt(r),l=toInt(o[n]),f>l)return console.log("Found mismatched version at",uri.urlString+"/currentVersion"),console.warn("Notice: tag part '"+f+"' > '"+l+"'",p,a),t='<strong>Head\'s-Up:</strong> Your local version is behind the latest application release.\n<br/><br/>\nOpen up your terminal, and in your local directory run:\n<br/><br/>\n<code class="center-block text-center">git pull</code>\n<br/>\nTo get your local version up-to-date.',bsAlert(t),!1;if(f<l)break;++n}return console.debug("Your version is up-to-date"),!1}))})}else doNothing();return!1},jsonTo64=function(e,t){var r,n;null==t&&(t=!0);try{e.slice(0).push("foo"),e=toObject(e)}catch(e){}return n=JSON.stringify(e),r=!0===t?post64(n):encode64(r)},encode64=function(e){try{return Base64.encode(e)}catch(t){return t,console.warn("Bad encode string provided"),e}},decode64=function(e){try{return Base64.decode(e)}catch(t){return t,console.warn("Bad decode string provided"),e}},post64=function(e){var t;return t=encode64(e),encodeURIComponent(t)},objToArgs=function(e){var t,r,n,a;if("object"!=typeof e)throw{message:"INVALID_TYPE"};r=[];for(n in e)a=e[n],t=n+"="+encodeURIComponent(a),r.push(t);return r.join("&")},dataUriToBlob=function(e,t){var r,n,a,o,i,s,l,c,u,d;i=e.split(",")[1],e.split(";")[1].split(",")[0];try{n=atob(i)}catch(e){n=decodeURIComponent(i)}for(l=n.length,r=new Uint8Array(l),d=e.split(",")[0].split(":")[1].split(";")[0],s=0,u=0,c=r.length;u<c;u++)r[u],r[s]=n.charCodeAt(s),++s;return o={type:d},a=new Blob([r],o),"function"==typeof t&&t(a),a},downloadDataUriAsBlob=function(e){var t,r,n;if(isNull(e))return console.error("Needs a data URI or element selector as an argument!"),!1;try{$(e).exists()&&(r=$(e).attr("href"))}catch(e){}return isNull(r)&&(r=e,e=null),t=dataUriToBlob(r),n=URL.createObjectURL(t),isNull(e)?n:($(e).attr("href",n),!1)},delayPolymerBind=function(e,t,r){var n;return null==r&&(r=0),"undefined"==typeof md5||null===md5?loadJS("bower_components/JavaScript-MD5/js/md5.min.js",function(){return n()}):n(),n=function(){var n,a,o,i;if("object"!=typeof window._dpb&&(window._dpb={}),i=md5(e)+md5(t),isNull(window._dpb[i])&&(window._dpb[i]=!1),1e3,null==("undefined"!=typeof Polymer&&null!==Polymer&&null!=(o=Polymer.Base)?o.$$:void 0))return r<50?delay(100,function(){return++r,delayPolymerBind(e,t,r)}):(console.error("Failed to verify Polymer was set up, attempting manual"),a=document.querySelector(e),t(a));!1===window._dpb[i]&&(r=0,window._dpb[i]=!0);try{return a=Polymer.Base.$$(e),t(a),delay(1e3,function(){return console.info("Doing 1000ms delay callback for "+e),t(a)})}catch(o){return n=o,console.warn("Error trying to do the delayed polymer bind - "+n.message),r<10?(++r,delay(75,function(){return delayPolymerBind(e,t,r)})):(console.error("Persistent error in polymer binding ("+n.message+")"),console.error(n.stack),a=$(e).get(0),t(a),delay(1e3,function(){return a=document.querySelector(e),console.info("Doing 1000ms delay callback for "+e),console.info("Using element",a),t(a)}))}},!1};try{$()}catch(error1){e=error1,bsAlert("<strong>You're offline</strong>: We need at least enough data to load a few dependencies. Please put yourself online and try again.","error")}$(function(){var t,r,n,a,o,i,s,l,c,u,d;try{checkLocalVersion(),interval(36e5,function(){return checkLocalVersion()})}catch(e){}formatScientificNames(),bindClicks(),mapNewWindows();try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(t){e=t,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),!0===("undefined"!=typeof adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)&&loadJS("js/admin.min.js",function(){return loadAdminUi()})}catch(t){e=t,getLocation(),loadJS("js/admin.min.js",function(){return _asm.inhibitRedirect=!0,verifyLoginCredentials(function(){var e,t,r;if(delete _asm.inhibitRedirect,"species-account.php"===uri.o.attr("file")&&"object"==typeof window.speciesData)try{return r=JSON.stringify(window.speciesData),e="#"+Base64.encode(r),t='<paper-icon-button\n  class="click admin-edit-button"\n  data-href="'+uri.urlString+"admin-page.html"+e+'"\n  icon="icons:create"\n  >\n</paper-icon-button>',$("header p paper-icon-button[icon='icons:home']").before(t),bindClicks(".admin-edit-button")}catch(e){}})}),loadJS("js/jquery.cookie.min.js",function(){return!1})}try{for(o=0,n=(u=$("marked-element")).length;o<n;o++)i=u[o],s=$(i).find("script").text(),isNull(s)||(p$(i).markdown=s)}catch(e){}browserBeware(),checkFileVersion();try{for(l=0,a=(d=$("figcaption .caption-description")).length;l<a;l++)t=d[l],r=$(t).text().unescape(),$(t).text(r)}catch(e){}try{return(c=function(e){var t;return $("figure picture").exists()?(t=$("figure picture").width(),isNull(t,!0)?++e>=10?(console.log("Never saw a bigger image width"),!1):(delay(100,function(){return c(e)}),!1):(e>0&&console.warn("Took "+100*e+"ms to reposition image!"),$("figure p.picture-label").css("left","calc(50% - ("+t+"px/2)*.95)"),lightboxImages(),!1)):(console.log("No image on page"),!1)})(0)}catch(e){}}),(searchParams={lastSearch:"*",targetApi:"api.php",targetContainer:"#result_container"}).apiPath=uri.urlString+searchParams.targetApi,window._asm={},_asm.affiliateQueryUrl={iucnRedlist:"http://apiv3.iucnredlist.org/api/v3/species/",iucnRedlistCN:"http://apiv3.iucnredlist.org/api/v3/species/common_names/",iNaturalist:"https://www.inaturalist.org/taxa/search"},fetchMajorMinorGroups=function(e,t){var r,n;if(null==e&&(e=null),n=function(){var r,n,a,o,i;$("#eutheria-extra").remove(),a='<paper-item data-type="any" selected>All</paper-item>',o=_asm.major;for(n in o)a+='<paper-item data-type="'+n+'">'+o[n].toTitleCase()+"</paper-item>";if(e?"linnean_family":"simple_linnean_subgroup",r='<paper-menu-button id="simple-linnean-groups" class="col-xs-6 col-md-4">\n  <paper-button class="dropdown-trigger"><iron-icon icon="icons:filter-list"></iron-icon><span id="filter-what" class="dropdown-label"></span></paper-button>\n  <paper-menu label="Group" data-column="simple_linnean_group" class="cndb-filter dropdown-content" id="linnean" name="type" attrForSelected="data-type" selected="0">\n    '+a+"\n  </paper-menu>\n</paper-menu-button>",$("#simple-linnean-groups").exists()){$("#simple-linnean-groups").replaceWith(r),$("#simple-linnean-groups").on("iron-select",function(){var e;return e=$(p$("#simple-linnean-groups paper-menu").selectedItem).text(),$("#simple-linnean-groups span.dropdown-label").text(e)});try{i=$(p$("#simple-linnean-groups paper-menu").selectedItem).text(),$("#simple-linnean-groups span.dropdown-label").text(i)}catch(e){}}return eutheriaFilterHelper(!0),$("#simple-linnean-groups").exists()&&console.log("Replaced menu items with",a),"function"==typeof t&&t(),!1},"object"==typeof _asm.mammalGroupsBase&&"object"==typeof _asm.major)return isArray(_asm.mammalGroupsBase)||(_asm.mammalGroupsBase=Object.toArray(_asm.mammalGroupsBase)),n(),!0;if(!isBool(e))try{e=null==(r=p$("#use-scientific").checked)||r}catch(t){e=!0}return $.get(searchParams.apiPath,"fetch-groups=true&scientific="+e).done(function(e){return!0===e.status&&(_asm.mammalGroupsBase=Object.toArray(e.minor),_asm.major=e.major,n())}).fail(function(e,t){return console.error("Failed to hit API"),console.warn(e,t),!1}),!1},eutheriaFilterHelper=function(e){if(null==e&&(e=!1),!e){fetchMajorMinorGroups.debounce(50);try{$("#use-scientific").on("iron-change",function(){return delete _asm.mammalGroupsBase,fetchMajorMinorGroups.debounce(50)})}catch(e){}}$("#linnean").on("iron-select",function(){var e,t,r,n,a,o,i,s,l,c,u,d,p,m;if("eutheria"===$(p$("#linnean").selectedItem).attr("data-type")){for(s=[],i=0,a=(u=_asm.mammalGroupsBase).length;i<a;i++)n=u[i],s.push(n.toLowerCase());for(s.sort(),l="",c=0,o=s.length;c<o;c++)l+=r='<paper-item data-type="'+(t=s[c])+'">\n  '+t.toTitleCase()+"\n</paper-item>";if(!isBool(p))try{p=null==(d=p$("#use-scientific").checked)||d}catch(e){p=!0}return e=p?"linnean_order":"simple_linnean_subgroup",r='<div id="eutheria-extra"  class="col-xs-6 col-md-4">\n    <label for="type" class="sr-only">Eutheria Filter</label>\n    <div class="row">\n    <paper-menu-button class="col-xs-12" id="eutheria-subfilter">\n      <paper-button class="dropdown-trigger"><iron-icon icon="icons:filter-list"></iron-icon><span id="filter-what" class="dropdown-label"></span></paper-button>\n      <paper-menu label="Group" data-column="'+e+'" class="cndb-filter dropdown-content" id="linnean-eutheria" name="type" attrForSelected="data-type" selected="0">\n        <paper-item data-type="any" selected>All</paper-item>\n        '+l+"\n        \x3c!-- As per flag 4 in readme --\x3e\n      </paper-menu>\n    </paper-menu-button>\n    </div>\n  </div>",$("#simple-linnean-groups").after(r),$("#eutheria-subfilter").on("iron-select",function(){var e;return e=$(p$("#eutheria-subfilter paper-menu").selectedItem).attr("data-type"),$("#eutheria-subfilter span.dropdown-label").text(e)}),m=$(p$("#eutheria-subfilter paper-menu").selectedItem).attr("data-type"),$("#eutheria-subfilter span.dropdown-label").text(m)}return $("#eutheria-extra").remove()});try{doLazily()}catch(e){}return!1},checkLaggedUpdate=function(t){var r,n,a,o,i,s,l,c,u,d,p,m,f;if(o=["common_name","species_authority"],m=Date.now(),!0===t.do_client_update){s=i=0,n=!1;try{d=t.result;for(a in d){for(f=d[a],p=!0,u=0,c=2;u<c;u++)if(l=o[u],isNull(f[l])){p=!1;break}p||(++s,r="missing=true&genus="+f.genus+"&species="+f.species,$.get(searchParams.targetApi,r,"json").done(function(e){var t,r,n;if(++i,!e.did_update)return!1;console.log("Update for "+e.canonical_sciname,e),r=$(".cndb-result-entry[data-taxon='"+e.genus+"+"+e.species+"']");for(t in e)n=e[t],$(r).find("."+t).exists()&&!isNull(n)?isNull($(r).find("."+t).text())&&(console.log("Set "+t+" text of "+e.canonical_sciname+" to "+n),$(r).find("."+t).text(n)):$(r).find("."+t).exists()&&isNull(n)&&console.warn("Couldn't update "+t+" - got an empty IUCN result");return!1}).fail(function(e,t){return console.warn("Couldn't update "+f.canonical_sciname,e,t),console.warn(searchParams.targetApi+"?"+r),!1}).always(function(){var e;if(i===s&&n)return e=Date.now()-m,console.log("Finished async IUCN taxa check in "+e+"ms")}))}n=!0}catch(t){e=t,console.warn("Couldn't do client update -- "+e.message),console.warn(e.stack)}}return!1},performSearch=function(e){var t,r,n;if(null==e&&(e=void 0),null==e){if(n=$("#search").val(),n,n=n.toLowerCase(),r=getFilters(),(isNull(n)||null==n)&&isNull(r))return $("#search-status").attr("text","Please enter a search term."),$("#search-status")[0].show(),!1;$("#search").blur(),n=n.replace(/\./g,""),n=prepURI(n),$("#loose").polymerChecked()&&(n+="&loose=true"),$("#fuzzy").polymerChecked()&&(n+="&fuzzy=true"),isNull(r)||(n=n+"&filter="+r),t="q="+n}else!0===e?(t="q=","(all items)"):(t="q="+e,e.split("&")[0]);return!("#"===n||isNull(n)&&isNull(t)||"q="===t&&!0!==e)&&(animateLoad(),console.log("Got search value "+n+", hitting",searchParams.apiPath+"?"+t),searchParams.lastSearch=n,$.get(searchParams.targetApi,t,"json").done(function(e){return 0===toInt(e.count)?(console.error("No search results: Got search value "+n+", from hitting",searchParams.apiPath+"?"+t),showBadSearchErrorMessage.debounce(null,null,null,e),clearSearch(!0),!1):!0===e.status?(console.log("Server response:",e),formatSearchResults(e,void 0,function(){return checkLaggedUpdate(e)}),!1):(clearSearch(!0),$("#search-status").attr("text",e.human_error),$("#search-status")[0].show(),console.error(e.error),console.warn(e),stopLoadError())}).fail(function(e,t){return console.error("There was an error performing the search"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't execute the search - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){var e;return e=Base64.encodeURI(n),null!=n&&setHistory(uri.urlString+"#"+e),!1}))},getFilters=function(t,r){var n,a;if(null==t&&(t=".cndb-filter"),null==r&&(r="AND"),n={},$(t).each(function(){var e,t;if(null==(e=$(this).attr("data-column")))return!0;try{t=$(this).polymerSelected()}catch(e){return!0}return"any"===t||"all"===t||"*"===t||(!(!isNull(t)&&!1!==t||(t=$(this).val(),!isNull(t)))||(n[e]=t.toLowerCase()))}),0===Object.size(n))return"";try{return n.BOOLEAN_TYPE=r,a=JSON.stringify(n),Base64.encodeURI(a)}catch(t){return e=t,!1}},formatSearchResults=function(t,r,n){var a,o,i,s,l,c,u,d,p,m,f,h;return null==r&&(r=searchParams.targetContainer),m=Date.now(),l=0,$("#result-header-container").removeAttr("hidden"),i=t.result,searchParams.result=i,[],f="cndb-result-list",u="<table id='"+f+"' class='table table-striped table-hover col-md-12'>\n\t<tr class='cndb-row-headers'>","</table>",h=t.count,h>150?toastStatusMessage("We found "+t.count+" results, please hang on a moment while we render them...","",5e3):console.log("Not notifying of render delay, only showing "+h+" items"),o=null,a=0,s=["id","minor_type","notes","major_type","taxon_author","taxon_credit","image_license","image_credit","taxon_credit_date","parens_auth_genus","parens_auth_species","is_alien","internal_id","source","deprecated_scientific","canonical_sciname","simple_linnean_group","iucn","dwc","entry","common_name_source","image_caption"],c=0,d=delay(7500,function(){return stopLoadError("There was a problem parsing the search results."),console.error("Couldn't finish parsing the results! Expecting "+h+" elements, timed out on "+c+"."),console.warn(i),!1}),p=["common_name","genus","species"],delay(5,function(){var h,g,y,b,w,v,_,x,S,k,N,C,T,j;g=[];for(b in i){C=i[b],h=!0;for(w in C)j=C[w],indexOf.call(g,w)>=0||(isNull(j)?h=!1:g.push(w));if(h)break}indexOf.call(g,"subspecies")>=0&&p.push("subspecies"),k=i[0];for(w in k)j=k[w],indexOf.call(p,w)<0&&indexOf.call(s,w)<0&&indexOf.call(g,w)>=0&&p.push(w);S=i,i={};for(b in S)for(C=S[b],i[b]={},x=0,_=p.length;x<_;x++)v=p[x],i[b][v]=C[v];return T=0,y=Object.toArray(i),(N=function(i,s,p){var h,g,y,v,_,x,S,k,L,A,P,O,E,B,R,I,D,q,U,M,z,F;S="",b=0,E=null,M=!1,isNumber(p)||(p=100),v=i.length<=p;try{I={action:"render-row",data:i,chunk:p,firstIteration:s},z=new Worker("js/serviceWorker.js"),console.info("Rendering list off-thread"),z.addEventListener("message",function(e){return console.info("Got message back from service worker",e.data),M=!0,S=e.data.html,E=e.data.nextChunk,e.data.renderChunk,b=e.data.loops,O()}),z.postMessage(I)}catch(t){for(console.log("Starting loop with i = "+b+", renderChunk = "+p+", data length = "+i.length,s,v),R=0,P=i.length;R<P;R++){if(C=i[R],++T,c=b,0===toInt(b)&&s){L=0,u+="\n\x3c!-- Table Headers - "+Object.size(C)+" entries --\x3e";for(w in C)j=C[w],++T,B=w.replace(/_/g," "),B=function(){switch(B){case"simple linnean subgroup":return"Group";case"major subtype":return"Clade";default:return B}}(),u+="\n\t\t<th class='text-center'>"+B+"</th>",a++,L++;u+="\n\t</tr>",u+="\n\x3c!-- End Table Headers --\x3e",console.log("Got "+a+" display columns."),h=roundNumber(12/a,0),o="col-md-"+h,_=u+"</table>",S=u,$(r).html(_)}U=C.genus+"+"+C.species,isNull(C.subspecies)||(U=U+"+"+C.subspecies),k="\n\t<tr id='"+("msadb-row"+b)+"' class='cndb-result-entry' data-taxon=\""+U+'" data-genus="'+C.genus+'" data-species="'+C.species+'">';for(w in C){if(g=C[w],++T,"authority_year"===w)if(isNull(g))y=g;else{try{y=JSON.parse(g)}catch(t){e=t;try{console.warn("There was an error parsing authority_year='"+g+"', attempting to fix - ",e.message),q=g.split(":"),F=q[1].slice(q[1].search('"')+1,-2),F=F.replace(/"/g,"'"),q[1]='"'+F+'"}',g=q.join(":"),y=JSON.parse(g)}catch(t){e=t,console.error("There was an error parsing '"+g+"'",e.message),y=g}}try{x=Object.keys(y)[0],D=y[x],toInt(C.parens_auth_genus).toBool()&&(x="("+x+")"),toInt(C.parens_auth_species).toBool()&&(D="("+D+")"),g="G: "+x+"<br/>S: "+D}catch(e){}}"image"===w&&(g=isNull(g)?"<paper-icon-button icon='launch' data-href='"+_asm.affiliateQueryUrl.mammalPhotos+"?rel-taxon=contains&where-taxon="+U+"' class='newwindow calphoto click' data-taxon=\""+U+'"></paper-icon-button>':"<paper-icon-button icon='image:image' data-lightbox='"+uri.urlString+g+"' class='lightboximage'></paper-icon-button>"),A="genus"!==w&&"species"!==w&&"subspecies"!==w?w+" text-center":w,"genus_authority"===w||"species_authority"===w?A+=" authority":"common_name"===w&&(g=smartUpperCasing(g),A+=" no-cap"),k+="\n\t\t<td id='"+w+"-"+b+"' class='"+A+" "+o+"'>"+g+"</td>"}if(k+="\n\t</tr>",S+=k,++b>=p)break}console.log("Ended data loop with i = "+b+", renderChunk = "+p),O()}return O=function(){var e;if(s?(S+="</table>",$(r).html(S),$("#result-count").text(" - "+t.count+" entries"),"space_common_fallback"!==t.method||$("#space-fallback-info").exists()?$("#space-fallback-info").exists()&&$("#space-fallback-info").prop("hidden",!0):(e='<div id="space-fallback-info" class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Don\'t see what you want?</strong> We might use a slightly different name. Try <a href="" class="alert-link" id="do-instant-fuzzy">checking the "fuzzy" toggle and searching again</a>, or use a shorter search term.\n</div>',$("#result_container").before(e),$("#do-instant-fuzzy").click(function(e){return e.preventDefault(),function(){return $("#fuzzy").get(0).checked=!0,performSearch()}.debounce()}))):$("table#"+f+" tbody").append(S),v||(l=Date.now()-m,null==E&&(E=i.slice(b)),console.log("Chunk rendered at "+l+"ms, next bit with slice @ "+b+":",E),0!==E.length?delay(M?25:250,function(){return N(E,!1,p)}):v=!0),v&&(l=Date.now()-m,console.log("Finished rendering list in "+l+"ms"),console.debug("Executed "+T+" loops"),l>3e3&&!M&&console.warn("Warning: Took greater than 3 seconds to render!"),stopLoad(),delay(250,function(){return stopLoad()}),"function"==typeof n))try{n()}catch(e){}return clearTimeout(d),mapNewWindows(),lightboxImages(),$(".cndb-result-entry").unbind().click(function(){var e;return e="genus="+$(this).attr("data-genus")+"&species="+$(this).attr("data-species"),goTo("species-account.php?"+e)}),doFontExceptions()}})(y,!0,100)}),!1},parseTaxonYear=function(t,r){var n,a,o,i,s;null==r&&(r=!0);try{n=JSON.parse(t)}catch(a){e=a,console.warn("There was an error parsing '"+t+"', attempting to fix - ",e.message);try{i=t.split(":"),s=i[1].slice(i[1].search('"')+1,-2),s=s.replace(/"/g,"'"),i[1]='"'+s+'"}',t=i.join(":");try{n=JSON.parse(t)}catch(n){return e=n,!r&&t}}catch(n){return e=n,!r&&t}}return a=Object.keys(n)[0],o=n[a],s={},s.genus=a,s.species=o,s},checkTaxonNear=function(e,t,r){var n,a,o,i,s;return null==e&&(e=void 0),null==t&&(t=void 0),null==r&&(r="#near-me-container"),null==e?(console.warn("Please specify a taxon."),!1):(null==locationData.last&&getLocation(),(Date.now()-locationData.last)/1e3>900&&getLocation(),n="https://www.inaturalist.org/places.json",a="taxon="+e+"&latitude="+locationData.lat+"&longitude="+locationData.lng+"&place_type=county",i="",o="",s="",$.get(n,a,"json").done(function(e){return Object.size(e)>0?(i="communication:location-on",o="good-location",s="This species occurs in your county"):(i="communication:location-off",o="bad-location",s="This species does not occur in your county")}).fail(function(e,t){return o="bad-location",i="warning",s="We couldn't determine your location"}).always(function(){var e;if(e='<div class="tooltip fade top in right manual-placement-tooltip" role="tooltip" style="top: 6.5em; left: 4em; right:initial; display:none" id="manual-location-tooltip">\n  <div class="tooltip-arrow" style="top:50%;left:5px"></div>\n  <div class="tooltip-inner">'+s+"</div>\n</div>",d$(r).html("<iron-icon icon='"+i+"' class='small-icon "+o+" near-me' data-toggle='tooltip' id='near-me-icon'></iron-icon>"),$(r).after(e).mouseenter(function(){return d$("#manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return d$("#manual-location-tooltip").css("display","none"),!1}),null!=t)return t()}),!1)},insertModalImage=function(t,r,n){var a,o,i,s,l,c,u,d,p,m,f;if(null==t&&(t=_asm.taxonImage),null==r&&(r=_asm.activeTaxon),null==n&&(n=void 0),null==r)return console.error("Tried to insert a modal image, but no taxon was provided!"),!1;if("object"!=typeof r)return console.error("Invalid taxon data type (expecting object), got "+typeof r),f={taxon:r,imageUrl:l,defaultTaxon:_asm.activeTaxon,defaultImage:_asm.taxonImage},console.warn(f),!1;if(d=function(t,r,a){var o,i,s,l,c,u;null==a&&(a="calphoto"),u=t.thumbUri,s=t.imageUri,l="function"==typeof t.imageLinkUri?t.imageLinkUri(t.imageUri):void 0,i=t.imageLicense,o='<div class="modal-img-container">\n  <a href="'+s+'" class="'+a+'-img-anchor center-block text-center">\n    <img src="'+u+'"\n      data-href="'+l+'"\n      class="'+a+'-img-thumb"\n      data-taxon="'+r+'" />\n  </a>\n  <p class="small text-muted text-center">\n    Image by '+t.imageCredit+" under "+i+"\n  </p>\n</div>",d$("#meta-taxon-info").before(o),(c=function(t){try{return d$("#modal-taxon").get(0).fit(),delay(250,function(){return d$("#modal-taxon").get(0).fit(),delay(750,function(){return d$("#modal-taxon").get(0).fit()})})}catch(r){return e=r,t<10?(t++,delay(100,function(){return c(t)})):console.warn("Couldn't execute fit!")}})(0);try{lightboxImages("."+a+"-img-anchor",!0)}catch(t){e=t,console.error("Error lightboxing images")}return"function"==typeof n&&n(),!1},p=[r.genus,r.species],null!=r.subspecies&&p.push(r.subspecies),m=p.join("+"),null!=t.imageUri)return"string"==typeof t&&(l=t,(t={}).imageUri=l),c=t.imageUri.split("."),i=c.pop(),u=c.join("."),t.thumbUri=""+uri.urlString+u+"-thumb."+i,t.imageUri=""+uri.urlString+u+"."+i,d(t,m,"asmimg"),!1;a="getthumbinfo=1&num=all&cconly=1&taxon="+m+"&format=xml",o=function(r){var n,o;o=xmlToJSON.parseString(r),window.testData=o;try{n=o.calphotos[0]}catch(t){e=t,n=void 0}if(null==n)return!1;t={};try{if(t.thumbUri=n.thumb_url[0]._text,null==t.thumbUri)return console.warn("CalPhotos didn't return any valid images for this search!"),!1;t.imageUri=n.enlarge_jpeg_url[0]._text,t.imageLinkUri=n.enlarge_url[0]._text,t.imageLicense=n.license[0]._text,t.imageCredit=n.copyright[0]._text+" (via CalPhotos)"}catch(t){return e=t,console.warn("CalPhotos didn't return any valid images for this search!",_asm.affiliateQueryUrl.calPhotos+"?"+a),!1}return d(t,m),!1},s=function(e,t){return insertCORSWorkaround(),console.error("Couldn't load a CalPhotos image to insert!"),!1};try{doCORSget(_asm.affiliateQueryUrl.calPhotos,a,o,s)}catch(t){e=t,console.error(e.message)}return!1},modalTaxon=function(t){var r;return null==t&&(t=void 0),null==t?($(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))}),!1):(animateLoad(),$("#modal-taxon").exists()||(r='<paper-dialog modal id=\'modal-taxon\' entry-animation="scale-up-animation" exit-animation="scale-down-animation">\n  <h2 id="modal-heading"></h2>\n  <paper-dialog-scrollable id=\'modal-taxon-content\'></paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id=\'modal-inat-linkout\'>iNaturalist</paper-button>\n    <paper-button id=\'modal-calphotos-linkout\' class="hidden-xs">CalPhotos</paper-button>\n    <paper-button id=\'modal-alt-linkout\' class="hidden-xs"></paper-button>\n    <paper-button dialog-dismiss autofocus>Close</paper-button>\n  </div>\n</paper-dialog>',$("body").append(r)),$.get(searchParams.targetApi,"q="+t,"json").done(function(n){var a,o,i,s,l,c,u,d,p,m,f,h,g,y;if(null==(o=n.result[0]))return toastStatusMessage("There was an error fetching the entry details. Please try again later."),stopLoadError(),!1;if(g=parseTaxonYear(o.authority_year),y="",!1!==g&&(s="<span class='genus_authority authority'>"+o.genus_authority+"</span> "+g.genus,m="<span class='species_authority authority'>"+o.species_authority+"</span> "+g.species,toInt(o.parens_auth_genus).toBool()&&(s="("+s+")"),toInt(o.parens_auth_species).toBool()&&(m="("+m+")"),y="<div id=\"is-alien-container\" class=\"tooltip-container\"></div>\n<div id='near-me-container' data-toggle='tooltip' data-placement='top' title='' class='near-me tooltip-container'></div>\n<p>\n  <span class='genus'>"+o.genus+"</span>,\n  "+s+";\n  <span class='species'>"+o.species+"</span>,\n  "+m+"\n</p>"),i="",!isNull(o.deprecated_scientific)){i="<p>Deprecated names: ";try{p=JSON.parse(o.deprecated_scientific),c=0,$.each(p,function(e,t){if(1!==++c&&(i+="; "),i+="<span class='sciname'>"+e+"</span>, "+t,c===Object.size(p))return i+="</p>"})}catch(t){e=t,i="",console.error("There were deprecated scientific names, but the JSON was malformed.")}}u="",isNull(o.minor_type)||(u=" <iron-icon icon='arrow-forward'></iron-icon> <span id='taxon-minor-type'>"+o.minor_type+"</span>"),isNull(o.notes)?(o.notes="Sorry, we have no notes on this taxon yet.",o.taxon_credit=""):isNull(o.taxon_credit)||"null"===o.taxon_credit?o.taxon_credit="This taxon information is uncredited.":(h=isNull(o.taxon_credit_date)||"null"===o.taxon_credit_date?"":" ("+o.taxon_credit_date+")",o.taxon_credit="Taxon information by "+o.taxon_credit+"."+h);try{d=markdown.toHTML(o.notes)}catch(t){e=t,d=o.notes,console.warn("Couldn't parse markdown!! "+e.message)}d=d.replace(/\&amp;(([a-z]+|[0-9]+);)/gm,"&$1"),a=isNull(o.major_common_type)?"":" (<span id='taxon-common-type'>"+o.major_common_type+"</span>) ",r="<div id='meta-taxon-info'>\n  "+y+"\n  <p>\n    English name: <span id='taxon-common-name' class='common_name no-cap'>"+smartUpperCasing(o.common_name)+"</span>\n  </p>\n  <p>\n    Type: <span id='taxon-type' class=\"major_type\">"+o.major_type+"</span>\n    "+a+"\n    <iron-icon icon='arrow-forward'></iron-icon>\n    <span id='taxon-subtype' class=\"major_subtype\">"+o.major_subtype+"</span>"+u+"\n  </p>\n  "+i+"\n</div>\n<h3>Taxon Notes</h3>\n<p id='taxon-notes'>"+d+'</p>\n<p class="text-right small text-muted">'+o.taxon_credit+"</p>",$("#modal-taxon-content").html(r),$("#modal-inat-linkout").unbind().click(function(){return openTab(_asm.affiliateQueryUrl.iNaturalist+"?q="+t)}),$("#modal-calphotos-linkout").unbind().click(function(){return openTab(_asm.affiliateQueryUrl.calPhotos+"?rel-taxon=contains&where-taxon="+t)}),f=t.split("+"),_asm.activeTaxon={genus:f[0],species:f[1],subspecies:f[2]},$("#modal-alt-linkout").addClass("hidden").unbind(),formatScientificNames(),doFontExceptions(),l=(l=t.charAt(0).toUpperCase()+t.slice(1)).replace(/\+/g," "),d$("#modal-heading").text(l),isNull(o.image)&&(o.image=void 0),_asm.taxonImage={imageUri:o.image,imageCredit:o.image_credit,imageLicense:o.image_license};try{insertModalImage()}catch(t){e=t,console.info("Unable to insert modal image! ")}return checkTaxonNear(t,function(){var e;return stopLoad(),e=d$("#modal-taxon")[0],d$("#modal-taxon").on("iron-overlay-opened",function(){return e.fit(),e.scrollTop=0,toFloat($(e).css("top").slice(0,-2))>$(window).height()&&$(e).css("top","12.5vh"),delay(250,function(){return e.fit()})}),e.sizingTarget=d$("#modal-taxon-content")[0],safariDialogHelper("#modal-taxon")}),bindDismissalRemoval()}).fail(function(e,t){return stopLoadError()}),!1)},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},doFontExceptions=function(){var e,t;return e=["de","and"],t=function(t){return $.each(e,function(e,r){var n;if(n=" "+r+" ",null!=t)return t=t.replace(n," <span class='force-lower'>"+r+"</span> ")}),t},d$(".authority").each(function(){var e;if(e=$(this).text(),!isNull(e))return $(this).html(t(e))}),!1},sortResults=function(e){return searchParams.result},setHistory=function(e,t,r){return null==e&&(e="#"),null==t&&(t=null),null==r&&(r=null),history.pushState(t,r,e),uri.query=$.url(e).attr("fragment"),!1},clearSearch=function(e){var t;return null==e&&(e=!1),$("#result-count").text(""),t='<div class="bs-callout bs-callout-info center-block col-xs-12 col-sm-8 col-md-5">\n  Search for a common or scientific name above to begin, eg, "Brown Bear" or "<span class="sciname">Ursus arctos</span>"\n</div>',$("#result_container").html(t),$("#result-header-container").attr("hidden","hidden"),!0!==e&&(setHistory(),$(".cndb-filter").attr("value",""),$("#collapse-advanced").collapse("hide"),$("#search").attr("value",""),$("#linnean").polymerSelected("any"),formatScientificNames(),!1)},safariDialogHelper=function(t,r,n){var a,o;if(null==t&&(t="#download-chooser"),null==r&&(r=0),"function"!=typeof n&&(n=function(){return bindDismissalRemoval()}),!(r<10))return stopLoadError("Unable to show dialog. Please try again.");try{try{p$(t).open()}catch(e){d$(t).get(0).open()}return"function"==typeof n&&n(),stopLoad()}catch(i){return e=i,o=r+1,a=250,delay(a,function(){return console.warn("Trying again to display dialog after "+o*a+"ms"),console.debug("Error caught: "+e.message),console.debug(e.stack),safariDialogHelper(t,o,n)})}},safariSearchArgHelper=function(e,t){var r,n;return null==t&&(t=!1),r=null!=e?e:$("#search").val(),n=!1,-1!==r.search(/\+/)&&(n=!0,r=r.replace(/\+/g," ").trim(),delay(100,function(){return safariSearchArgHelper()})),(n||null!=e)&&($("#search").attr("value",r),t||delay(5e3,function(){return safariSearchArgHelper(void 0,!0)})),!1},insertCORSWorkaround=function(){var t,r,n;if(null==_asm.hasShownWorkaround&&(_asm.hasShownWorkaround=!1),_asm.hasShownWorkaround)return!1;try{r=new WhichBrowser}catch(t){return e=t,!1}return r.isType("mobile")?(_asm.hasShownWorkaround=!0,!1):(t=function(){switch(r.browser.name){case"Chrome":return"Install the extension \"<a class='alert-link' href='https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?utm_source=chrome-app-launcher-info-dialog'>Allow-Control-Allow-Origin: *</a>\", activate it on this domain, and you'll see them in your popups!";case"Firefox":return"Follow the instructions <a class='alert-link' href='http://www-jo.se/f.pfleger/forcecors-workaround'>for this ForceCORS add-on</a>, or try Chrome for a simpler extension. Once you've done so, you'll see photos in your popups!";case"Internet Explorer":return"Follow these <a class='alert-link' href='http://stackoverflow.com/a/20947828'>StackOverflow instructions</a> while on this site, and you'll see them in your popups!";default:return""}}(),n='<div class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Want CalPhotos images in your species dialogs?</strong> '+t+"\n  We're working with CalPhotos to enable this natively, but it's a server change on their side.\n</div>",$("#result_container").before(n),$(".alert").alert(),_asm.hasShownWorkaround=!0,!1)},showBadSearchErrorMessage=function(e){var t,r,n,a;try{n=e.query.replace(/\+/g," ")}catch(e){n=$("#search").val()}try{!0===e.status?!0===e.query_params.filter.had_filter?(t="",r=0,$.each(e.query_params.filter.filter_params,function(n,a){if("BOOLEAN_TYPE"!==n)return 0!==r&&(t=filter_text+" "+e.filter.filter_params.BOOLEAN_TYPE),isNumber(toInt(a,!0))&&(a=1===toInt(a)?"true":"false"),t=t+" "+n.replace(/_/g," ")+" is "+a}),a='"'+n+'" where '+t+" returned no results."):a='"'+n+'" returned no results.':a=e.human_error}catch(e){a="Sorry, there was a problem with your search"}return stopLoadError(a)},bindPaperMenuButton=function(e,t){return null==e&&(e="paper-menu-button"),null==t&&(t=!0),!1},getRandomEntry=function(){var e;return startLoad(),e={random:!0},$.get(searchParams.apiPath,buildQuery(e,"json")).done(function(e){var t,r;return(isNull(e.genus)||isNull(e.species))&&stopLoadError("Unable to fetch random entry"),t={genus:e.genus,species:e.species},isNull(e.subspecies)||(t.subspecies=e.subspecies),r=uri.urlString+"species-account.php?"+buildQuery(t),console.log("About to go to",r),goTo(r),stopLoad()}).fail(function(){return stopLoadError("Unable to fetch random entry")}),!1},window.getRandomEntry=getRandomEntry,doLazily=function(){return!0!==("undefined"!=typeof _asm&&null!==_asm?_asm.hasDoneLazily:void 0)&&("object"!=typeof _asm&&(window._asm={}),_asm.hasDoneLazily=!0,loadJS(uri.urlString+"js/download.min.js",function(){var e;return e='<paper-icon-button\n  icon="icons:cloud-download"\n  class="click"\n  data-fn="showDownloadChooser"\n  title="Download Copy"\n  data-toggle="tooltip"\n  >\n</paper-icon-button>',$("#git-footer").prepend(e),bindClicks(),!1})),!1},$(function(){var t,r,n,a,o,i,s,l,c,u,d,p,m,f,h,g,y;if(r="****************************************************************************\nHello developer!\nIf you're looking for hints on our API information, this site is open-source\nand released under the GPL. Just click on the GitHub link on the bottom of\nthe page, or check out LINK_TO_ORG_REPO\n****************************************************************************",console.log(r),_asm.polymerReady=!1,s=["admin-login.php","admin-page.html","admin-page.php"],p=uri.o.attr("file"),indexOf.call(s,p)>=0){try{(f=function(){var e;try{if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0))return Polymer.Base.ready(function(){return _asm.polymerReady=!0}),delay(250,function(){return _asm.polymerReady=!0});throw{message:"POLYMER_NOT_READY"}}catch(e){return delay(100,function(){return f})}})()}catch(e){}return!1}if(animateLoad(),window.addEventListener("popstate",function(e){var t,r;uri.query=$.url().attr("fragment");try{t=Base64.decode(uri.query)}catch(e){e,t=""}return performSearch.debounce(50,null,null,t),r=t.split("&")[0],$("#search").attr("value",r)}),$("#do-reset-search").click(function(){return clearSearch()}),$("#search_form").submit(function(e){return e.preventDefault(),performSearch.debounce(50)}),$("#collapse-advanced").on("shown.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-less")}),$("#collapse-advanced").on("hidden.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-more")}),$("#search_form").keypress(function(e){if(13===e.which)return performSearch.debounce(50)}),$("#do-search").click(function(){return performSearch.debounce(50)}),$("#do-search-all").click(function(){return performSearch.debounce(50,null,null,!0)}),$("#linnean").on("iron-select",function(){if(!isNull($("#search").val()))return performSearch.debounce()}),eutheriaFilterHelper(),bindPaperMenuButton(),isNull(uri.query)){l="";try{(f=function(){var e;try{if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0))return Polymer.Base.ready(function(){return _asm.polymerReady=!0}),delay(250,function(){return _asm.polymerReady=!0});throw{message:"POLYMER_NOT_READY"}}catch(e){return delay(100,function(){return f})}})()}catch(e){}}else try{l=Base64.decode(uri.query),d=$.url(searchParams.apiPath+"?q="+l);try{c=d.param("loose").toBool()}catch(t){e=t,c=!1}try{i=d.param("fuzzy").toBool()}catch(t){e=t,i=!1}g=l.split("&")[0],safariSearchArgHelper(g),(o=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return _asm.polymerReady=!0,delay(250,function(){if(c&&d$("#loose").attr("checked","checked"),i)return d$("#fuzzy").attr("checked","checked")}),!1;if(null==_asm.stateIter&&(_asm.stateIter=0),++_asm.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return _asm.polymerReady=!0,delay(250,function(){return console.info("Doing a late Polymer.Base.ready call"),c&&d$("#loose").attr("checked","checked"),i&&d$("#fuzzy").attr("checked","checked"),safariSearchArgHelper(),eutheriaFilterHelper()})})}catch(e){return delay(250,function(){return o()})}})();try{n=d.param("filter"),a=JSON.parse(Base64.decode(n)),u=!1,h=["simple-linnean-group","simple-linnean-subgroup","linnean-family","type","BOOLEAN-TYPE"];for(t in a)y=a[t],m=".cndb-filter[data-column='"+(t=t.replace(/_/g,"-"))+"']",indexOf.call(h,t)<0?(console.debug("Col '"+t+"' is not a simple filter"),$(m).attr("value",y),u=!0):$(".cndb-filter[data-column='"+t+"']").polymerSelected(y);u&&$("#collapse-advanced").collapse("show")}catch(t){e=t,n=!1}}catch(t){e=t,console.error("Bad argument "+uri.query+" => "+l+", looseState, fuzzyState",c,i,searchParams.apiPath+"?q="+l),console.warn(e.message),l=""}if(isNull(l)||"#"===l)return stopLoad(),$("#search").attr("disabled",!1),(o=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return _asm.polymerReady=!0,delay(250,function(){return d$("#loose").attr("checked","checked"),eutheriaFilterHelper()}),!1;if(null==_asm.stateIter&&(_asm.stateIter=0),++_asm.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return _asm.polymerReady=!0,delay(250,function(){return d$("#loose").attr("checked","checked"),eutheriaFilterHelper()})})}catch(e){return delay(250,function(){return o()})}})();try{searchParams.lastSearch=l}catch(e){}return $.get(searchParams.targetApi,"q="+l,"json").done(function(e){return _asm.polymerReady=!0,console.debug("Server query got",e),!0===e.status&&e.count>0?(console.log("Got a valid result, formatting "+e.count+" results."),formatSearchResults(e,void 0,function(){return console.log("Format results finished, checking lagged update"),checkLaggedUpdate(e)}),!1):(console.warn("Bad initial search"),showBadSearchErrorMessage.debounce(null,null,null,e),console.error(e.error),console.warn(e))}).fail(function(e,t){return console.error("There was an error loading the generic table"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't load table - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){return $("#search").attr("disabled",!1),!1})}),loadTerminalDialog=function(e){return null==e&&(e=!1),getTerminalDependencies(function(){var t;return $("#sql-query-dialog").exists()||e||(t='<paper-dialog id="sql-query-dialog" modal>\n  <paper-dialog-scrollable>\n    <div class="row query-container">\n      <form class="form">\n        <div class="form-group">\n          <textarea id="sql-input"\n                    rows="5"\n                    class="form-control"\n                    placeholder="SQL query here"\n                    autofocus></textarea>\n          <p class="text-muted">\n            <strong>Tip:</strong> Use <kbd>@@</kbd> to represent the database table and <kbd>!@</kbd> to represent <code class="language-null">SELECT * FROM table</code>. You can search columns using DarwinCore or columns specified in Github.\n          </p>\n        </div>\n      </form>\n      <p class="col-xs-12">Interpreted Query:</p>\n      <code class="language-sql col-xs-11 col-xs-offset-1" id="interpreted-sql"></code>\n    </div>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id="clear-sql-results">Clear Results</paper-button>\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("body").append(t),$("#sql-query-dialog").find("form").submit(function(e){return e.preventDefault(),executeQuery(),!1}),$("#sql-input").keydown(function(e){if(13===(e.keyCode?e.keyCode:e.which))return e.preventDefault(),executeQuery(),!1}),$("#sql-input").keyup(function(e){return 13!==(e.keyCode?e.keyCode:e.which)&&parseQuery(this),!0}),$("#clear-sql-results").click(function(){return $("#sql-results").remove(),!1})),p$("#sql-query-dialog").open()}),!1},getTerminalDependencies=function(){var e,t,r,n,a;return t=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],!0===_asm.terminalDependencies&&(console.log("Dependencies are already loaded, executing immediately"),"function"==typeof t&&t.apply(null,e)),n={nacl:!1,prism:!1},_asm.terminalDependencies=!1,_asm.terminalDependenciesChecking=!1,r=function(){var a,o,i;if(!0===_asm.terminalDependencies)return!0;if(_asm.terminalDependenciesChecking)return delay(50,function(){return r()}),!1;_asm.terminalDependenciesChecking=!0,o=!0;for(a in n)if(i=n[a],!(o=o&&i)){console.log("Library "+a+" isn't yet ready...");break}return _asm.terminalDependencies=o,_asm.terminalDependenciesChecking=!1,o&&(console.log("Dependencies loaded"),"function"==typeof t&&t.apply(null,e)),o},a=function(){return nacl_factory.instantiate(function(e){return _asm.nacl=e,n.nacl=!0,r()})},"undefined"==typeof nacl_factory||null===nacl_factory?loadJS("bower_components/js-nacl/lib/nacl_factory.js",function(){return a()}):a(),loadJS("bower_components/prism/prism.js",function(){return loadJS("bower_components/prism/components/prism-sql.js",function(){return n.prism=!0,loadJS("bower_components/prism/components/prism-json.js"),r(),!1}),$("head").append('<link href="bower_components/prism/themes/prism.css" rel="stylesheet" />')}),!1},parseQuery=function(e,t){var r,n;return null==e&&(e="#sql-input"),null==t&&(t="#interpreted-sql"),n=$(e).val().trim(),n=n.replace(/@@/gim,"`mammal_diversity_database`"),n=n.replace(/!@/gim,"SELECT * FROM `mammal_diversity_database`"),r=$(t).get(0),$(r).text(n),Prism.highlightElement(r),n},executeQuery=function(){var t,r,n,a;n=function(t){var r,n;null==t&&(t="Error");try{r=_asm.nacl.decode_utf8(_asm.nacl.crypto_hash_string(t+Date.now()))}catch(t){e=t,console.warn(e.message),console.warn(e.stack),r="sql-query-alert"}return n='<div class="alert alert-danger alert-dismissable col-xs-8 col-offset-xs-2 center-block clear clearfix" role="alert" id="'+r+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <div class="alert-message">'+t+"</div>\n</div>",$("#sql-input").parents("paper-dialog").find(".alert").remove(),$("#sql-input").parents("form").after(n),stopLoadError(),!1};try{r=p$("#dwc-only").checked}catch(e){}return a=parseQuery(),isNull(a)?n("Sorry, you can't use an empty query"):(t={sql_query:post64(a),action:"query",dwc:null!=r&&r},console.debug("Posting to target",uri.urlString+"api.php?"+buildQuery(t)),$.post(uri.urlString+"api.php",buildQuery(t,"json")).done(function(e){var t,r,a,o,i,s,l,c,u,d,p,m,f,h,g,y,b,w,v,_,x;console.log("Got result",e),$("#sql-results").remove();try{null!=e.statements&&(x=Object.toArray(e.statements))}catch(e){}if(!0!==e.status){if(isNull(e.statement_count))return t=null!=(f=null!=(h=e.error)?h:e.human_error)?f:"UNKNOWN_ERROR",n(t);for(d=0,l=x.length;d<l;d++)if("ERROR"===(_=x[d]).result)return r="Your query <code class='language-sql'>"+_.provided+"</code> ",!0!==_.error.safety_check?r+="failed a safety check.":!1===_.error.sql_response?r+="has or generated during parsing a syntax error.<br/><br/>If you believe your syntax to be valid, try simplifying it as we strictly limit the types of queries accessible here.":_.error.was_server_exception?r+="generated a problem on the server and was refused to be executed. Please report this.":r+="gave <code>UNKNOWN_QUERY_ERROR</code>",r+="<br/><br/>Execution of your query was halted here.",n(r)}for($("#sql-input").parents("paper-dialog").find(".alert").remove(),a='<div id="sql-results" class="sql-results col-xs-12">\n</div>',$("#interpreted-sql").exists()?$("#interpreted-sql").after(a):$("#sql-input").parents("form").after(a),v=[],o=0,p=0,c=x.length;p<c;p++)if(_=x[p],0===(g=Object.toArray(_.result)).length)w="<code>ZERO_RESULTS</code>",v.push(w);else for(++o,i=0,m=0,u=g.length;m<u;m++){y=g[m],++i;try{b=JSON.stringify(y),b=b.replace(/,"/gim,', "'),s="json"}catch(e){b="Unable to parse row",s="text"}w="<div>\n  "+o+"."+i+':\n  <code class="language-'+s+'">'+b+"</code>\n</div>",v.push(w)}return $("#sql-results").html(v.join("<br/><br/>")),Prism.highlightAll(),!1}).fail(function(e,t){return console.error(e,t),console.warn("Couldn't hit target"),n("Problem talking to the server, please try again"),!1}),!1)},$(function(){var e;return e='<paper-icon-button icon="icons:code" id="launch-term" title="Directly Query Database" data-toggle="tooltip">\n</paper-icon-button>',$("#git-footer").append(e),$("#launch-term").click(function(){return loadTerminalDialog.debounce()}),!1});
//# sourceMappingURL=c.min.js.map