function shuffle(e){for(var t,n,r=e.length;r;t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}var _metaStatus,activityIndicatorOff,activityIndicatorOn,allError,animateHoverShadows,animateLoad,bindClickTargets,bindClicks,bindDismissalRemoval,bindPaperMenuButton,browserBeware,bsAlert,buildArgs,buildQuery,byteCount,checkFileVersion,checkLaggedUpdate,checkLocalVersion,checkTaxonNear,clearSearch,dataUriToBlob,dateMonthToString,deEscape,decode64,deepJQuery,delay,delayPolymerBind,doCORSget,doFontExceptions,doLazily,doNothing,domainPlaceholder,downloadDataUriAsBlob,e,encode64,error1,eutheriaFilterHelper,fetchMajorMinorGroups,foo,formatScientificNames,formatSearchResults,getElementHtml,getFilters,getLocation,getMaxZ,getRandomEntry,goTo,insertCORSWorkaround,insertModalImage,interval,isArray,isBlank,isBool,isEmpty,isJson,isNull,isNumber,isNumeric,jsonTo64,lightboxImages,loadJS,loadSocialMediaSlideoutBar,mapNewWindows,mobileCollapsable,modalTaxon,objToArgs,openLink,openTab,overlayOff,overlayOn,p$,parseTaxonYear,performSearch,post64,prepURI,randomInt,ref,roundNumber,roundNumberSigfig,safariDialogHelper,safariSearchArgHelper,searchParams,setHistory,setupServiceWorker,showBadSearchErrorMessage,smartUpperCasing,sortResults,startLoad,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,uri,slice=[].slice,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};(uri={}).o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory");try{uri.urlString=uri.urlString.replace(/(.*)\/(((&?[a-zA-Z_\-]+=[a-zA-Z_\-\+0-9%=]+)+)\/?)(.*)/gim,"$1/"),-1===uri.urlString.split("/").pop().search(/\./)&&"/"!==uri.urlString.slice(-1)&&(uri.urlString=uri.urlString.slice(0,uri.urlString.search(uri.urlString.split("/").pop())))}catch(e){}uri.query=uri.o.attr("fragment"),(domainPlaceholder=uri.o.attr("host").split(".")).pop(),uri.domain=null!=(ref=domainPlaceholder[0])?ref:"",_metaStatus={},window.locationData={},locationData.params={enableHighAccuracy:!0},locationData.last=void 0,"object"!=typeof window._asm&&(window._asm={}),_asm.socialHandles={twitter:"mammalogists"},_asm.mobileBreakpoint=767,isBool=function(e){return!0===e||!1===e},isEmpty=function(e){return!e||0===e.length},isBlank=function(e){return!e||/^\s*$/.test(e)},isNull=function(e,t){var n;if(null==t&&(t=!1),"object"==typeof e)try{if(null!=(n=e.length))try{return 0===n}catch(e){}return 0===Object.size}catch(e){}try{if(isEmpty(e)||isBlank(e)||null==e){if(!1!==e&&0!==e)return!0;if(t&&(!1===e||0===e))return!0}}catch(e){return e,!1}try{e=(""+e).toLowerCase()}catch(e){}return"undefined"===e||"null"===e||!(!t||"false"!==e&&"0"!==e)},isJson=function(e){if("object"==typeof e)return!0;try{return JSON.parse(e),!0}catch(e){}return!1},isArray=function(e){try{return e.slice(0).push("foo"),!0}catch(e){return!1}},isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isNumeric=function(e){return isNumber(e)},toFloat=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseFloat(e)},toInt=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseInt(e)},String.prototype.noExponents=function(e){var t,n,r,o,a,i,s,l;if(null==e&&(e=!0),1===(t=this.split(/[eE]/)).length)return t[0];if(l="",i="-"===this.slice(0,1)?"-":"",s=t[0].replace(".",""),(r=+t[1]+1)<=0){for(l=i+"0.";!(r>=0);)l+="0",++r;return a=l+s.replace(/^\-/,""),e?parseFloat(a):a}if(s.length<=r){for(r-=s.length;!(r<=0);)l+=0,--r;return a=s+l,e?parseFloat(a):a}return n=parseFloat(t[0]),o=Math.pow(10,parseInt(t[1])),n*o},Number.prototype.noExponents=function(){return(this+"").noExponents(!0)},toObject=function(e){var t,n,r;r={};for(n in e)void 0!==(t=e[n])&&(r[n]=t);return r},String.prototype.toAscii=function(){return this.replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g,"'").replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/\u02C6/g,"^").replace(/\u2039/g,"").replace(/[\u02DC|\u00A0]/g," ")},String.prototype.toBool=function(){return""+this=="true"},Boolean.prototype.toBool=function(){return""+this=="true"},Number.prototype.toBool=function(){return""+this=="1"},String.prototype.addSlashes=function(){return this.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.containsObject=function(e){try{return"object"==typeof _.find(this,function(t){return _.isEqual(e,t)})}catch(e){return e,console.error("Please load underscore.js before using this."),console.info("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js")}},Array.prototype.sum=function(){return this.reduce(function(e,t){return e+t})},Array.prototype.mean=function(){return this.sum()/this.length},Object.toArray=function(e){try{return e.slice(0).push("foo"),e}catch(e){}return Object.keys(e).map(function(t){return function(t){return e[t]}}())},Object.size=function(e){var t,n,r;if("object"!=typeof e)try{return e.length}catch(e){t=e,console.error("Passed argument isn't an object and doesn't have a .length parameter"),console.warn(t.message)}r=0;for(n in e)e.hasOwnProperty(n)&&r++;return r},Object.doOnSortedKeys=function(e,t){var n,r,o,a,i;for(a=[],o=0,r=(i=Object.keys(e).sort()).length;o<r;o++)n=e[i[o]],a.push(t(n));return a},delay=function(e,t){return setTimeout(t,e)},interval=function(e,t){return setInterval(t,e)},roundNumber=function(e,t){var n;return null==t&&(t=0),n=Math.pow(10,t),Math.round(e*n)/n},roundNumberSigfig=function(e,t){var n,r,o,a,i;return null==t&&(t=0),o=""+roundNumber(e,t),1===(n=o.split(".")).length?o+"."+Array(t+1).join("0"):(i=n.pop(),a=n[0]+".",i.length===t?o:(r=t-i.length,i+=Array(r+1).join("0"),""+a+i))},String.prototype.stripHtml=function(e){var t;return null==e&&(e=!1),t=this,e&&(t=t.replace(/<(\w+)(?:[^"'>]|"[^"]*"|'[^']*')*>(?:((?:.)*?))<\/?\1(?:[^"'>]|"[^"]*"|'[^']*')*>/gm,"")),t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),t=t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")},String.prototype.unescape=function(e){var t,n,r;return null==e&&(e=!1),n=document.createElement("div"),t=function(t){return null!=t&&"string"==typeof t&&(t=!0!==e?escape(t).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"):(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),n.innerHTML=t,n.innerText?(t=n.innerText,n.innerText=""):(t=n.textContent,n.textContent="")),unescape(t)},r=deEscape(this),t(r)},deEscape=function(e){return e=e.replace(/\&amp;#/gm,"&#"),e=e.replace(/\&quot;/gm,'"'),e=e.replace(/\&quote;/gm,'"'),e=e.replace(/\&#95;/gm,"_"),e=e.replace(/\&#39;/gm,"'"),e=e.replace(/\&#34;/gm,'"'),e=e.replace(/\&#62;/gm,">"),e=e.replace(/\&#60;/gm,"<")},String.prototype.escapeQuotes=function(){var e;return e=this.replace(/"/gm,"&#34;"),e=e.replace(/'/gm,"&#39;")},getElementHtml=function(e){return e.outerHTML},jQuery.fn.outerHTML=function(){return $(this).get(0).outerHTML},jQuery.fn.outerHtml=function(){return $(this).outerHTML()},jQuery.fn.selectText=function(){var e,t,n=document,r=this[0];n.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(r),e.select()):window.getSelection&&(t=window.getSelection(),(e=document.createRange()).selectNodeContents(r),t.removeAllRanges(),t.addRange(e))},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.polymerSelected=function(e,t,n,r,o){var a,i,s,l,c,u,d,p,m,h,f,g,y,b;if(null==e&&(e=void 0),null==t&&(t="attrForSelected"),null==n&&(n="paper-listbox"),null==r&&(r="paper-item"),null==o&&(o=!0),!$(this).exists())return console.error("Nonexistant element"),!1;if(i=$(this).attr("id"),isNull(i))return console.error("Your parent dropdown (eg, paper-dropdown-menu) must have a unique ID"),!1;s="#"+i+" "+n;try{n===$(this).get(0).tagName.toLowerCase()&&(s=this)}catch(e){}if(!$(s).exists()){s="#"+i+" "+(n="paper-menu");try{n===$(this).get(0).tagName.toLowerCase()&&(s=this)}catch(e){}if(!$(s).exists()){try{return isNull(p$(this).value)?null:p$(this).value}catch(e){console.error("Can't identify the dropdown selector for this dropdown list '"+i+"'",s,this)}return console.warn("Unable to fetch data for item","#"+i),!1}}if(!0!==t?(a=$(s).attr(t),isNull(a)&&(a=!0)):a=!0,null==e){b=void 0;try{try{b=p$(this).selected}catch(e){}isNull(b)&&(b=p$(s).selected),isNumber(b)&&!isNull(a)?(d=$(this).find(r)[toInt(b)],b=!0!==a?$(d).attr(a):$(d).text()):(console.debug("isNumber(val)",isNumber(b,b)),console.debug("isNull attr",isNull(a,a)))}catch(e){return l=e,console.error("Couldn't find selected: "+l.message),console.warn(l.stack),console.debug("Selector",s),!1}"null"!==b&&null!=b||(b=void 0);try{b=b.trim()}catch(e){}return b}if(g=s,isBool(e)||isNull(e)){if(isBool(e)&&($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",e),$(this).prop("active",e),$(this).prop("aria-selected",e),!0===e))return $(this).addClass("iron-selected")}else try{if(!0===a){for(m=0,p=(h=$(this).find(r)).length;m<p;m++)if(u=h[m],y=o?$(u).text().toLowerCase().trim():$(u).text(),f=o?e.toLowerCase().trim():e,y===f){c=$(u).index();break}if(isNull(c))return console.error("Unable to find an index for "+r+" with text '"+e+"' (ignore case: "+o+")"),!1;try{p$(g).select(c)}catch(e){l=e,p$(g).selected=c}p$(g).selected!==c&&doNothing()}else try{p$(g).select(e)}catch(t){p$(g).selected=e}return!0}catch(t){return l=t,console.error("Unable to set selected '"+e+"': "+l.message),!1}},jQuery.fn.polymerChecked=function(e){var t;return null==e&&(e=void 0),null!=e?jQuery(this).prop("checked",e):("null"!==(t=jQuery(this)[0].checked)&&null!=t||(t=void 0),t)},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(e){return function(e){return encodeURI(e).split(/%..|./).length-1}}(),randomInt=function(e,t){var n,r,o;return null==e&&(e=0),null==t&&(t=1),o=Math.random(),null==e&&(e=(n=[0,e])[0],t=n[1]),e>t&&(e=(r=[t,e])[0],t=r[1]),Math.floor(o*(t-e+1)+e)},window.debounce_timer=null,Function.prototype.getName=function(){var e;return null==(e=this.name)&&(e=(""+this).substr(0,(""+this).indexOf("(")).replace("function ","")),isNull(e)&&(e=md5(""+this),window.name=this),e},Function.prototype.debounce=function(){var e,t,n,r,o,a,i,s;i=arguments[0],n=arguments[1],s=arguments[2],e=4<=arguments.length?slice.call(arguments,3):[],null==i&&(i=300),null==n&&(n=!1),null==s&&(s=window.debounce_timer),null==(null!=(a=window.core)?a.debouncers:void 0)&&(null==window.core&&(window.core={}),core.debouncers={});try{o=this.getName()}catch(e){}try{null!=core.debouncers[o]&&(s=core.debouncers[o])}catch(e){}if(r=this,t=function(){if(null!=o&&(clearTimeout(s),delete core.debouncers[o]),!n)return r.apply(r,e)},null!=s)try{clearTimeout(s)}catch(e){e}return n?(r.apply(obj,e),console.debug("Executed "+o+" immediately"),!1):null!=o?core.debouncers[o]=delay(i,function(){return t()}):window.debounce_timer=delay(i,function(){return t()})},loadJS=function(e,t,n,r){var o,a,i,s;if(null==t&&(t={}),null==n&&(n=!0),null==r&&(r=!0),$("script[src='"+e+"']").exists()){if("function"==typeof t)try{t()}catch(e){o=e,console.error("Script is already loaded, but there was an error executing the callback function - "+o.message)}return!0}return(s=document.createElement("script")).setAttribute("src",e),s.setAttribute("type","text/javascript"),s.src=e,!1!==r&&(s.setAttribute("async","async"),s.async=!0),i=function(){var n;n=s.readyState;try{if(!t.done&&(!n||/loaded|complete/.test(n))&&(t.done=!0,"function"==typeof t))try{return t()}catch(t){return o=t,console.error("Postload callback error for '"+e+"' - "+o.message),console.warn(o.stack)}}catch(t){return o=t,console.error("Onload error for '"+e+"' - "+o.message)}},a=function(){console.warn("There may have been a problem loading "+e);try{if(!t.done&&(t.done=!0,"function"==typeof t&&n))try{return t()}catch(e){return o=e,console.error("Post error callback error - "+o.message)}}catch(e){return o=e,console.error("There was an error in the error handler! "+o.message)}},s.setAttribute("onload",i),s.setAttribute("onreadystate",i),s.setAttribute("onerror",a),s.onload=s.onreadystate=i,s.onerror=a,document.getElementsByTagName("head")[0].appendChild(s),!0},String.prototype.toTitleCase=function(){var e,t,n,r,o,a,i,s,l;for(a=this.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),n=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],r=0,21;r<21;r++)e=n[r],t=RegExp("\\s"+e+"\\s","g"),a=a.replace(t,function(e){return e.toLowerCase()});for(l=["Id","Tv"],o=0,2;o<2;o++)i=l[o],s=RegExp("\\b"+i+"\\b","g"),a=a.replace(s,i.toUpperCase());return a},smartUpperCasing=function(e){var t,n,r,o,a,i,s,l,c,u,d;if(isNull(e))return"";a=function(e){return e.replace(e,e.toUpperCase())},c=e.replace(/((?=((?!-)[\W\s\r\n]))\s[A-Za-z]|^[A-Za-z])/g,a),u=["a","an","and","at","but","by","for","in","nor","of","on","or","out","so","to","the","up","yet"];try{for(n=0,t=18;n<t;n++)i=(d=u[n]).toTitleCase(),o=d.toLowerCase(),r=RegExp(" "+i+" ","g"),c=c.replace(r," "+o+" ")}catch(e){}try{c.match(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/m)&&(l=(s=c.replace(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/gm,"$2")).toTitleCase(),c=c.replace(s,l))}catch(e){}return c},mapNewWindows=function(e){return null==e&&(e=!0),$(".newwindow").each(function(){var t,n;return null==(t=$(this).attr("href"))&&(t=$(this).attr("data-href")),n=function(e){return null!=e&&(window.open(e),!1)},$(this).click(function(r){return e&&(r.preventDefault(),r.stopPropagation()),n(t)}),$(this).keypress(function(){return n(t)})})},toastStatusMessage=function(e,t,n,r){var o,a;return null==t&&(t=""),null==n&&(n=3e3),null==r&&(r="#search-status"),!0===window._metaStatus.isToasting?(delay(250,function(){return toastStatusMessage(e,t,n,r)}),!1):(window._metaStatus.isToasting=!0,isNumber(t)&&(n=t),isNumber(n)||(n=3e3),!1===r.slice(0,1)&&(r="#"+r),$(r).exists()||(o='<paper-toast id="'+r.slice(1)+'" duration="'+n+'"></paper-toast>',$(o).appendTo("body")),$(r).attr("text",e).text(e).addClass(t),(a=function(e){var o;++e;try{return p$(r).show(),delay(n+500,function(){var e;try{e=p$(r).opened}catch(e){}return"boolean"!=typeof e&&(e=!1),e||($(r).empty(),$(r).removeClass(t),$(r).attr("text","")),window._metaStatus.isToasting=!1,!1})}catch(t){return o=t,e<=50?delay(50,function(){return a(e),!1}):(console.error("Couldn't show loader: "+o.message),console.warn(o.stack))}})(0),delay(n,function(){return _metaStatus.isToasting=!1}),!1)},openLink=function(e){return null!=e&&(window.open(e),!1)},openTab=function(e){return openLink(e)},goTo=function(e){return null!=e&&(window.location.href=e,!1)},null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(window._metaStatus={}),_metaStatus.isLoading=!1,_metaStatus.isToasting=!1),animateLoad=function(e,t){var n,r;null==e&&(e="loader"),null==t&&(t=0),isNumber(e)&&(e="loader"),"#"===e.slice(0,1)?(r=e,e=e.slice(1)):r="#"+e,$(r).removeAttr("hidden"),null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(_metaStatus={}),_metaStatus.isLoading=!1);try{return _metaStatus.isLoading?t<100?(t++,delay(100,function(){return animateLoad(e,t)}),!1):(console.warn("Loader timed out waiting for load completion"),!1):($(r).exists()?$(r).attr("active",!0):$("body").append('<paper-spinner id="'+e+'" active></paper-spinner'),_metaStatus.isLoading=!0,!1)}catch(e){return n=e,console.warn("Could not animate loader",n.message)}},startLoad=function(e){return null==e&&(e=null),animateLoad(e)},stopLoad=function(e,t,n){var r,o;null==e&&(e="loader"),null==t&&(t=1e3),null==n&&(n=0),"#"===e.slice(0,1)?(o=e,e=e.slice(1)):o="#"+e;try{try{!0!==_metaStatus.isLoading&&p$(o).active&&$(o).isVisible()&&(_metaStatus.isLoading=!0)}catch(e){}return _metaStatus.isLoading?($(o).exists()&&($(o).addClass("good"),function(){return delay(t,function(){try{p$(o).active=!1}catch(e){}return $(o).removeClass("good").attr("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(o).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(o).remove(),_metaStatus.isLoading=!1):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):n<100&&(n++,delay(100,function(){return stopLoad(e,t,n)}),!1)}catch(e){return r=e,console.warn("Could not stop load animation",r.message)}},stopLoadError=function(e,t,n,r){var o,a;null==t&&(t="loader"),null==n&&(n=7500),"#"===t.slice(0,1)?(a=t,t=t.slice(1)):a="#"+t;try{return _metaStatus.isLoading?($(a).exists()&&($(a).addClass("bad"),null!=e&&toastStatusMessage(e,"",n),function(){return delay(n,function(){return $(a).removeClass("bad").prop("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(a).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(a).remove(),_metaStatus.isLoading=!1):($(a).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(a).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):r<100&&(r++,delay(100,function(){return stopLoadError(e,t,n,r)}),!1)}catch(e){return o=e,console.warn("Could not stop load error animation",o.message)}},doCORSget=function(e,t,n,r){var o,a,i,s;null==n&&(n=void 0),null==r&&(r=void 0),o=function(){if("function"==typeof r)return r();throw Error("There was an error performing the CORS request")},i={url:e,data:t,type:"get",crossDomain:!0};try{$.ajax(i).done(function(e){if("function"==typeof n)return n(),!1}).fail(function(e,t){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(e){e,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(e=e+"?"+t,a=function(e,t){var n;return null==e&&(e="get"),n=new XMLHttpRequest,"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n},!(s=a("get",e)))throw Error("CORS not supported");return s.onload=function(){var e;return e=s.responseText,"function"==typeof n&&n(e),!1},s.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),o()},s.send(),!1},deepJQuery=function(e){try{if(!$("html /deep/ "+e).exists())throw"Bad /deep/ selector";return $("html /deep/ "+e)}catch(t){t;try{if(!$("html >>> "+e).exists())throw"Bad >>> selector";return $("html >>> "+e)}catch(t){return t,$(e)}}},p$=function(e){try{return $$(e)[0]}catch(t){try{return $(e).get(0)}catch(t){return d$(e).get(0)}}},window.d$=function(e){return deepJQuery(e)},lightboxImages=function(e,t){var n,r;return null==e&&(e=".lightboximage"),null==t&&(t=!1),r={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},_asm.lightbox={options:r},n=t?d$(e):$(e),loadJS("bower_components/imagelightbox/dist/imagelightbox.min.js",function(){return n.click(function(e){try{return e.preventDefault(),e.stopPropagation(),$(this).imageLightbox(r).startImageLightbox(),console.warn("Event propagation was stopped when clicking on this.")}catch(t){return e=t,console.error("Unable to lightbox this image!")}}).each(function(){var t,n;console.log("Using selectors '"+e+"' / '"+this+"' for lightboximages");try{if(("img"===$(this).prop("tagName").toLowerCase()||"picture"===$(this).prop("tagName").toLowerCase())&&"a"!==$(this).parent().prop("tagName").toLowerCase())return n=$(this).removeClass("lightboximage").prop("outerHTML"),t=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");case!!isNull($(this).attr("data-lightbox-image")):return $(this).attr("data-lightbox-image");case!!isNull($(this).attr("src")):return $(this).attr("src");default:return $(this).find("img").attr("src")}}.call(this),$(this).replaceWith("<a href='"+t+"' data-lightbox='"+t+"' class='lightboximage'>"+n+"</a>"),$("a[href='"+t+"']").imageLightbox(r)}catch(e){return e,console.log("Couldn't parse through the elements")}}),console.info("Lightboxed the following:",n)}),!1},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(e){return null==e&&(e=".sciname"),$(".sciname").each(function(){var e;return e="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",e)})},prepURI=function(e){return(e=encodeURIComponent(e)).replace(/%20/g,"+")},getLocation=function(e){var t,n;return null==e&&(e=void 0),n=function(e,t){return window.locationData.lat=e.coords.latitude,window.locationData.lng=e.coords.longitude,window.locationData.acc=e.coords.accuracy,window.locationData.last=Date.now(),null!=t&&t(window.locationData),!1},t=function(e,t){var n;return n=function(){switch(e.code){case 0:return"There was an error while retrieving your location: "+e.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+e.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(n),null!=t&&t(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(n,t,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=e?e(!1):void 0)},dateMonthToString=function(e){var t,n;t={0:"January",1:"February",2:"March",3:"April",4:"May",5:"June",6:"July",7:"August",8:"September",9:"October",10:"November",11:"December"};try{n=t[e]}catch(t){n=e}return n},bindClickTargets=function(){return bindClicks(),!1},bindClicks=function(e){return null==e&&(e=".click"),$(e).each(function(){var e,t,n,r;try{if(r=$(this).attr("data-href"),isNull(r)&&null!=(r=$(this).attr("data-url"))&&$(this).attr("data-newtab","true"),!isNull(r)){$(this).unbind();try{r===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(e){t=e,console.warn("tagname lower case error")}return $(this).click(function(){var e,t,n;return r=$(this).attr("data-href"),isNull(r)&&(r=$(this).attr("data-url")),(null!=(e=$(this).attr("newTab"))?e.toBool():void 0)||(null!=(t=$(this).attr("newtab"))?t.toBool():void 0)||(null!=(n=$(this).attr("data-newtab"))?n.toBool():void 0)?openTab.debounce(50,null,null,r):goTo(50,null,null,r)}),r}if(null!=(e=null!=(n=$(this).attr("data-function"))?n:$(this).attr("data-fn")))return $(this).unbind(),$(this).click(function(){try{return window[e].debounce(50)}catch(n){return t=n,console.error("'"+e+"()' is a bad function - "+t.message)}})}catch(e){return t=e,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+t.message)}}),!1},getMaxZ=function(){var e;return e=function(){return $.map($("body *"),function(e,t){if("static"!==$(e).css("position"))return parseInt($(e).css("z-index")||1)})},Math.max.apply(null,e())},browserBeware=function(){return!1},bsAlert=function(e,t,n,r){var o,a,i,s,l,c;null==t&&(t="warning"),null==n&&(n="body"),null==r&&(r="#bs-alert");try{$(r).exists()?($(r).removeClass("alert-warning alert-info alert-danger alert-success"),$(r).addClass("alert-"+t)):(l='<div class="alert alert-'+t+' alert-dismissable hanging-alert" role="alert" id="'+r.slice(1)+'">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <div class="alert-message"></div>\n</div>',c=$("main").exists()?"main":$("article").exists()?"article":n,$(c).prepend(l)),$(r+" .alert-message").html(e)}catch(n){(o=document.createElement("div")).setAttribute("class","alert alert-"+t+" alert-dismissable hanging-alert"),o.setAttribute("role","alert"),o.setAttribute("id",r.slice(1)),(i=document.createElement("button")).setAttribute("class","close"),i.setAttribute("data-dismiss","alert"),i.setAttribute("aria-label","Close"),(s=document.createElement("span")).setAttribute("aria-hidden","true"),s.textContent="&times;",i.appendChild(s),o.appendChild(i),(a=document.createElement("div")).setAttribute("class","alert-message"),a.textContent=e,o.appendChild(a);try{document.querySelector("#bs-alert").remove()}catch(e){}document.querySelector("body").appendChild(o)}return bindClicks(),mapNewWindows(),!1},animateHoverShadows=function(e,t,n){var r,o;return null==e&&(e="paper-card.card-tile"),null==t&&(t=2),null==n&&(n=4),r=function(){return $(this).attr("elevation",n)},o=function(){return $(this).attr("elevation",t)},$(e).hover(r,o),!1},allError=function(e){return stopLoadError(e),bsAlert(e,"danger"),console.error(e),!1},checkFileVersion=function(e){var t;return null==e&&(e=!1),t=function(){return $.get(uri.urlString+"meta.php","do=get_last_mod","json").done(function(t){var n;return e&&console.log("Forced version check:",t),!!isNumber(t.last_mod)&&(null==_asm.lastMod&&(_asm.lastMod=t.last_mod),t.last_mod>_asm.lastMod?(n='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(n),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version is out of date! Please refresh the page.")):e?console.info("Your version is up to date: have "+_asm.lastMod+", got "+t.last_mod):void 0)}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){return delay(3e5,function(){return t()})})},!(!e&&null!=_asm.lastMod)&&(t(),!0)},window.checkFileVersion=checkFileVersion,setupServiceWorker=function(){return"serviceworker"in navigator&&navigator.serviceWorker.register("js/serviceWorker.min.js").then(function(e){return console.log("ServiceWorker registered with scope",e.scope)}).catch(function(e){return console.warn("ServiceWorker registration failed:",e)}),!1},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},doNothing=function(){return null},buildArgs=buildQuery=function(e){var t,n,r,o,a;r=[];for(t in e)o=e[t],n=t.replace(/[^A-Za-z\-_\[\]]/gim,""),a=encodeURIComponent(o).replace(/\%20/g,"+"),r.push(n+"="+a);return r.join("&")},checkLocalVersion=function(){var e,t,n,r,o,a;if("localhost"===uri.o.attr("host")){for(o=[],t=0,e=(a=uri.o.attr("directory").split("/")).length;t<e;t++)n=a[t],isNull(n)||o.push(n);r=0===o[0].search("~")?uri.o.attr("protocol")+"://localhost"+o[0]+"/":uri.urlString,$.get(r+"currentVersion").done(function(e){var t,r,o,a;return console.log("Got tag",e),(o=e.replace(/v(([0-9]+\.)+[0-9]+)(\-\w+)?/gim,"$1")).length>128?(console.error("Problem checking version file"),!1):(a=o.split("."),t={access_token:"7a76691c6beea4d47eaaa6182a53e523c6a16a67"},r="https://api.github.com/repos/tigerhawkvok/asm-mammal-database/releases",$.get(r,buildQuery(t,"json")).done(function(e){var t,r,i,s,l,c,u,d,p,m,h;for(console.log("Github API result:",e),c=0,i=e.length;c<i;c++)for(d=e[c],console.log("Checking release",d),r=0,u=0,s=(m=(p=d.tag_name).replace(/v(([0-9]+\.)+[0-9]+)(\-\w+)?/gim,"$1").split(".")).length;u<s;u++){if(n=m[u],h=toInt(n),l=toInt(a[r]),h>l)return console.log("Found mismatched version at",uri.urlString+"/currentVersion"),console.warn("Notice: tag part '"+h+"' > '"+l+"'",p,o),t='<strong>Head\'s-Up:</strong> Your local version is behind the latest application release.\n<br/><br/>\nOpen up your terminal, and in your local directory run:\n<br/><br/>\n<code class="center-block text-center">git pull</code>\n<br/>\nTo get your local version up-to-date.',bsAlert(t),!1;if(h<l)break;++r}return console.debug("Your version is up-to-date"),!1}))})}else doNothing();return!1},jsonTo64=function(e,t){var n,r;null==t&&(t=!0);try{e.slice(0).push("foo"),e=toObject(e)}catch(e){}return r=JSON.stringify(e),n=!0===t?post64(r):encode64(n)},encode64=function(e){try{return Base64.encode(e)}catch(t){return t,console.warn("Bad encode string provided"),e}},decode64=function(e){try{return Base64.decode(e)}catch(t){return t,console.warn("Bad decode string provided"),e}},post64=function(e){var t;return t=encode64(e),encodeURIComponent(t)},objToArgs=function(e){var t,n,r,o;if("object"!=typeof e)throw{message:"INVALID_TYPE"};n=[];for(r in e)o=e[r],t=r+"="+encodeURIComponent(o),n.push(t);return n.join("&")},dataUriToBlob=function(e,t){var n,r,o,a,i,s,l,c,u,d;i=e.split(",")[1],e.split(";")[1].split(",")[0];try{r=atob(i)}catch(e){r=decodeURIComponent(i)}for(l=r.length,n=new Uint8Array(l),d=e.split(",")[0].split(":")[1].split(";")[0],s=0,u=0,c=n.length;u<c;u++)n[u],n[s]=r.charCodeAt(s),++s;return a={type:d},o=new Blob([n],a),"function"==typeof t&&t(o),o},downloadDataUriAsBlob=function(e){var t,n,r;if(isNull(e))return console.error("Needs a data URI or element selector as an argument!"),!1;try{$(e).exists()&&(n=$(e).attr("href"))}catch(e){}return isNull(n)&&(n=e,e=null),t=dataUriToBlob(n),r=URL.createObjectURL(t),isNull(e)?r:($(e).attr("href",r),!1)},delayPolymerBind=function(e,t,n){var r;return null==n&&(n=0),"undefined"==typeof md5||null===md5?loadJS("bower_components/JavaScript-MD5/js/md5.min.js",function(){return r()}):r(),r=function(){var r,o,a,i;if("object"!=typeof window._dpb&&(window._dpb={}),i=md5(e)+md5(t),isNull(window._dpb[i])&&(window._dpb[i]=!1),1e3,null==("undefined"!=typeof Polymer&&null!==Polymer&&null!=(a=Polymer.Base)?a.$$:void 0))return n<50?delay(100,function(){return++n,delayPolymerBind(e,t,n)}):(console.error("Failed to verify Polymer was set up, attempting manual"),o=document.querySelector(e),t(o));!1===window._dpb[i]&&(n=0,window._dpb[i]=!0);try{return o=Polymer.Base.$$(e),t(o),delay(1e3,function(){return console.info("Doing 1000ms delay callback for "+e),t(o)})}catch(a){return r=a,console.warn("Error trying to do the delayed polymer bind - "+r.message),n<10?(++n,delay(75,function(){return delayPolymerBind(e,t,n)})):(console.error("Persistent error in polymer binding ("+r.message+")"),console.error(r.stack),o=$(e).get(0),t(o),delay(1e3,function(){return o=document.querySelector(e),console.info("Doing 1000ms delay callback for "+e),console.info("Using element",o),t(o)}))}},!1},loadSocialMediaSlideoutBar=function(e,t,n){var r,o,a,i,s,l;if(null==t&&(t="#social-menu"),null==n&&(n="main"),l=function(){return $(t).hasClass("out")?$(t).removeClass("out").addClass("in"):$(t).removeClass("in").addClass("out"),!1},window.toggleSocialSlideoutBar=l,!$(t).exists()){r="";for(i in e){switch(o=e[i],i){case"twitter":s='<a class="twitter-timeline" data-link-color="#1DA1F2" href="https://twitter.com/'+o+'">Tweets by @'+o+'</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>';break;default:s=""}r+="\n"+s+"\n"}a='<paper-material id="social-menu" class="out" elevation="4">\n  <paper-icon-button icon="glyphicon-social:twitter" class="show-social"></paper-icon-button>\n  <div class="slideout-content">\n    '+r+"\n  </div>\n</paper-material>","    ",$(n).append(a),$(".show-social").click(function(){return l.debounce(50),!1})}return!1};try{$()}catch(error1){e=error1,bsAlert("<strong>You're offline</strong>: We need at least enough data to load a few dependencies. Please put yourself online and try again.","error")}$(function(){var t,n,r,o,a,i,s,l,c,u,d;try{checkLocalVersion(),interval(36e5,function(){return checkLocalVersion()})}catch(e){}formatScientificNames(),bindClicks(),mapNewWindows();try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(t){e=t,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),!0===("undefined"!=typeof adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)&&loadJS("js/admin.min.js",function(){return loadAdminUi()})}catch(t){e=t,getLocation(),loadJS("js/admin.min.js",function(){return _asm.inhibitRedirect=!0,verifyLoginCredentials(function(){var e,t,n;if(delete _asm.inhibitRedirect,"species-account.php"===uri.o.attr("file")&&"object"==typeof window.speciesData)try{return n=JSON.stringify(window.speciesData),e="#"+Base64.encode(n),t='<paper-icon-button\n  class="click admin-edit-button"\n  data-href="'+uri.urlString+"admin-page.html"+e+'"\n  icon="icons:create"\n  >\n</paper-icon-button>',$("header p paper-icon-button[icon='icons:home']").before(t),bindClicks(".admin-edit-button")}catch(e){}})}),loadJS("js/jquery.cookie.min.js",function(){return!1})}try{for(a=0,r=(u=$("marked-element")).length;a<r;a++)i=u[a],s=$(i).find("script").text(),isNull(s)||(p$(i).markdown=s)}catch(e){}browserBeware(),checkFileVersion();try{loadSocialMediaSlideoutBar(_asm.socialHandles)}catch(e){}try{for(l=0,o=(d=$("figcaption .caption-description")).length;l<o;l++)t=d[l],n=$(t).text().unescape(),$(t).text(n)}catch(e){}try{(c=function(e){var t;return $("figure picture").exists()?(t=$("figure picture").width(),isNull(t,!0)?++e>=10?(console.log("Never saw a bigger image width"),!1):(delay(100,function(){return c(e)}),!1):(e>0&&console.warn("Took "+100*e+"ms to reposition image!"),$("figure p.picture-label").css("left","calc(50% - ("+t+"px/2)*.95)"),lightboxImages(),!1)):(console.log("No image on page"),!1)})(0)}catch(e){}try{return loadJS("bower_components/JavaScript-MD5/js/md5.min.js")}catch(e){}}),(searchParams={lastSearch:"*",targetApi:"api.php",targetContainer:"#result_container"}).apiPath=uri.urlString+searchParams.targetApi,"object"!=typeof window._asm&&(window._asm={}),_asm.affiliateQueryUrl={iucnRedlist:"http://apiv3.iucnredlist.org/api/v3/species/",iucnRedlistCN:"http://apiv3.iucnredlist.org/api/v3/species/common_names/",iNaturalist:"https://www.inaturalist.org/taxa/search",calPhotos:"http://calphotos.berkeley.edu/cgi/img_query"},fetchMajorMinorGroups=function(e,t){var n,r;if(null==e&&(e=null),r=function(){var n,r,o,a,i;$("#eutheria-extra").remove(),o='<paper-item data-type="any" selected>All</paper-item>',a=_asm.major;for(r in a)o+='<paper-item data-type="'+r+'">'+a[r].toTitleCase()+"</paper-item>";if(e?"linnean_family":"simple_linnean_subgroup",n='<paper-menu-button id="simple-linnean-groups" class="col-xs-6 col-md-4">\n  <paper-button class="dropdown-trigger"><iron-icon icon="icons:filter-list"></iron-icon><span id="filter-what" class="dropdown-label"></span></paper-button>\n  <paper-menu label="Group" data-column="simple_linnean_group" class="cndb-filter dropdown-content" id="linnean" name="type" attrForSelected="data-type" selected="0">\n    '+o+"\n  </paper-menu>\n</paper-menu-button>",$("#simple-linnean-groups").exists()){$("#simple-linnean-groups").replaceWith(n),$("#simple-linnean-groups").on("iron-select",function(){var e;return e=$(p$("#simple-linnean-groups paper-menu").selectedItem).text(),$("#simple-linnean-groups span.dropdown-label").text(e)});try{i=$(p$("#simple-linnean-groups paper-menu").selectedItem).text(),$("#simple-linnean-groups span.dropdown-label").text(i)}catch(e){}}return eutheriaFilterHelper(!0),$("#simple-linnean-groups").exists()&&console.log("Replaced menu items with",o),"function"==typeof t&&t(),!1},"object"==typeof _asm.mammalGroupsBase&&"object"==typeof _asm.major)return isArray(_asm.mammalGroupsBase)||(_asm.mammalGroupsBase=Object.toArray(_asm.mammalGroupsBase)),r(),!0;if(!isBool(e))try{e=null==(n=p$("#use-scientific").checked)||n}catch(t){e=!0}return $.get(searchParams.apiPath,"fetch-groups=true&scientific="+e).done(function(e){return!0===e.status&&(_asm.mammalGroupsBase=Object.toArray(e.minor),_asm.major=e.major,r())}).fail(function(e,t){return console.error("Failed to hit API"),console.warn(e,t),!1}),!1},eutheriaFilterHelper=function(e){if(null==e&&(e=!1),!e){fetchMajorMinorGroups.debounce(50);try{$("#use-scientific").on("iron-change",function(){return delete _asm.mammalGroupsBase,fetchMajorMinorGroups.debounce(50)})}catch(e){}}$("#linnean").on("iron-select",function(){var e,t,n,r,o,a,i,s,l,c,u,d,p,m;try{"any"!==$(p$("#linnean").selectedItem).attr("data-type")&&(p$("#global_search").checked=!1)}catch(e){}if("eutheria"===$(p$("#linnean").selectedItem).attr("data-type")){for(s=[],i=0,o=(u=_asm.mammalGroupsBase).length;i<o;i++)r=u[i],s.push(r.toLowerCase());for(s.sort(),l="",c=0,a=s.length;c<a;c++)l+=n='<paper-item data-type="'+(t=s[c])+'">\n  '+t.toTitleCase()+"\n</paper-item>";if(!isBool(p))try{p=null==(d=p$("#use-scientific").checked)||d}catch(e){p=!0}return e=p?"linnean_order":"simple_linnean_subgroup",n='<div id="eutheria-extra"  class="col-xs-12 col-md-5">\n    <label for="type" class="sr-only">Eutheria Filter</label>\n    <div class="row">\n    <paper-menu-button class="col-xs-12" id="eutheria-subfilter">\n      <paper-button class="dropdown-trigger"><iron-icon icon="icons:filter-list"></iron-icon><span id="filter-what" class="dropdown-label"></span></paper-button>\n      <paper-menu label="Group" data-column="'+e+'" class="cndb-filter dropdown-content" id="linnean-eutheria" name="type" attrForSelected="data-type" selected="0">\n        <paper-item data-type="any" selected>All</paper-item>\n        '+l+"\n        \x3c!-- As per flag 4 in readme --\x3e\n      </paper-menu>\n    </paper-menu-button>\n    </div>\n  </div>",$("#simple-linnean-groups").after(n),$("#eutheria-subfilter").on("iron-select",function(){var e;return e=$(p$("#eutheria-subfilter paper-menu").selectedItem).attr("data-type"),$("#eutheria-subfilter span.dropdown-label").text(e)}),m=$(p$("#eutheria-subfilter paper-menu").selectedItem).attr("data-type"),$("#eutheria-subfilter span.dropdown-label").text(m)}return $("#eutheria-extra").remove()});try{doLazily()}catch(e){}return!1},checkLaggedUpdate=function(t){var n,r,o,a,i,s,l,c,u,d,p,m,h;if(console.debug("Executing lagged update check ..."),a=["common_name","species_authority"],m=Date.now(),!0===t.do_client_update){s=i=0,r=!1;try{d=t.result;for(o in d){for(h=d[o],p=!0,u=0,c=2;u<c;u++)if(l=a[u],isNull(h[l])){p=!1;break}p||(++s,n="missing=true&genus="+h.genus+"&species="+h.species,$.get(searchParams.targetApi,n,"json").done(function(e){var t,n,r;if(++i,!e.did_update)return!1;console.log("Update for "+e.canonical_sciname,e),n=$(".cndb-result-entry[data-taxon='"+e.genus+"+"+e.species+"']");for(t in e)r=e[t],$(n).find("."+t).exists()&&!isNull(r)?isNull($(n).find("."+t).text())&&(console.log("Set "+t+" text of "+e.canonical_sciname+" to "+r),$(n).find("."+t).text(r)):$(n).find("."+t).exists()&&isNull(r)&&console.warn("Couldn't update "+t+" - got an empty IUCN result");return!1}).fail(function(e,t){return console.warn("Couldn't update "+h.canonical_sciname,e,t),console.warn(searchParams.targetApi+"?"+n),!1}).always(function(){var e;if(i===s&&r)return e=Date.now()-m,console.log("Finished async IUCN taxa check in "+e+"ms"),stopLoad(),delay(500,function(){return stopLoad(),console.debug("About to try a data walk"),$.get(uri.urlString+"datawalk.php","","json").done(function(e){return!0===e.status?console.log("Completed data walk in "+e.execution_time+"ms"):(console.warn("Data walk executed, but failed to complete"),console.warn(e))}).fail(function(e,t){return console.warn("Couldn't execute data walk",e,t)})})}))}r=!0}catch(t){e=t,console.warn("Couldn't do client update -- "+e.message),console.warn(e.stack)}}else console.debug("Lagged update check unneeded."),stopLoad();return!1},performSearch=function(e){var t,n,r,o,a,i,s,l;if(null==e&&(e=void 0),null==e){if(s=$("#search").val(),s,s=s.toLowerCase(),r=getFilters(),(isNull(s)||null==s)&&isNull(r))return $("#search-status").attr("text","Please enter a search term."),$("#search-status")[0].show(),!1;for($("#search").blur(),s=s.replace(/\./g,""),s=prepURI(s),a=0,o=(i=$("#search_form #search-options-container .bool-search-option paper-toggle-button")).length;a<o;a++)l=i[a],$(l).polymerChecked()&&(t=$(l).attr("id"),s+="&"+t+"=true");isNull(r)||(s=s+"&filter="+r),n="q="+s}else!0===e?(n="q=","(all items)"):(n="q="+e,e.split("&")[0]);return!("#"===s||isNull(s)&&isNull(n)||"q="===n&&!0!==e)&&(animateLoad(),console.log("Got search value "+s+", hitting",searchParams.apiPath+"?"+n),searchParams.lastSearch=s,$.get(searchParams.targetApi,n,"json").done(function(e){return 0===toInt(e.count)?(console.error("No search results: Got search value "+s+", from hitting",searchParams.apiPath+"?"+n),showBadSearchErrorMessage.debounce(null,null,null,e),clearSearch(!0),delay(500,function(){return stopLoadError()}),!1):!0===e.status?(console.log("Server response:",e),$(".hanging-alert.alert-danger").remove(),formatSearchResults(e,void 0,function(){return checkLaggedUpdate.debounce(1e3,null,null,e)}),!1):(clearSearch(!0),$("#search-status").attr("text",e.human_error),$("#search-status")[0].show(),console.error(e.error),console.warn(e),stopLoadError())}).fail(function(e,t){return console.error("There was an error performing the search"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't execute the search - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){var e;return e=Base64.encodeURI(s),null!=s&&setHistory(uri.urlString+"#"+e),!1}))},getFilters=function(t,n){var r,o;if(null==t&&(t=".cndb-filter"),null==n&&(n="AND"),r={},$(t).each(function(){var e,t;if(null==(e=$(this).attr("data-column")))return!0;try{t=$(this).polymerSelected()}catch(e){return!0}return"any"===t||"all"===t||"*"===t||(!(!isNull(t)&&!1!==t||(t=$(this).val(),!isNull(t)))||(r[e]=t.toLowerCase()))}),0===Object.size(r))return"";try{return r.BOOLEAN_TYPE=n,o=JSON.stringify(r),Base64.encodeURI(o)}catch(t){return e=t,!1}},formatSearchResults=function(t,n,r){var o,a,i,s,l,c,u,d,p,m,h,f;return null==n&&(n=searchParams.targetContainer),m=Date.now(),l=0,$("#result-header-container").removeAttr("hidden"),i=t.result,searchParams.result=i,[],h="cndb-result-list",u="<table id='"+h+"' class='table table-striped table-hover col-md-12'>\n\t<tr class='cndb-row-headers'>","</table>",f=t.count,f>150?toastStatusMessage("We found "+t.count+" results, please hang on a moment while we render them...","",5e3):console.log("Not notifying of render delay, only showing "+f+" items"),a=null,o=0,s=["id","minor_type","notes","major_type","taxon_author","taxon_credit","image_license","image_credit","taxon_credit_date","parens_auth_genus","parens_auth_species","is_alien","internal_id","source","deprecated_scientific","canonical_sciname","simple_linnean_group","iucn","dwc","entry","common_name_source","image_caption","species_authority_citation","genus_authority_citation","citation","simple_linnean_group_alt","linnean_tribe","linnean_subfamily"],c=0,d=delay(7500,function(){return stopLoadError("There was a problem parsing the search results."),console.error("Couldn't finish parsing the results! Expecting "+f+" elements, timed out on "+c+"."),console.warn(i),!1}),p=["common_name","genus","species"],delay(5,function(){var f,g,y,b,w,v,_,x,S,k,C,N,T,L;g=[];for(b in i){N=i[b],f=!0;for(w in N)L=N[w],indexOf.call(g,w)>=0||(isNull(L)?f=!1:g.push(w));if(f)break}indexOf.call(g,"subspecies")>=0&&p.push("subspecies"),k=i[0];for(w in k)L=k[w],indexOf.call(p,w)<0&&indexOf.call(s,w)<0&&indexOf.call(g,w)>=0&&p.push(w);S=i,i={};for(b in S)for(N=S[b],i[b]={},x=0,_=p.length;x<_;x++)v=p[x],i[b][v]=N[v];return T=0,y=Object.toArray(i),(C=function(i,s,p){var f,g,y,v,_,x,S,k,j,A,P,B,O,E,I,R,U,M,D,F,z,H;S="",b=0,O=null,F=!1,isNumber(p)||(p=100),v=i.length<=p;try{R={action:"render-row",data:i,chunk:p,firstIteration:s},z=new Worker("js/serviceWorker.js"),console.info("Rendering list off-thread"),z.addEventListener("message",function(e){return console.info("Got message back from service worker",e.data),F=!0,S=e.data.html,O=e.data.nextChunk,e.data.renderChunk,b=e.data.loops,B()}),z.postMessage(R)}catch(t){for(console.log("Starting loop with i = "+b+", renderChunk = "+p+", data length = "+i.length,s,v),I=0,P=i.length;I<P;I++){if(N=i[I],++T,c=b,0===toInt(b)&&s){j=0,u+="\n\x3c!-- Table Headers - "+Object.size(N)+" entries --\x3e";for(w in N)L=N[w],++T,E=w.replace(/_/g," "),E=function(){switch(E){case"simple linnean subgroup":return"Group";case"major subtype":return"Clade";default:return E}}(),u+="\n\t\t<th class='text-center'>"+E+"</th>",o++,j++;u+="\n\t</tr>",u+="\n\x3c!-- End Table Headers --\x3e",console.log("Got "+o+" display columns."),f=roundNumber(12/o,0),a="col-md-"+f,_=u+"</table>",S=u,$(n).html(_)}D=N.genus+"+"+N.species,isNull(N.subspecies)||(D=D+"+"+N.subspecies),k="\n\t<tr id='"+("msadb-row"+b)+"' class='cndb-result-entry' data-taxon=\""+D+'" data-genus="'+N.genus+'" data-species="'+N.species+'">';for(w in N){if(g=N[w],++T,"authority_year"===w)if(isNull(g))y=g;else{try{y=JSON.parse(g)}catch(t){e=t;try{console.warn("There was an error parsing authority_year='"+g+"', attempting to fix - ",e.message),M=g.split(":"),H=M[1].slice(M[1].search('"')+1,-2),H=H.replace(/"/g,"'"),M[1]='"'+H+'"}',g=M.join(":"),y=JSON.parse(g)}catch(t){e=t,console.error("There was an error parsing '"+g+"'",e.message),y=g}}try{x=Object.keys(y)[0],U=y[x],toInt(N.parens_auth_genus).toBool()&&(x="("+x+")"),toInt(N.parens_auth_species).toBool()&&(U="("+U+")"),g="G: "+x+"<br/>S: "+U}catch(e){}}"image"===w&&(g=isNull(g)?"<paper-icon-button icon='launch' data-href='"+_asm.affiliateQueryUrl.mammalPhotos+"?rel-taxon=contains&where-taxon="+D+"' class='newwindow calphoto click' data-taxon=\""+D+'"></paper-icon-button>':"<paper-icon-button icon='image:image' data-lightbox='"+uri.urlString+g+"' class='lightboximage'></paper-icon-button>"),A="genus"!==w&&"species"!==w&&"subspecies"!==w?w+" text-center":w,"genus_authority"===w||"species_authority"===w?A+=" authority":"common_name"===w&&(g=smartUpperCasing(g),A+=" no-cap"),k+="\n\t\t<td id='"+w+"-"+b+"' class='"+A+" "+a+"'>"+g+"</td>"}if(k+="\n\t</tr>",S+=k,++b>=p)break}console.log("Ended data loop with i = "+b+", renderChunk = "+p),B()}return B=function(){var e;if(s?(S+="</table>",$(n).html(S),$("#result-count").text(" - "+t.count+" entries"),"space_common_fallback"!==t.method||$("#space-fallback-info").exists()?$("#space-fallback-info").exists()&&$("#space-fallback-info").prop("hidden",!0):(e='<div id="space-fallback-info" class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Don\'t see what you want?</strong> We might use a slightly different name. Try <a href="" class="alert-link" id="do-instant-fuzzy">checking the "fuzzy" toggle and searching again</a>, or use a shorter search term.\n</div>',$("#result_container").before(e),$("#do-instant-fuzzy").click(function(e){return e.preventDefault(),function(){return $("#fuzzy").get(0).checked=!0,performSearch()}.debounce()}))):$("table#"+h+" tbody").append(S),v||(l=Date.now()-m,null==O&&(O=i.slice(b)),console.log("Chunk rendered at "+l+"ms, next bit with slice @ "+b+":",O),0!==O.length?delay(F?25:250,function(){return C(O,!1,p)}):v=!0),v&&(l=Date.now()-m,console.log("Finished rendering list in "+l+"ms"),console.debug("Executed "+T+" loops"),l>3e3&&!F&&console.warn("Warning: Took greater than 3 seconds to render!"),stopLoad(),delay(250,function(){return stopLoad()}),"function"==typeof r))try{r()}catch(e){}return clearTimeout(d),mapNewWindows(),lightboxImages(),$(".cndb-result-entry").unbind().click(function(){var e;return e="genus="+$(this).attr("data-genus")+"&species="+$(this).attr("data-species"),goTo("species-account.php?"+e)}),doFontExceptions()}})(y,!0,100)}),!1},parseTaxonYear=function(t,n){var r,o,a,i,s;null==n&&(n=!0);try{r=JSON.parse(t)}catch(o){e=o,console.warn("There was an error parsing '"+t+"', attempting to fix - ",e.message);try{i=t.split(":"),s=i[1].slice(i[1].search('"')+1,-2),s=s.replace(/"/g,"'"),i[1]='"'+s+'"}',t=i.join(":");try{r=JSON.parse(t)}catch(r){return e=r,!n&&t}}catch(r){return e=r,!n&&t}}return o=Object.keys(r)[0],a=r[o],s={},s.genus=o,s.species=a,s},checkTaxonNear=function(e,t,n){var r,o,a,i,s;return null==e&&(e=void 0),null==t&&(t=void 0),null==n&&(n="#near-me-container"),null==e?(console.warn("Please specify a taxon."),!1):(null==locationData.last&&getLocation(),(Date.now()-locationData.last)/1e3>900&&getLocation(),r="https://www.inaturalist.org/places.json",o="taxon="+e+"&latitude="+locationData.lat+"&longitude="+locationData.lng+"&place_type=county",i="",a="",s="",$.get(r,o,"json").done(function(e){return Object.size(e)>0?(i="communication:location-on",a="good-location",s="This species occurs in your county"):(i="communication:location-off",a="bad-location",s="This species does not occur in your county")}).fail(function(e,t){return a="bad-location",i="warning",s="We couldn't determine your location"}).always(function(){var e;if(e='<div class="tooltip fade top in right manual-placement-tooltip" role="tooltip" style="top: 6.5em; left: 4em; right:initial; display:none" id="manual-location-tooltip">\n  <div class="tooltip-arrow" style="top:50%;left:5px"></div>\n  <div class="tooltip-inner">'+s+"</div>\n</div>",d$(n).html("<iron-icon icon='"+i+"' class='small-icon "+a+" near-me' data-toggle='tooltip' id='near-me-icon'></iron-icon>"),$(n).after(e).mouseenter(function(){return d$("#manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return d$("#manual-location-tooltip").css("display","none"),!1}),null!=t)return t()}),!1)},insertModalImage=function(t,n,r){var o,a,i,s,l,c,u,d,p,m,h;if(null==t&&(t=_asm.taxonImage),null==n&&(n=_asm.activeTaxon),null==r&&(r=void 0),null==n)return console.error("Tried to insert a modal image, but no taxon was provided!"),!1;if("object"!=typeof n)return console.error("Invalid taxon data type (expecting object), got "+typeof n),h={taxon:n,imageUrl:l,defaultTaxon:_asm.activeTaxon,defaultImage:_asm.taxonImage},console.warn(h),!1;if(d=function(t,n,o){var a,i,s,l,c,u;null==o&&(o="calphoto"),u=t.thumbUri,s=t.imageUri,l="function"==typeof t.imageLinkUri?t.imageLinkUri(t.imageUri):void 0,i=t.imageLicense,a='<div class="modal-img-container">\n  <a href="'+s+'" class="'+o+'-img-anchor center-block text-center">\n    <img src="'+u+'"\n      data-href="'+l+'"\n      class="'+o+'-img-thumb"\n      data-taxon="'+n+'" />\n  </a>\n  <p class="small text-muted text-center">\n    Image by '+t.imageCredit+" under "+i+"\n  </p>\n</div>",d$("#meta-taxon-info").before(a),(c=function(t){try{return d$("#modal-taxon").get(0).fit(),delay(250,function(){return d$("#modal-taxon").get(0).fit(),delay(750,function(){return d$("#modal-taxon").get(0).fit()})})}catch(n){return e=n,t<10?(t++,delay(100,function(){return c(t)})):console.warn("Couldn't execute fit!")}})(0);try{lightboxImages("."+o+"-img-anchor",!0)}catch(t){e=t,console.error("Error lightboxing images")}return"function"==typeof r&&r(),!1},p=[n.genus,n.species],null!=n.subspecies&&p.push(n.subspecies),m=p.join("+"),null!=t.imageUri)return"string"==typeof t&&(l=t,(t={}).imageUri=l),c=t.imageUri.split("."),i=c.pop(),u=c.join("."),t.thumbUri=""+uri.urlString+u+"-thumb."+i,t.imageUri=""+uri.urlString+u+"."+i,d(t,m,"asmimg"),!1;o="getthumbinfo=1&num=all&cconly=1&taxon="+m+"&format=xml",a=function(n){var r,a;a=xmlToJSON.parseString(n),window.testData=a;try{r=a.calphotos[0]}catch(t){e=t,r=void 0}if(null==r)return!1;t={};try{if(t.thumbUri=r.thumb_url[0]._text,null==t.thumbUri)return console.warn("CalPhotos didn't return any valid images for this search!"),!1;t.imageUri=r.enlarge_jpeg_url[0]._text,t.imageLinkUri=r.enlarge_url[0]._text,t.imageLicense=r.license[0]._text,t.imageCredit=r.copyright[0]._text+" (via CalPhotos)"}catch(t){return e=t,console.warn("CalPhotos didn't return any valid images for this search!",_asm.affiliateQueryUrl.calPhotos+"?"+o),!1}return d(t,m),!1},s=function(e,t){return insertCORSWorkaround(),console.error("Couldn't load a CalPhotos image to insert!"),!1};try{doCORSget(_asm.affiliateQueryUrl.calPhotos,o,a,s)}catch(t){e=t,console.error(e.message)}return!1},modalTaxon=function(t){var n;return null==t&&(t=void 0),null==t?($(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))}),!1):(animateLoad(),$("#modal-taxon").exists()||(n='<paper-dialog modal id=\'modal-taxon\' entry-animation="scale-up-animation" exit-animation="scale-down-animation">\n  <h2 id="modal-heading"></h2>\n  <paper-dialog-scrollable id=\'modal-taxon-content\'></paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id=\'modal-inat-linkout\'>iNaturalist</paper-button>\n    <paper-button id=\'modal-calphotos-linkout\' class="hidden-xs">CalPhotos</paper-button>\n    <paper-button id=\'modal-alt-linkout\' class="hidden-xs"></paper-button>\n    <paper-button dialog-dismiss autofocus>Close</paper-button>\n  </div>\n</paper-dialog>',$("body").append(n)),$.get(searchParams.targetApi,"q="+t,"json").done(function(r){var o,a,i,s,l,c,u,d,p,m,h,f,g,y;if(null==(a=r.result[0]))return toastStatusMessage("There was an error fetching the entry details. Please try again later."),stopLoadError(),!1;if(g=parseTaxonYear(a.authority_year),y="",!1!==g&&(s="<span class='genus_authority authority'>"+a.genus_authority+"</span> "+g.genus,m="<span class='species_authority authority'>"+a.species_authority+"</span> "+g.species,toInt(a.parens_auth_genus).toBool()&&(s="("+s+")"),toInt(a.parens_auth_species).toBool()&&(m="("+m+")"),y="<div id=\"is-alien-container\" class=\"tooltip-container\"></div>\n<div id='near-me-container' data-toggle='tooltip' data-placement='top' title='' class='near-me tooltip-container'></div>\n<p>\n  <span class='genus'>"+a.genus+"</span>,\n  "+s+";\n  <span class='species'>"+a.species+"</span>,\n  "+m+"\n</p>"),i="",!isNull(a.deprecated_scientific)){i="<p>Deprecated names: ";try{p=JSON.parse(a.deprecated_scientific),c=0,$.each(p,function(e,t){if(1!==++c&&(i+="; "),i+="<span class='sciname'>"+e+"</span>, "+t,c===Object.size(p))return i+="</p>"})}catch(t){e=t,i="",console.error("There were deprecated scientific names, but the JSON was malformed.")}}u="",isNull(a.minor_type)||(u=" <iron-icon icon='arrow-forward'></iron-icon> <span id='taxon-minor-type'>"+a.minor_type+"</span>"),isNull(a.notes)?(a.notes="Sorry, we have no notes on this taxon yet.",a.taxon_credit=""):isNull(a.taxon_credit)||"null"===a.taxon_credit?a.taxon_credit="This taxon information is uncredited.":(f=isNull(a.taxon_credit_date)||"null"===a.taxon_credit_date?"":" ("+a.taxon_credit_date+")",a.taxon_credit="Taxon information by "+a.taxon_credit+"."+f);try{d=markdown.toHTML(a.notes)}catch(t){e=t,d=a.notes,console.warn("Couldn't parse markdown!! "+e.message)}d=d.replace(/\&amp;(([a-z]+|[0-9]+);)/gm,"&$1"),o=isNull(a.major_common_type)?"":" (<span id='taxon-common-type'>"+a.major_common_type+"</span>) ",n="<div id='meta-taxon-info'>\n  "+y+"\n  <p>\n    English name: <span id='taxon-common-name' class='common_name no-cap'>"+smartUpperCasing(a.common_name)+"</span>\n  </p>\n  <p>\n    Type: <span id='taxon-type' class=\"major_type\">"+a.major_type+"</span>\n    "+o+"\n    <iron-icon icon='arrow-forward'></iron-icon>\n    <span id='taxon-subtype' class=\"major_subtype\">"+a.major_subtype+"</span>"+u+"\n  </p>\n  "+i+"\n</div>\n<h3>Taxon Notes</h3>\n<p id='taxon-notes'>"+d+'</p>\n<p class="text-right small text-muted">'+a.taxon_credit+"</p>",$("#modal-taxon-content").html(n),$("#modal-inat-linkout").unbind().click(function(){return openTab(_asm.affiliateQueryUrl.iNaturalist+"?q="+t)}),$("#modal-calphotos-linkout").unbind().click(function(){return openTab(_asm.affiliateQueryUrl.calPhotos+"?rel-taxon=contains&where-taxon="+t)}),h=t.split("+"),_asm.activeTaxon={genus:h[0],species:h[1],subspecies:h[2]},$("#modal-alt-linkout").addClass("hidden").unbind(),formatScientificNames(),doFontExceptions(),l=(l=t.charAt(0).toUpperCase()+t.slice(1)).replace(/\+/g," "),d$("#modal-heading").text(l),isNull(a.image)&&(a.image=void 0),_asm.taxonImage={imageUri:a.image,imageCredit:a.image_credit,imageLicense:a.image_license};try{insertModalImage()}catch(t){e=t,console.info("Unable to insert modal image! ")}return checkTaxonNear(t,function(){var e;return stopLoad(),e=d$("#modal-taxon")[0],d$("#modal-taxon").on("iron-overlay-opened",function(){return e.fit(),e.scrollTop=0,toFloat($(e).css("top").slice(0,-2))>$(window).height()&&$(e).css("top","12.5vh"),delay(250,function(){return e.fit()})}),e.sizingTarget=d$("#modal-taxon-content")[0],safariDialogHelper("#modal-taxon")}),bindDismissalRemoval()}).fail(function(e,t){return stopLoadError()}),!1)},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},doFontExceptions=function(){var e,t;return e=["de","and"],t=function(t){return $.each(e,function(e,n){var r;if(r=" "+n+" ",null!=t)return t=t.replace(r," <span class='force-lower'>"+n+"</span> ")}),t},d$(".authority").each(function(){var e;if(e=$(this).text(),!isNull(e))return $(this).html(t(e))}),!1},sortResults=function(e){return searchParams.result},setHistory=function(e,t,n){return null==e&&(e="#"),null==t&&(t=null),null==n&&(n=null),history.pushState(t,n,e),uri.query=$.url(e).attr("fragment"),!1},clearSearch=function(e){var t;return null==e&&(e=!1),$("#result-count").text(""),t='<div class="alert alert-info center-block col-xs-12 col-sm-8 col-md-5">\n  Search for a common or scientific name above to begin, eg, "Brown Bear" or "<span class="sciname">Ursus arctos</span>"\n</div>',$("#result_container").html(t),$("#result-header-container").attr("hidden","hidden"),$(".hanging-alert.alert-danger").remove(),!0!==e&&(setHistory(),$(".cndb-filter").attr("value",""),$("#collapse-advanced").collapse("hide"),$("#search").attr("value",""),$("#linnean").polymerSelected("any"),formatScientificNames(),!1)},safariDialogHelper=function(t,n,r){var o,a;if(null==t&&(t="#download-chooser"),null==n&&(n=0),"function"!=typeof r&&(r=function(){return bindDismissalRemoval()}),!(n<10))return stopLoadError("Unable to show dialog. Please try again.");try{try{p$(t).open()}catch(e){d$(t).get(0).open()}return"function"==typeof r&&r(),stopLoad()}catch(i){return e=i,a=n+1,o=250,delay(o,function(){return console.warn("Trying again to display dialog after "+a*o+"ms"),console.debug("Error caught: "+e.message),console.debug(e.stack),safariDialogHelper(t,a,r)})}},safariSearchArgHelper=function(e,t){var n,r;return null==t&&(t=!1),n=null!=e?e:$("#search").val(),r=!1,-1!==n.search(/\+/)&&(r=!0,n=n.replace(/\+/g," ").trim(),delay(100,function(){return safariSearchArgHelper()})),(r||null!=e)&&($("#search").attr("value",n),t||delay(5e3,function(){return safariSearchArgHelper(void 0,!0)})),!1},insertCORSWorkaround=function(){var t,n,r;if(null==_asm.hasShownWorkaround&&(_asm.hasShownWorkaround=!1),_asm.hasShownWorkaround)return!1;try{n=new WhichBrowser}catch(t){return e=t,!1}return n.isType("mobile")?(_asm.hasShownWorkaround=!0,!1):(t=function(){switch(n.browser.name){case"Chrome":return"Install the extension \"<a class='alert-link' href='https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?utm_source=chrome-app-launcher-info-dialog'>Allow-Control-Allow-Origin: *</a>\", activate it on this domain, and you'll see them in your popups!";case"Firefox":return"Follow the instructions <a class='alert-link' href='http://www-jo.se/f.pfleger/forcecors-workaround'>for this ForceCORS add-on</a>, or try Chrome for a simpler extension. Once you've done so, you'll see photos in your popups!";case"Internet Explorer":return"Follow these <a class='alert-link' href='http://stackoverflow.com/a/20947828'>StackOverflow instructions</a> while on this site, and you'll see them in your popups!";default:return""}}(),r='<div class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Want CalPhotos images in your species dialogs?</strong> '+t+"\n  We're working with CalPhotos to enable this natively, but it's a server change on their side.\n</div>",$("#result_container").before(r),$(".alert").alert(),_asm.hasShownWorkaround=!0,!1)},showBadSearchErrorMessage=function(e){var t,n,r,o;try{r=e.query.replace(/\+/g," ")}catch(e){r=$("#search").val()}try{!0===e.status?!0===e.query_params.filter.had_filter?(t="",n=0,$.each(e.query_params.filter.filter_params,function(r,o){if("BOOLEAN_TYPE"!==r)return 0!==n&&(t=filter_text+" "+e.filter.filter_params.BOOLEAN_TYPE),isNumber(toInt(o,!0))&&(o=1===toInt(o)?"true":"false"),t=t+" "+r.replace(/_/g," ")+" is "+o}),o='"'+r+'" where '+t+" returned no results."):o='"'+r+'" returned no results.':o=e.human_error}catch(e){o="Sorry, there was a problem with your search"}try{o.search(/no results/)>=0&&(bsAlert("<code>ZERO_RESULTS</code><strong>:</strong> "+o,"danger"),o="Sorry, your search returned no results")}catch(e){}return stopLoadError(o)},bindPaperMenuButton=function(e,t){return null==e&&(e="paper-menu-button"),null==t&&(t=!0),!1},getRandomEntry=function(){var e;return startLoad(),e={random:!0,require_image:!0},$.get(searchParams.apiPath,buildQuery(e,"json")).done(function(e){var t,n;return(isNull(e.genus)||isNull(e.species))&&stopLoadError("Unable to fetch random entry"),t={genus:e.genus,species:e.species},isNull(e.subspecies)||(t.subspecies=e.subspecies),n=uri.urlString+"species-account.php?"+buildQuery(t),console.log("About to go to",n),goTo(n),stopLoad()}).fail(function(){return stopLoadError("Unable to fetch random entry")}),!1},window.getRandomEntry=getRandomEntry,doLazily=function(){return!0!==("undefined"!=typeof _asm&&null!==_asm?_asm.hasDoneLazily:void 0)&&("object"!=typeof _asm&&(window._asm={}),_asm.hasDoneLazily=!0,loadJS(uri.urlString+"js/download.min.js",function(){var e;return e='<paper-icon-button\n  icon="icons:cloud-download"\n  class="click"\n  data-fn="showDownloadChooser"\n  title="Download Copy"\n  data-toggle="tooltip"\n  >\n</paper-icon-button>',$("#git-footer").prepend(e),bindClicks(),mobileCollapsable(),loadJS(uri.urlString+"js/terminal.min.js",function(){return bindClicks(),console.debug("Terminal file loaded"),stopLoad()}),!1}),$("paper-card.featured-mammal").exists()&&$("paper-card.featured-mammal").click(function(){var e,t;return e=$(this).attr("data-taxon-id"),t="species-account/id="+e,goTo(t),!1})),!1},mobileCollapsable=function(e,t,n){var r,o,a;if(null==e&&(e=".search-options-panel"),null==t&&(t=null!=(a="undefined"!=typeof _asm&&null!==_asm?_asm.mobileBreakpoint:void 0)?a:767),null==n&&(n=250),console.debug("Checking mobile status"),$(window).width()<=t){if("object"!=typeof("undefined"!=typeof core&&null!==core?core.debouncers:void 0)&&("object"!=typeof core&&(window.core={}),core.debouncers={}),null!=core.debouncers.mobileCollapsable){if(Date.now()-core.debouncers.mobileCollapsable<=n)return!1;delete core.debouncers.mobileCollapsable,clearTimeout(core.debouncers.mobileCollapseableTimeout)}return core.debouncers.mobileCollapsable=Date.now(),r=2*n,core.debouncers.mobileCollapseableTimeout=delay(r,function(){return delete core.debouncers.mobileCollapsable}),$(e).find("section").collapse(),o=!1,$($(e).find("section").get(0)).on("shown.bs.collapse",function(){return o||(delay(50,function(){var t,n,r,o,a;for(o=[],n=0,t=(r=$(e).find("section")).length;n<t;n++)a=r[n],o.push($(a).collapse("hide"));return o}),o=!0),!1}),$(e).find("legend").text("Show Options").addClass("btn btn-default").click(function(){var t;return t=!$(e).find("section").hasClass("in"),t?($(this).text("Hide Options"),$(e).find("section").collapse("show")):($(this).text("Show Options"),$(e).find("section").collapse("hide"))}),!0}return console.debug("Not a mobile viewport"),!1},$(function(){var t,n,r,o,a,i,s,l,c,u,d,p,m,h,f,g,y;if(n="****************************************************************************\nHello developer!\nIf you're looking for hints on our API information, this site is open-source\nand released under the GPL. Just click on the GitHub link on the bottom of\nthe page, or check out LINK_TO_ORG_REPO\n****************************************************************************",console.log(n),_asm.polymerReady=!1,s=["admin-login.php","admin-page.html","admin-page.php"],p=uri.o.attr("file"),indexOf.call(s,p)>=0){try{(h=function(){var e;try{if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0))return Polymer.Base.ready(function(){return _asm.polymerReady=!0}),delay(250,function(){return _asm.polymerReady=!0});throw{message:"POLYMER_NOT_READY"}}catch(e){return delay(100,function(){return h})}})()}catch(e){}return!1}if(animateLoad(),window.addEventListener("popstate",function(e){var t,n;uri.query=$.url().attr("fragment");try{t=Base64.decode(uri.query)}catch(e){e,t=""}return performSearch.debounce(50,null,null,t),n=t.split("&")[0],$("#search").attr("value",n)}),$("#do-reset-search").click(function(){return clearSearch()}),$("#search_form").submit(function(e){return e.preventDefault(),performSearch.debounce(50)}),$("#collapse-advanced").on("shown.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-less"),p$("#global_search").checked=!1,!1}),$("#collapse-advanced").on("hidden.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-more")}),$("#search_form").keypress(function(e){if(13===e.which)return performSearch.debounce(50)}),$("#do-search").click(function(){return performSearch.debounce(50)}),$("#do-search-all").click(function(){return performSearch.debounce(50,null,null,!0)}),$("#linnean").on("iron-select",function(){if(!isNull($("#search").val()))return performSearch.debounce()}),eutheriaFilterHelper(),bindPaperMenuButton(),isNull(uri.query)){l="";try{(h=function(){var e;try{if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0))return Polymer.Base.ready(function(){return _asm.polymerReady=!0}),delay(250,function(){return _asm.polymerReady=!0});throw{message:"POLYMER_NOT_READY"}}catch(e){return delay(100,function(){return h})}})()}catch(e){}}else try{l=Base64.decode(uri.query),d=$.url(searchParams.apiPath+"?q="+l);try{c=d.param("loose").toBool()}catch(t){e=t,c=!1}try{i=d.param("fuzzy").toBool()}catch(t){e=t,i=!1}g=l.split("&")[0],safariSearchArgHelper(g),(a=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return _asm.polymerReady=!0,delay(250,function(){if(c&&d$("#loose").attr("checked","checked"),i)return d$("#fuzzy").attr("checked","checked")}),!1;if(null==_asm.stateIter&&(_asm.stateIter=0),++_asm.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return _asm.polymerReady=!0,delay(250,function(){return console.info("Doing a late Polymer.Base.ready call"),c&&d$("#loose").attr("checked","checked"),i&&d$("#fuzzy").attr("checked","checked"),safariSearchArgHelper(),eutheriaFilterHelper()})})}catch(e){return delay(250,function(){return a()})}})();try{r=d.param("filter"),o=JSON.parse(Base64.decode(r)),u=!1,f=["simple-linnean-group","simple-linnean-subgroup","linnean-family","type","BOOLEAN-TYPE"];for(t in o)y=o[t],m=".cndb-filter[data-column='"+(t=t.replace(/_/g,"-"))+"']",indexOf.call(f,t)<0?(console.debug("Col '"+t+"' is not a simple filter"),$(m).attr("value",y),u=!0):$(".cndb-filter[data-column='"+t+"']").polymerSelected(y);u&&$("#collapse-advanced").collapse("show")}catch(t){e=t,r=!1}}catch(t){e=t,console.error("Bad argument "+uri.query+" => "+l+", looseState, fuzzyState",c,i,searchParams.apiPath+"?q="+l),console.warn(e.message),l=""}if(isNull(l)||"#"===l)return stopLoad(),$("#search").attr("disabled",!1),(a=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return _asm.polymerReady=!0,delay(250,function(){return d$("#loose").attr("checked","checked"),eutheriaFilterHelper()}),!1;if(null==_asm.stateIter&&(_asm.stateIter=0),++_asm.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return _asm.polymerReady=!0,delay(250,function(){return d$("#loose").attr("checked","checked"),eutheriaFilterHelper()})})}catch(e){return delay(250,function(){return a()})}})();try{searchParams.lastSearch=l}catch(e){}return $.get(searchParams.targetApi,"q="+l,"json").done(function(e){return _asm.polymerReady=!0,console.debug("Server query got",e),!0===e.status&&e.count>0?(console.log("Got a valid result, formatting "+e.count+" results."),formatSearchResults(e,void 0,function(){return console.log("Format results finished, checking lagged update"),checkLaggedUpdate(e)}),!1):(console.warn("Bad initial search"),showBadSearchErrorMessage.debounce(null,null,null,e),console.error(e.error),console.warn(e))}).fail(function(e,t){return console.error("There was an error loading the generic table"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't load table - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){return $("#search").attr("disabled",!1),!1})});
//# sourceMappingURL=c.min.js.map