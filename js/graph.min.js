var checkInputTaxon,fireRelationshipSearch,nodeClickEvent,plotRelationships;loadJS("bower_components/d3/d3.min.js",function(){return loadJS("https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js",function(){return loadJS("bower_components/alchemyjs/dist/alchemy.js",function(){return $("head").append("<link rel='stylesheet' href='bower_components/alchemyjs/dist/alchemy.min.css'>"),console.info("Alchemy ready"),$("#do-relationship-search").removeAttr("disabled")})})}),plotRelationships=function(e,n){var r,o;return null==e&&(e="rhinoceros unicornis"),null==n&&(n="bradypus tridactylus"),r={action:"relatedness",taxon1:null!=e?e:"rhinoceros unicornis",taxon2:null!=n?n:"bradypus tridactylus"},o=buildArgs(r),console.debug("Visiting","graphHandler.php?"+o),$.get("graphHandler.php",o,"json").done(function(e){return console.debug(e),window.alchemyResult=e,{dataSource:e,directedEdges:!0,forceLayout:!1},sgraph.graph.read(e),sgraph.refresh(),delay(500,function(){return $("#alchemy .node.root circle").attr("r",15)}),$("g.node").unbind().click(function(){return nodeClickEvent(this)}),!1}).error(function(e,n){return!1}),!1},nodeClickEvent=function(e,n){var r,o,t,a;return null==n&&(n=null),o=function(n,r,o){var t,a,l,i;return null==r&&(r=0),null==o&&(o=0),console.debug(n),!isNull(n.label)&&(l=$(e).find("text").text(),isNull(l)&&(l=isNull(n.binomial)?n.label:n.binomial),"species"!==n.rank.toLowerCase()||(i=l.split(" "),t={genus:i[0],species:i[1]},a="species-account.php?"+buildArgs(t),isNull(t.species))?(t={action:"children",taxon:l},console.debug("Finding children","graphHandler.php?"+buildArgs(t)),$.get("graphHandler.php",buildArgs(t),"json").done(function(n){var t,a,l,i,s,c,d,u;for(console.debug("Got result",n),a=0,r+=1,l=0,s=(d=n.nodes).length;l<s;l++){e=d[l],console.debug("Creating node",e);try{++a,e.x+=r+1.5*a,e.y+=o+.25*a,console.debug("offsets",e.x,e.y);try{e.caption!==e.label&&(e.label=e.caption,console.debug("Replaced label"))}catch(e){}sgraph.graph.addNode(e)}catch(e){}}for(i=0,c=(u=n.edges).length;i<c;i++){t=u[i],console.debug("Creating edge",t);try{sgraph.graph.addEdge(t)}catch(e){}}return sgraph.refresh(),$("g.node").unbind().click(function(){return nodeClickEvent(this)}),!1}).error(function(e,n){return!1}),!1):(goTo(a),!0))},isNull(n)?(a=$(e).attr("id"),t=a.replace("node-",""),r={action:"id_details",id:t},$.get("graphHandler.php",buildArgs(r,"json")).done(function(e){return o(e),!0}).error(function(e,n){return!1}),!1):(console.debug("Provided data",n),o(n.values,n.x,n.y),!1)},checkInputTaxon=function(e,n){var r,o,t;return null==e&&(e="#firstTaxon"),console.debug("About to check taxon..."),$(e).exists()?(o=function(n){return bsAlert(n,"danger"),$(e).parent().addClass("has-error").addClass("has-feedback"),$(e).after('<span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'),!1},$(e).parent().removeClass("has-error").removeClass("has-feedback"),$(e).parent().find(".form-control-feedback").remove(),t=$(e).val(),isNull(t)?(console.error("Blank taxon error"),o("Blank taxon provided. Please make sure all taxon fields are filled."),!1):(r={q:t,strict:!0},console.debug("About to ping api for taxon",t),$.get("api.php",buildArgs(r),"json").done(function(e){return console.debug("Got result"),!0===e.status&&e.count>0?("function"==typeof n&&n(),!0):(o("Invalid taxon: '"+t+"'"),!1)}).fail(function(e,n){return console.error("Unable to ping the server")}),!1)):(console.error("Invalid selector"),!1)},fireRelationshipSearch=function(){var e,n,r,o;return console.debug("Clicked searcher"),e=$("#firstTaxon").val(),n=$("#secondTaxon").val(),r=isNull(e)?void 0:e.trim(),o=isNull(n)?void 0:n.trim(),checkInputTaxon("#firstTaxon",function(){return checkInputTaxon("#secondTaxon",function(){return $("#bs-alert").remove(),console.debug("Passing",r,o),plotRelationships(r,o)})}),!1},$(function(){var e;return $("#do-relationship-search").click(function(){return fireRelationshipSearch(),!1}),$(".taxon-entry").keyup(function(e){var n;return n=e.keyCode?e.keyCode:e.which,console.debug("Keycode",n),13===n&&fireRelationshipSearch(),!1}),$("#reset-graph").click(function(){return $("#alchemy").remove(),$("#graph-container").html('<div id="alchemy" class="alchemy" style="height: 75vh">\n</div>'),!1}),window.sgraph=new sigma("sigma"),e={edgeColor:"default",defaultEdgeColor:"#999",minArrowSize:2,skipErrors:!0},sgraph.settings(e),sgraph.bind("clickNode",function(e){return console.debug("Clicked",e),nodeClickEvent(this,e.data.node)}),sgraph.startForceAtlas2()});
//# sourceMappingURL=graph.min.js.map