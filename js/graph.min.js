var checkInputTaxon,fireRelationshipSearch,nodeClickEvent,plotRelationships,resetGraph;plotRelationships=function(e,r){var n;return null==e&&(e="rhinoceros unicornis"),null==r&&(r="bradypus tridactylus"),sgraph.clear(),n=buildArgs({action:"relatedness",taxon1:null!=e?e:"rhinoceros unicornis",taxon2:null!=r?r:"bradypus tridactylus"}),console.debug("Visiting","graphHandler.php?"+n),$.get("graphHandler.php",n,"json").done(function(e){var r,n,o,a;for(console.debug(e),window.alchemyResult=e,{dataSource:e,directedEdges:!0,forceLayout:!1},sgraph.graph.read(e),r=0,n=(a=sgraph.graph.nodes()).length;r<n;r++){o=a[r];try{if(o.caption===o.label)continue;o.label=o.caption,console.debug("Replaced label"),sgraph.graph.addNode(o)}catch(e){}}return sgraph.refresh(),delay(500,function(){return $("#alchemy .node.root circle").attr("r",15)}),$("g.node").unbind().click(function(){return nodeClickEvent(this)}),!1}).error(function(e,r){return!1}),!1},nodeClickEvent=function(e,r){var n,o;return null==r&&(r=null),o=function(r,n,o){var a,t,l,i;return null==n&&(n=0),null==o&&(o=0),console.debug(r),!isNull(r.label)&&(l=$(e).find("text").text(),isNull(l)&&(l=isNull(r.binomial)?r.label:r.binomial),"species"!==r.rank.toLowerCase()||(a={genus:(i=l.split(" "))[0],species:i[1]},t="species-account.php?"+buildArgs(a),isNull(a.species))?(a={action:"children",taxon:l},console.debug("Finding children","graphHandler.php?"+buildArgs(a)),$.get("graphHandler.php",buildArgs(a),"json").done(function(r){var a,t,l,i,s,c,d,u;for(console.debug("Got result",r),t=0,n+=1,l=0,s=(d=r.nodes).length;l<s;l++){e=d[l],console.debug("Creating node",e);try{++t,e.x+=n+1.5*t,e.y+=o+.25*t,console.debug("offsets",e.x,e.y);try{e.caption!==e.label&&(e.label=e.caption,console.debug("Replaced label"))}catch(e){}sgraph.graph.addNode(e)}catch(e){}}for(i=0,c=(u=r.edges).length;i<c;i++){a=u[i],console.debug("Creating edge",a);try{sgraph.graph.addEdge(a)}catch(e){}}return sgraph.refresh(),$("g.node").unbind().click(function(){return nodeClickEvent(this)}),!1}).error(function(e,r){return!1}),!1):(goTo(t),!0))},isNull(r)?(n={action:"id_details",id:$(e).attr("id").replace("node-","")},$.get("graphHandler.php",buildArgs(n,"json")).done(function(e){return o(e),!0}).error(function(e,r){return!1}),!1):(console.debug("Provided data",r),o(r.values,r.x,r.y),!1)},checkInputTaxon=function(e,r){var n,o,a;return null==e&&(e="#firstTaxon"),console.debug("About to check taxon..."),$(e).exists()?(o=function(r){return bsAlert(r,"danger"),$(e).parent().addClass("has-error").addClass("has-feedback"),$(e).after('<span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'),!1},$(e).parent().removeClass("has-error").removeClass("has-feedback"),$(e).parent().find(".form-control-feedback").remove(),a=$(e).val(),isNull(a)?(console.error("Blank taxon error"),o("Blank taxon provided. Please make sure all taxon fields are filled."),!1):(n={q:a,strict:!0},console.debug("About to ping api for taxon",a),$.get("api.php",buildArgs(n),"json").done(function(e){return console.debug("Got result"),!0===e.status&&e.count>0?("function"==typeof r&&r(),!0):(o("Invalid taxon: '"+a+"'"),!1)}).fail(function(e,r){return console.error("Unable to ping the server")}),!1)):(console.error("Invalid selector"),!1)},fireRelationshipSearch=function(){var e,r,n,o;return console.debug("Clicked searcher"),e=$("#firstTaxon").val(),r=$("#secondTaxon").val(),n=isNull(e)?void 0:e.trim(),o=isNull(r)?void 0:r.trim(),checkInputTaxon("#firstTaxon",function(){return checkInputTaxon("#secondTaxon",function(){return $("#bs-alert").remove(),console.debug("Passing",n,o),plotRelationships(n,o)})}),!1},resetGraph=function(){var e;return console.debug("Resetting sigma graph"),sgraph.graph.clear(),e={action:"children",taxon:"mammalia"},$.get("graphHandler.php",buildArgs(e),"json").done(function(e){return console.debug(e),sgraph.graph.read(e),sgraph.refresh()}).error(function(e,r){return console.error("Unable to get default graph"),!1}),!1},$(function(){var e;return $("#do-relationship-search").click(function(){return fireRelationshipSearch(),!1}),$(".taxon-entry").keyup(function(e){var r;return r=e.keyCode?e.keyCode:e.which,console.debug("Keycode",r),13===r&&fireRelationshipSearch(),!1}),$("#reset-graph").click(function(){return resetGraph(),!1}),window.sgraph=new sigma("sigma"),e={edgeColor:"default",defaultEdgeColor:"#999",minArrowSize:2,skipErrors:!0},sgraph.settings(e),sgraph.bind("clickNode",function(e){return console.debug("Clicked",e),nodeClickEvent(this,e.data.node)}),sgraph.startForceAtlas2(),console.info("Sigma ready"),resetGraph(),$("#do-relationship-search").removeAttr("disabled")});
//# sourceMappingURL=graph.min.js.map