var checkInputTaxon,fireRelationshipSearch,nodeClickEvent,plotRelationships;loadJS("bower_components/d3/d3.min.js",function(){return loadJS("https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js",function(){return loadJS("bower_components/alchemyjs/dist/alchemy.js",function(){return $("head").append("<link rel='stylesheet' href='bower_components/alchemyjs/dist/alchemy.min.css'>"),console.info("Alchemy ready"),$("#do-relationship-search").removeAttr("disabled")})})}),plotRelationships=function(e,n){var o,r;return null==e&&(e="rhinoceros unicornis"),null==n&&(n="bradypus tridactylus"),o={action:"relatedness",taxon1:null!=e?e:"rhinoceros unicornis",taxon2:null!=n?n:"bradypus tridactylus"},r=buildArgs(o),console.debug("Visiting","graphHandler.php?"+r),$.get("graphHandler.php",r,"json").done(function(e){var n;return window.alchemyResult=e,n={dataSource:e,directedEdges:!0,forceLayout:!1},alchemy.begin(n),delay(500,function(){return $("#alchemy .node.root circle").attr("r",15)}),$("g.node").unbind().click(function(){return nodeClickEvent(this)}),!1}).error(function(e,n){return!1}),!1},nodeClickEvent=function(e){var n,o,r;return r=$(e).attr("id"),o=r.replace("node-",""),n={action:"id_details",id:o},$.get("graphHandler.php",buildArgs(n,"json")).done(function(o){var r,t,a;return console.debug(o),!isNull(o.label)&&("species"!==o.rank.toLowerCase()||(t=$(e).find("text").text(),a=t.split(" "),n={genus:a[0],species:a[1]},r="species-account.php?"+buildArgs(n),console.debug(r),!0))}).error(function(e,n){return!1}),!1},checkInputTaxon=function(e,n){var o,r,t;return null==e&&(e="#firstTaxon"),console.debug("About to check taxon..."),$(e).exists()?(r=function(n){return bsAlert(n,"danger"),$(e).parent().addClass("has-error").addClass("has-feedback"),$(e).after('<span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>'),!1},$(e).parent().removeClass("has-error").removeClass("has-feedback"),$(e).parent().find(".form-control-feedback").remove(),t=$(e).val(),isNull(t)?(console.error("Blank taxon error"),r("Blank taxon provided. Please make sure all taxon fields are filled."),!1):(o={q:t,strict:!0},console.debug("About to ping api for taxon",t),$.get("api.php",buildArgs(o),"json").done(function(e){return console.debug("Got result"),!0===e.status&&e.count>0?("function"==typeof n&&n(),!0):(r("Invalid taxon: '"+t+"'"),!1)}).fail(function(e,n){return console.error("Unable to ping the server")}),!1)):(console.error("Invalid selector"),!1)},fireRelationshipSearch=function(){var e,n,o,r;return console.debug("Clicked searcher"),e=$("#firstTaxon").val(),n=$("#secondTaxon").val(),o=isNull(e)?void 0:e.trim(),r=isNull(n)?void 0:n.trim(),checkInputTaxon("#firstTaxon",function(){return checkInputTaxon("#secondTaxon",function(){return $("#bs-alert").remove(),console.debug("Passing",o,r),plotRelationships(o,r)})}),!1},$(function(){return $("#do-relationship-search").click(function(){return fireRelationshipSearch(),!1}),$(".taxon-entry").keyup(function(e){var n;return n=e.keyCode?e.keyCode:e.which,console.debug("Keycode",n),13===n&&fireRelationshipSearch(),!1}),$("#reset-graph").click(function(){return $("#alchemy").remove(),$("#alchemy-container").html('<div id="alchemy" class="alchemy" style="height: 75vh">\n</div>'),!1})});
//# sourceMappingURL=graph.min.js.map