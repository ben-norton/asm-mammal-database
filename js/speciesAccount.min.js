var appendCountryLayerToMap,baseQuery,fetchIucnRange,fetchMOLRange,gMapsConfig,getSpeciesAccountLinkout,initMap,setMapHelper,worldPoliticalFusionTableId,indexOf=[].indexOf||function(e){for(var n=0,o=this.length;n<o;n++)if(n in this&&this[n]===e)return n;return-1};gMapsConfig={jsApiKey:"AIzaSyC_qZqVvNk6A6px4Q7BJQOOHqpnQNihSBA",jsApiSrc:"https://maps.googleapis.com/maps/api/js",jsApiInitCallbackFn:null,hasRunInitMap:!1},baseQuery={query:{select:"json_4326",from:worldPoliticalFusionTableId="1uKyspg-HkChMIntZ0N376lMpRzduIjr85UYPpQ"},styles:[{polygonOptions:{fillColor:"#dd2255",strokeColor:"#000",strokeWeight:.05,fillOpacity:.05}}],suppressInfoWindows:!0},"object"==typeof _asm&&(_asm.baseQuery=$.extend({},baseQuery)),appendCountryLayerToMap=function(e,n){var o,a,t,s,i,l,r,p,c,u,g,d,f;if(null==e&&(e={code:"US"}),null==n&&(n=gMapsConfig.map),null==("undefined"!=typeof google&&null!==google?google.maps:void 0))return initMap(function(){return appendCountryLayerToMap(e,n),!1}),!1;if(!(n instanceof google.maps.Map))return console.error("Invalid map object provided"),!1;if(t={code:"postal",postal:"postal",name:"name",country:"name"},p=[],console.debug("Got query obj",e),i=$.extend({},_asm.baseQuery),s=[],"object"==typeof e){o=[];for(a in e)if(f=e[a],indexOf.call(Object.keys(t),a)>=0)if(isArray(f))for(l=0,c=f.length;l<c;l++)g=f[l],o.push("'"+t[a]+"' = '"+g+"'");else o.push("'"+t[a]+"' = '"+f+"'");for(r=0,u=o.length;r<u;r++)d={where:o[r],polygonOptions:{fillColor:"#22dd55",strokeColor:"#22dd55",strokeWeight:1,fillOpacity:.5}},i.styles.push(d);s.push(i),p.push(setMapHelper(new google.maps.FusionTablesLayer(i),n))}else i.query.where=e,i.styles[0]={polygonOptions:{fillColor:"#22dd55",strokeColor:"#22dd55",strokeWeight:1,fillOpacity:.5}},s.push(i),p.push(setMapHelper(new google.maps.FusionTablesLayer(i),n));return{fusionQueries:s,layers:p,mapObj:n}},setMapHelper=function(e,n){return null==n&&(n=gMapsConfig.map),e.setMap(n),e},initMap=function(e,n){var o,a,t,s,i,l,r,p,c,u,g;return null==n&&(n="#species-note"),!0===gMapsConfig.hasRunInitMap?(console.debug("Map already initialized"),"function"==typeof e&&e(),!1):null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?(console.debug("Loading Google Maps first ..."),i=gMapsConfig.jsApiSrc+"?key="+gMapsConfig.jsApiKey,"function"==typeof gMapsConfig.jsApiInitCallbackFn&&(l=[this.getName(),"initMap"],r=gMapsConfig.jsApiInitCallbackFn.getName(),indexOf.call(l,r)<0&&(i+="&callback="+gMapsConfig.jsApiInitCallbackFn.getName())),loadJS(i,function(){return initMap(e,n),!1}),!1):$(n).exists()?($(n).removeClass("col-xs-12").addClass("col-xs-6"),o='<div id="taxon-range-map-container" class="col-xs-6 map-container google-map-container">\n  <div id="taxon-range-map" class="map google-map">\n  </div>\n</div>',$(n).after(o),t={center:{lat:null!=(p=null!=(c=window.locationData)?c.lat:void 0)?p:0,lng:null!=(u=null!=(g=window.locationData)?g.lng:void 0)?u:0},zoom:2},s=$("#taxon-range-map").get(0),a=new google.maps.Map(s,t),gMapsConfig.map=a,gMapsConfig.hasRunInitMap=!0,"function"==typeof e&&e(),a):(console.error("Invalid page layout to init map"),!1)},fetchIucnRange=function(e){var n,o;return null==e&&(e=window._activeTaxon),isNull(e.genus)||isNull(e.species),n={action:"iucn",taxon:e.genus.toTitleCase()+"%20"+e.species,iucn_endpoint:"species/countries/name/"},isNull(e.subspecies)||(n.taxon+="%20"+e.subspecies),o=function(){return fetchMOLRange(e,void 0,!0),!1},$.get("api.php",buildQuery(n,"json")).done(function(e){var a,t,s,i,l,r,p,c,u,g;if(console.log("Got",e),!0!==e.status){console.warn(uri.urlString+"api.php?"+buildQuery(n));try{o()}catch(e){}return!1}if(a=[],(null!=(u=e.response)?u.count:void 0)<=0){console.warn("No results found!");try{o()}catch(e){}return!1}for(s=[],i=0,r=(g=Object.toArray(e.response.result)).length;i<r;i++)-1===(t=g[i]).presence.search(/extinct/i)&&s.push(t);if(0===s.length)return console.warn("This taxon '"+e.response.name+"' is extinct :("),!1;for(l=0,p=s.length;l<p;l++)t=s[l],a.push(t.code);return shuffle(a),c={code:a},console.debug("Taxon exists in "+a.length+" countries...",a),initMap(function(){var e;return console.debug("Map initialized, populating..."),e=appendCountryLayerToMap(c),console.debug("Country layers topped",e)}),!1}).fail(function(e,n){console.error("Couldn't load range map"),console.warn(e,n);try{o()}catch(e){}return!1}),!1},fetchMOLRange=function(e,n,o,a){var t,s,i,l,r,p,c;if(null==e&&(e=window._activeTaxon),null==o&&(o=!1),null==a&&(a="#species-note"),"object"!=typeof e)return console.error("No taxon object specified"),!1;if(i=e,isNull(e.genus)||isNull(e.species))try{r=$(e).attr("data-genus"),c=$(e).attr("data-species"),isNull(n)&&(n=$(e).attr("data-kml")),e={genus:r,species:c}}catch(e){}if(isNull(e.genus)||isNull(e.species))return toastStatusMessage("Unable to show range map"),!1;if(isNull(n)){try{n=$(i).attr("data-kml")}catch(e){}isNull(n)&&console.warn("Unable to read KML attr and none passed")}return l="https://mol.org/species/map/",t={embed:"true"},window._iframeRangeFail=function(){return o?console.debug("Not falling back -- `dontExecuteFallback` set"):(console.warn("We failed to load the MOL range map, doing a fall back to the IUCN/FusionTable map"),$("#taxon-range-map-container.mol-map-container").remove(),fetchIucnRange(e)),!1},p='<div id="taxon-range-map-container" class="col-xs-6 map-container mol-map-container">\n  <iframe class="mol-embed mol-account map" id="species-range-map" src="'+l+e.genus.toTitleCase()+"_"+e.species+"?"+buildQuery(t)+'"  data-taxon-genus="'+e.genus+'" data-taxon-species="'+e.species+'" onerror="_iframeRangeFail()"></iframe>\n</div>',$("#taxon-range-map-container").remove(),$(a).removeClass("col-xs-12").addClass("col-xs-6").after(p),s=delay(7500,function(){return _iframeRangeFail()}),$("#species-range-map").on("load",function(){return clearTimeout(s),!1}),!0},getSpeciesAccountLinkout=function(e,n,o){return null==e&&(e=window._activeTaxon),null==n&&(n="api.php"),null==o&&(o="table ol a"),$.get(n,"action=get-account").done(function(n){var a,t,s,i,l;for(t=0,s=(i=$(n).find(o)).length;t<s;t++)a=i[t],(l=$(a).text().replace(/^(.*?)\s+\(([\w ]+)\)\s*$/gim,"$2").split(" "))[0]===e.genus&&l[1]===e.species?console.log("Found a match: ",$(a).attr("href")):console.warn("Found no matching taxon from open-access accounts");return!1}).fail(function(e,o){return console.error("Unable to hit target '"+n+"'"),!1}),!1},$(function(){return isNull(window.gMapsLocalKey)||(console.log("Using local unrestricted key"),gMapsConfig.jsApiKey=window.gMapsLocalKey),fetchMOLRange(),!1});
//# sourceMappingURL=speciesAccount.min.js.map