var appendCountryLayerToMap,baseQuery,fetchIucnRange,gMapsConfig,initMap,setMapHelper,worldPoliticalFusionTableId,indexOf=[].indexOf||function(e){for(var n=0,o=this.length;n<o;n++)if(n in this&&this[n]===e)return n;return-1};gMapsConfig={jsApiKey:"AIzaSyC_qZqVvNk6A6px4Q7BJQOOHqpnQNihSBA",jsApiSrc:"https://maps.googleapis.com/maps/api/js",jsApiInitCallbackFn:null,hasRunInitMap:!1},isNull(window.gMapsLocalKey)||(gMapsConfig.jsApiKey=window.gMapsLocalKey),baseQuery={query:{select:"json_4326",from:worldPoliticalFusionTableId="1uKyspg-HkChMIntZ0N376lMpRzduIjr85UYPpQ"},styles:[{polygonOptions:{fillColor:"#22dd55",strokeColor:"#22dd55",strokeWeight:1,fillOpacity:.5}}]},appendCountryLayerToMap=function(e,n){var o,a,i,l,s,t,p,r,u,g,c,d,f,y;if(null==e&&(e={code:"US"}),null==n&&(n=gMapsConfig.map),null==("undefined"!=typeof google&&null!==google?google.maps:void 0))return initMap(function(){return appendCountryLayerToMap(e,n),!1}),!1;if(!(n instanceof google.maps.Map))return console.error("Invalid map object provided"),!1;if(i={code:"postal",postal:"postal",name:"name",country:"name"},r=[],s=$.extend({},baseQuery),l=[],"object"==typeof e){o=[];for(a in e)if(f=e[a],indexOf.call(Object.keys(i),a)>=0)if(isArray(f))for(t=0,u=f.length;t<u;t++)c=f[t],o.push("'"+i[a]+"' = '"+c+"'");else o.push("'"+i[a]+"' = '"+f+"'");for(p=0,g=o.length;p<g;p++)y=o[p],console.debug("obj build"),d={query:{select:"json_4326",from:worldPoliticalFusionTableId,where:y},styles:[{polygonOptions:{fillColor:"#22dd55",strokeColor:"#22dd55",strokeWeight:1,fillOpacity:.5}}]},l.push(d),r.push(setMapHelper(new google.maps.FusionTablesLayer(d),n))}else s.query.where=e,l.push(s),r.push(setMapHelper(new google.maps.FusionTablesLayer(s),n));return{fusionQueries:l,layers:r,mapObj:n}},setMapHelper=function(e,n){return null==n&&(n=gMapsConfig.map),e.setMap(n),e},initMap=function(e,n){var o,a,i,l,s,t,p,r,u,g,c;return null==n&&(n="#species-note"),!0===gMapsConfig.hasRunInitMap?(console.debug("Map already initialized"),"function"==typeof e&&e(),!1):null==("undefined"!=typeof google&&null!==google?google.maps:void 0)?(console.debug("Loading Google Maps first ..."),s=gMapsConfig.jsApiSrc+"?key="+gMapsConfig.jsApiKey,"function"==typeof gMapsConfig.jsApiInitCallbackFn&&(t=[this.getName(),"initMap"],p=gMapsConfig.jsApiInitCallbackFn.getName(),indexOf.call(t,p)<0&&(s+="&callback="+gMapsConfig.jsApiInitCallbackFn.getName())),loadJS(s,function(){return initMap(e,n),!1}),!1):$(n).exists()?($(n).removeClass("col-xs-12").addClass("col-xs-6"),o='<div id="taxon-range-map-container" class="col-xs-6 map-container google-map-container">\n  <div id="taxon-range-map" class="map google-map">\n  </div>\n</div>',$(n).after(o),i={center:{lat:null!=(r=null!=(u=window.locationData)?u.lat:void 0)?r:0,lng:null!=(g=null!=(c=window.locationData)?c.lng:void 0)?g:0},zoom:2},l=$("#taxon-range-map").get(0),a=new google.maps.Map(l,i),gMapsConfig.map=a,gMapsConfig.hasRunInitMap=!0,"function"==typeof e&&e(),a):(console.error("Invalid page layout to init map"),!1)},fetchIucnRange=function(e){var n;return null==e&&(e=window._activeTaxon),isNull(e.genus)||isNull(e.species),n={action:"iucn",taxon:e.genus.toTitleCase()+"%20"+e.species,iucn_endpoint:"species/countries/name/"},isNull(e.subspecies)||(n.taxon+="%20"+e.subspecies),$.get("api.php",buildQuery(n,"json")).done(function(e){var o,a,i,l,s,t,p,r,u,g;if(console.log("Got",e),!0!==e.status)return console.warn(uri.urlString+"api.php?"+buildQuery(n)),!1;if(o=[],(null!=(u=e.response)?u.count:void 0)<=0)return console.warn("No results found!"),!1;for(i=[],l=0,t=(g=Object.toArray(e.response.result)).length;l<t;l++)-1===(a=g[l]).presence.search(/extinct/i)&&i.push(a);if(0===i.length)return console.warn("This taxon '"+e.response.name+"' is extinct :("),!1;for(s=0,p=i.length;s<p;s++)a=i[s],o.push(a.code);return r={code:o},console.debug("Taxon exists in "+o.length+" countries...",o),initMap(function(){var e;return console.debug("Map initialized, populating..."),e=appendCountryLayerToMap(r),console.debug("Country layers topped",e)}),!1}).fail(function(e,n){return!1}),!1},$(function(){return fetchIucnRange(),!1});
//# sourceMappingURL=speciesAccount.min.js.map